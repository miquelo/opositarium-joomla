function joms_init_postbox(){this.joms=this.joms||{},this.joms.jst=this.joms.jst||{},this.joms.jst["html/dropdown/event"]=function(t){var e,i="";_.escape;return i+='<div class="joms-postbox-dropdown event-dropdown"> <div style="clear:both"> <div class=event-time-column> <span>'+(null==(e=t.language.event.category)?"":e)+' <span style="color:red">*</span></span> <div class="joms-select--wrapper"> <select class="joms-event-category joms-select" style="width:100%"></select> </div> </div> <div class=event-time-column> <span>'+(null==(e=t.language.event.location)?"":e)+' <span style="color:red">*</span></span> <input type=text class=joms-input name=location placeholder="'+(null==(e=t.language.event.location_hint)?"":e)+'"> </div> </div> <div style="clear:both"> <div class=event-time-column> <span>'+(null==(e=t.language.event.start)?"":e)+' <span style="color:red">*</span></span> <input type=text class="joms-input joms-pickadate-startdate" placeholder="'+(null==(e=t.language.event.start_date_hint)?"":e)+'" style="background-color:transparent;cursor:text"> <input type=text class="joms-input joms-pickadate-starttime" placeholder="'+(null==(e=t.language.event.start_time_hint)?"":e)+'" style="background-color:transparent;cursor:text"> <span class="event-all-day joms-event-allday" style="margin-left:0;visibility:hidden"> <span>All Day Event</span> <span style="position:relative"><i class=joms-icon-check-empty></i></span></span> </div> <div class=event-time-column> <span>'+(null==(e=t.language.event.end)?"":e)+' <span style="color:red">*</span></span> <input type=text class="joms-input joms-pickadate-enddate" placeholder="'+(null==(e=t.language.event.end_date_hint)?"":e)+'" style="background-color:transparent;cursor:text"> <input type=text class="joms-input joms-pickadate-endtime" placeholder="'+(null==(e=t.language.event.end_time_hint)?"":e)+'" style="background-color:transparent;cursor:text"> </div> </div> <nav class="joms-postbox-tab selected"> <div class="joms-postbox-action event-action"> <button class=joms-postbox-done>'+(null==(e=t.language.event.done_button)?"":e)+"</button> </div> </nav> </div>"},this.joms.jst["html/dropdown/location-list"]=function(t){var e,i="";_.escape,Array.prototype.join;if(t&&t.items&&t.items.length)for(var s=0;s<t.items.length;s++)i+=' <li data-index="'+(null==(e=s)?"":e)+'"> <p style="margin:0">'+(null==(e=t.items[s].name)?"":e)+"</p> <span>"+(null==(e=t.items[s].vicinity||t.language.geolocation.near_here)?"":e)+"</span> </li> ";else i+=" <li><em>"+(null==(e=t.language.geolocation.empty)?"":e)+"</em></li> ";return i},this.joms.jst["html/dropdown/location"]=function(t){var e,i="";_.escape;return i+='<div class="joms-postbox-dropdown location-dropdown"> <div class=joms-postbox-map></div> <div class="joms-postbox-action joms-location-action"> <button class=joms-add-location><i class=joms-icon-map-marker></i>'+(null==(e=t.language.geolocation.select_button)?"":e)+"</button> <button class=joms-remove-location><i class=joms-icon-remove></i>"+(null==(e=t.language.geolocation.remove_button)?"":e)+'</button> </div> <input class="joms-postbox-keyword joms-input" type=text> <ul class=joms-postbox-locations></ul> </div>'},this.joms.jst["html/dropdown/mood"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+='<div class="joms-postbox-dropdown mood-dropdown"> <ul class="joms-postbox-emoticon joms-list clearfix"> ',t&&t.items&&t.items.length)for(var s=0;s<t.items.length;s++)i+=' <li data-mood="'+(null==(e=t.items[s][0])?"":e)+'"> ',void 0!==t.items[s][2]?i+=' <div><img class=joms-emoticon src="'+(null==(e=t.items[s][2])?"":e)+'"><span>'+(null==(e=t.items[s][1])?"":e)+"</span></div> ":i+=' <div><i class="joms-emoticon joms-emo-'+(null==(e=t.items[s][0])?"":e)+'"></i><span>'+(null==(e=t.items[s][1])?"":e)+"</span></div> ",i+=" </li> ";return i+=" <li class=joms-remove-button>"+(null==(e=t.language.status.remove_mood_button)?"":e)+"</li> </ul> </div>"},this.joms.jst["html/dropdown/privacy"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+='<div class="joms-postbox-dropdown privacy-dropdown"> <ul class=joms-list> ',t&&t.items&&t.items.length)for(var s=0;s<t.items.length;s++)i+=' <li data-priv="'+(null==(e=t.items[s][0])?"":e)+'"> <p class=reset-gap><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+"#joms-icon-"+(null==(e=t.items[s][1])?"":e)+'"></use></svg> '+(null==(e=t.items[s][2])?"":e)+"</p> <span>"+(null==(e=t.items[s][3])?"":e)+"</span> </li> ";return i+=" </ul> </div>"},this.joms.jst["html/inputbox/eventdesc"]=function(t){var e,i="";_.escape;return i+='<div style="position:relative"> <div class="joms-postbox-input joms-inputbox"> <div class=inputbox> <div style="position:relative"> <div style="position:relative"><span class=input></span></div> <textarea class=input placeholder="'+(null==(e=t&&t.placeholder||"")?"":e)+'" style="min-height:1.4em"></textarea> </div> </div> </div> <div class="charcount joms-postbox-charcount"></div> </div>'},this.joms.jst["html/inputbox/eventtitle"]=function(t){var e,i="";_.escape;return i+='<div style="position:relative"> <div class="joms-postbox-input joms-inputbox" style="padding:0; border-bottom:0; min-height:0"> <div class=inputbox> <div style="position:relative"> <div style="position:relative"><span class=input></span></div> <textarea class=input placeholder="'+(null==(e=t&&t.placeholder||"")?"":e)+'" style="min-height:1.4em"></textarea> </div> </div> </div> </div>'},this.joms.jst["html/inputbox/photo"]=function(t){var e,i="";_.escape;return i+='<div style="position:relative"> <div class="joms-postbox-input joms-inputbox"> <div class=inputbox> <div style="position:relative"> <div style="position:relative"><span class=input></span></div> <div class=joms-textarea__wrapper><textarea class="input input-photo-desc" placeholder="'+(null==(e=t&&t.placeholder||"")?"":e)+'" style="min-height:1.4em"></textarea></div> </div> </div> </div> <div class="charcount joms-postbox-charcount"></div> </div>'},this.joms.jst["html/inputbox/status"]=function(t){var e,i="";_.escape;return i+='<div style="position:relative"> <div class="joms-postbox-input joms-inputbox"> <div class=inputbox> <div style="position:relative"> <div style="position:relative"><span class=input></span></div> <div class=joms-textarea__wrapper><textarea class="input input-status" placeholder="'+(null==(e=t&&t.placeholder||"")?"":e)+'" style="min-height:1.4em"></textarea></div> </div> </div> </div> <div class="charcount joms-postbox-charcount"></div> </div>'},this.joms.jst["html/inputbox/video"]=function(t){var e,i="";_.escape;return i+='<div style="position:relative"> <div class="joms-postbox-input joms-inputbox"> <div class=inputbox> <div style="position:relative"> <div style="position:relative"><span class=input></span></div> <div class=joms-textarea__wrapper><textarea class="input joms-postbox-video-description" placeholder="'+(null==(e=t&&t.placeholder||"")?"":e)+'" style="min-height:1.4em"></textarea></div> </div> </div> </div> <div class="charcount joms-postbox-charcount"></div> </div>'},this.joms.jst["html/inputbox/videourl"]=function(t){var e,i="";_.escape;return i+='<div style="position:relative"> <div class="joms-postbox-input joms-inputbox" style="padding:0; border-bottom:0; min-height:0"> <div class=inputbox> <div style="position:relative"> <div style="position:relative"><span class=input></span></div> <textarea class="input joms-postbox-video-url" placeholder="'+(null==(e=t&&t.placeholder||"")?"":e)+'" style="min-height:1.4em"></textarea> </div> </div> </div> </div>'},this.joms.jst["html/postbox/custom"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+='<div> <div class=joms-postbox-inner-panel> <div class=joms-postbox-double-panel> <ul class="joms-list clearfix"> <li class=joms-postbox-predefined-message><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-cog"></use></svg> '+(null==(e=t.language.custom.predefined_button)?"":e)+'</li> <li class=joms-postbox-custom-message><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-pencil"></use></svg> '+(null==(e=t.language.custom.custom_button)?"":e)+"</li> </ul> </div> </div> <div class=joms-postbox-custom> <div class=joms-postbox-custom-state-predefined> <div class=joms-postbox-inner-panel> <span>"+(null==(e=t.language.custom.predefined_label)?"":e)+'</span><br> <select name=predefined style="width: 100%"> ',t&&t.messages&&t.messages.length){i+=" ";for(var s=0;s<t.messages.length;s++)i+=' <option value="'+(null==(e=t.messages[s][0])?"":e)+'">'+(null==(e=t.messages[s][1])?"":e)+"</option> ";i+=" "}return i+=" </select> </div> </div> <div class=joms-postbox-custom-state-custom> <div class=joms-postbox-inner-panel> <span>"+(null==(e=t.language.custom.custom_label)?"":e)+'</span><br> <textarea name=custom></textarea> </div> </div> <nav class="joms-postbox-tab selected"> <ul class="joms-list inline"> <li data-tab=privacy><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-earth"></use></svg> <span class=visible-desktop></span></li> </ul> <div class=joms-postbox-action> <button class=joms-postbox-cancel>'+(null==(e=t.language.postbox.cancel_button)?"":e)+"</button> <button class=joms-postbox-save>"+(null==(e=t.language.postbox.post_button)?"":e)+'</button> </div> <div class=joms-postbox-loading style="display:none;"> <img src="'+(null==(e=t.juri.root)?"":e)+'components/com_community/assets/ajax-loader.gif" alt="loader"> <div </nav> <div class="joms-postbox-dropdown privacy-dropdown"></div> </div> </div>'},this.joms.jst["html/postbox/event"]=function(t){var e,i="";_.escape;return i+='<div class=joms-postbox-event> <div class=joms-postbox-inner-panel> <div class=joms-postbox-title></div> <div class=joms-postbox-event-detail> <div class="joms-postbox-event-panel joms-postbox-event-label-category" style="display:none"> <div class=joms-postbox-event-title style="padding-bottom:0;padding-top:8px"> <div class=joms-input-field-name>'+(null==(e=t.language.event.category)?"":e)+'</div> <span class=joms-input-text style="display:inline-block"></span> </div> </div> <div class="joms-postbox-event-panel joms-postbox-event-label-location" style="display:none"> <div class=joms-postbox-event-title style="padding-bottom:0;padding-top:8px"> <div class=joms-input-field-name>'+(null==(e=t.language.event.location)?"":e)+'</div> <span class=joms-input-text style="display:inline-block"></span> </div> </div> <div class="joms-postbox-event-panel joms-postbox-event-label-date" style="display:none"> <div class=joms-postbox-event-title style="padding-bottom:0;padding-top:8px"> <div class=joms-input-field-name>'+(null==(e=t.language.event.date_and_time)?"":e)+'</div> <span class=joms-input-text style="display:inline-block"></span> </div> </div> </div> </div> <div class=joms-postbox-inputbox></div> <nav class="joms-postbox-tab selected"> <ul class="joms-list inline"> <li data-tab=event><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-cog"></use></svg> <span class=visible-desktop>'+(null==(e=t.language.event.event_detail)?"":e)+"</span></li> </ul> <div class=joms-postbox-action> <button class=joms-postbox-cancel>"+(null==(e=t.language.postbox.cancel_button)?"":e)+"</button> <button class=joms-postbox-save>"+(null==(e=t.language.postbox.post_button)?"":e)+'</button> </div> <div class=joms-postbox-loading style="display:none;"> <img src="'+(null==(e=t.juri.root)?"":e)+'components/com_community/assets/ajax-loader.gif" alt="loader"> <div </nav> </div>'},this.joms.jst["html/postbox/fetcher-video"]=function(t){var e,i="",s=_.escape;Array.prototype.join;return i+="<div class=joms-fetched-wrapper> ",t.image&&(i+=' <div class=joms-fetched-images> <img src="'+(null==(e=t.image)?"":e)+'"> </div> '),i+=' <div class="joms-fetched-field joms-fetched-title"> <span style="font-weight:bold">'+(null==(e=t.title||t.titlePlaceholder)?"":e)+'</span> <input type=text class=joms-input value="'+(null==(e=s(t.title||""))?"":e)+'" style="display:none;margin:0"> </div> <div class="joms-fetched-field joms-fetched-description"> <span>'+(null==(e=t.description||t.descPlaceholder)?"":e)+'</span> <textarea class=joms-textarea style="display:none;margin:0">'+(null==(e=t.description||"")?"":e)+"</textarea> </div> <div class=clearfix></div> <span class=joms-fetched-close ><i class=joms-icon-remove></i>"+(null==(e=t.lang.cancel)?"":e)+'</span> <div style="padding-top:10px"> <div class="joms-fetched-category joms-select" style="padding:3px 0"></div> </div> </div>'},this.joms.jst["html/postbox/fetcher"]=function(t){var e,i="",s=_.escape;Array.prototype.join;if(i+='<div class=joms-postbox-inner-panel> <div style="position:relative"> <div class=joms-fetched-images> ',t.image&&t.image.length){i+=' <div style="height:120px"> ';for(var o=0;o<t.image.length;o++)i+=' <img src="'+(null==(e=t.image[o])?"":e)+'" style="width:100%;height:100%;'+(null==(e=o?"display:none":"")?"":e)+'"> ';i+=" </div> ",t.image.length>1&&(i+=' <div class=joms-fetched-nav style="text-align:center"> <span class=joms-fetched-previmg style="cursor:pointer">&laquo; '+(null==(e=t.lang.prev)?"":e)+'</span> &nbsp;&nbsp; <span class=joms-fetched-nextimg style="cursor:pointer">'+(null==(e=t.lang.next)?"":e)+" &raquo;</span> </div> "),i+=" "}else i+=' <div style="height:120px;width:120px;background-color:#F9F9F9;color:7F8C8D;text-align:center;vertical"> &nbsp;<br>&nbsp;<br>no<br>thumbnail </div> ';return i+=' </div> <div class="joms-fetched-field joms-fetched-title"> <span style="font-weight:bold">'+(null==(e=t.title||t.titlePlaceholder)?"":e)+'</span> <input type=text class=joms-input value="'+(null==(e=s(t.title||""))?"":e)+'" style="display:none;margin:0"> </div> <div class="joms-fetched-field joms-fetched-description"> <span>'+(null==(e=t.description||t.descPlaceholder)?"":e)+'</span> <textarea class=joms-textarea style="display:none;margin:0">'+(null==(e=t.description||"")?"":e)+'</textarea> </div> <div class=clearfix></div> <span class=joms-fetched-close style="top:0"><i class=joms-icon-remove></i>'+(null==(e=t.lang.cancel)?"":e)+"</span> </div> </div>"},this.joms.jst["html/postbox/photo-item"]=function(t){var e,i="";_.escape;return i+='<li id="'+(null==(e=t.id)?"":e)+'" class=joms-postbox-photo-item> <div class=img-wrapper> <img src="'+(null==(e=t.src)?"":e)+'" > </div> <div class=joms-postbox-photo-action style="display:none"> <span class=joms-postbox-photo-remove>×</span> </div> <div class=joms-postbox-photo-progressbar> <div class=joms-postbox-photo-progress></div> </div> </li>'},this.joms.jst["html/postbox/photo-preview"]=function(t){var e="";_.escape;return e+='<div class=joms-postbox-photo-preview> <ul class="joms-list clearfix"></ul> <div class=joms-postbox-photo-form></div> </div>'},this.joms.jst["html/postbox/photo"]=function(t){var e,i="";_.escape;return i+='<div> <div id=joms-postbox-photo-upload style="position:absolute;top:0;left:0;width:1px;height:1px;overflow:hidden"> <button id=joms-postbox-photo-upload-btn>Upload</button> </div> <div class=joms-postbox-inner-panel style="position:relative"> '+(t.allowgif?'<div class=joms-postbox-double-panel> <ul class="joms-list clearfix"> <li>':"")+'<div class=joms-postbox-photo-upload> <svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-images"></use></svg> '+(null==(e=t.language.photo[t.allowgif?"upload_button_2":"upload_button"])?"":e)+" </div> "+(t.allowgif?'</li> <li> <div class=joms-postbox-gif-upload> <svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-images"></use></svg> '+(null==(e=t.language.photo.gif_upload_button)?"":e)+" </div> </li> </ul> </div>":"")+' </div> <div class=joms-postbox-photo> <div class=joms-postbox-preview></div> <div class=joms-postbox-inputbox></div> <nav class="joms-postbox-tab selected"> <ul class="joms-list inline"> <li data-tab=upload data-bypass=1><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-images"></use></svg> <span class=visible-desktop>'+(null==(e=t.language.photo.upload_button_more)?"":e)+'</span></li> <li data-tab=mood><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-smiley"></use></svg> <span class=visible-desktop>'+(null==(e=t.language.status.mood)?"":e)+"</span></li> </ul> <div class=joms-postbox-action> <button class=joms-postbox-cancel>"+(null==(e=t.language.postbox.cancel_button)?"":e)+"</button> <button class=joms-postbox-save>"+(null==(e=t.language.postbox.post_button)?"":e)+'</button> </div> <div class=joms-postbox-loading style="display:none;"> <img src="'+(null==(e=t.juri.root)?"":e)+'components/com_community/assets/ajax-loader.gif" alt="loader"> </div> </nav> </div> </div>'},this.joms.jst["html/postbox/status"]=function(t){var e,i="";_.escape,Array.prototype.join;return i+='<div class=joms-postbox-status> <div class=joms-postbox-fetched></div> <div class=joms-postbox-inputbox></div> <nav class="joms-postbox-tab selected"> <ul class="joms-list inline"> <li data-tab=mood><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-smiley"></use></svg></li> <li data-tab=location><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-location"></use></svg></li> <li data-tab=privacy><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-earth"></use></svg> </li> ',t.enablephoto&&(i+=' <li data-tab=photo data-bypass=1><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-camera"></use></svg></li> '),i+=" ",t.enablevideo&&(i+=' <li data-tab=video data-bypass=1><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-play"></use></svg></li> '),i+=" </ul> <div class=joms-postbox-action> <button class=joms-postbox-cancel>"+(null==(e=t.language.postbox.cancel_button)?"":e)+"</button> <button class=joms-postbox-save>"+(null==(e=t.language.postbox.post_button)?"":e)+'</button> </div> <div class=joms-postbox-loading style="display:none;"> <img src="'+(null==(e=t.juri.root)?"":e)+'components/com_community/assets/ajax-loader.gif" alt="loader"> <div> </nav> </div>'},this.joms.jst["html/postbox/video-item"]=function(t){var e,i="";_.escape;return i+='<li class=joms-postbox-photo-item> <img width=128 height=128 src="'+(null==(e=t.src)?"":e)+'"> <div class=joms-postbox-photo-action> <span class=joms-postbox-photo-setting><i class=joms-icon-cog></i></span> <span class=joms-postbox-photo-remove><i class=joms-icon-remove></i></span> </div> </li>'},this.joms.jst["html/postbox/video"]=function(t){var e,i="";_.escape,Array.prototype.join;return i+='<div> <div id=joms-postbox-video-upload style="position:absolute;top:0;left:0;width:1px;height:1px;overflow:hidden"> <button id=joms-postbox-video-upload-btn>Upload</button> </div> ',t&&t.enable_upload&&(i+=' <div class="joms-postbox-inner-panel joms-initial-panel"> <div class=joms-postbox-double-panel> <ul class="joms-list clearfix"> <li class=joms-postbox-video-url data-action=share><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-link"></use></svg> '+(null==(e=t.language.video.share_button)?"":e)+'</li> <li class=joms-postbox-video-upload data-action=upload><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-box-add"></use></svg> '+(null==(e=t.language.video.upload_button)?"":e)+" ",t&&t.video_maxsize>0&&(i+=" <span>"+(null==(e=t.language.video.upload_maxsize)?"":e)+" "+(null==(e=t.video_maxsize)?"":e)+"mb</span> "),i+=" </li> </ul> </div> </div> "),i+=' <div class=joms-postbox-video> <div class=joms-postbox-video-state-url style="display:none"> <div class=joms-postbox-inner-panel> <div class=joms-postbox-url></div> <div class=joms-postbox-fetched></div> </div> </div> ',t&&t.enable_upload&&(i+=' <div class=joms-postbox-video-state-upload style="display:none"> <div class=joms-postbox-inner-panel> <div class=joms-postbox-url></div> <div style="padding-top: 3px;"> <div class=joms-postbox-photo-progressbar style="position:relative;top:auto;bottom:auto;left:auto;right:auto;background-color:#eee;"> <div class=joms-postbox-photo-progress style="width:0"></div> </div> </div> <div style="padding-top: 10px;"> <div class="joms-fetched-category joms-select" style="padding:3px 0"></div> </div> </div> <div class=joms-postbox-inner-panel> <div class=inputbox> <input class=input placeholder="'+(null==(e=t.language.video.upload_title)?"":e)+'" /> </div> </div> </div> '),i+=' <div class=joms-postbox-inputbox></div> <nav class="joms-postbox-tab selected"> <ul class="joms-list inline"> <li data-tab=mood><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-smiley"></use></svg> <span class=visible-desktop>'+(null==(e=t.language.status.mood)?"":e)+'</span></li> <li data-tab=location><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-location"></use></svg> <span class=visible-desktop>'+(null==(e=t.language.video.location)?"":e)+'</span></li> <li data-tab=privacy><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-earth"></use></svg> <span class=visible-desktop></span></li> </ul> <div class=joms-postbox-action> <button class=joms-postbox-cancel>'+(null==(e=t.language.postbox.cancel_button)?"":e)+"</button> <button class=joms-postbox-save>"+(null==(e=t.language.postbox.post_button)?"":e)+'</button> </div> <div class=joms-postbox-loading style="display:none;"> <img src="'+(null==(e=t.juri.root)?"":e)+'components/com_community/assets/ajax-loader.gif" alt="loader"> <div> </nav> </div> </div>'},this.joms.jst["html/widget/select-album"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+="<span>"+(null==(e=t.placeholder||"")?"":e)+'</span> <ul class=joms-list style="display:none;"> ',t.options&&t.options.length)for(var s=0;s<t.options.length;s++)i+=' <li data-value="'+(null==(e=t.options[s][0])?"":e)+'"> <p style="margin:0">'+(null==(e=t.options[s]&&t.options[s][1]||"-")?"":e)+'</p> <small><i class="joms-icon-'+(null==(e=t.options[s]&&t.options[s][3]?""+t.options[s][3]:"globe")?"":e)+'"></i> '+(null==(e=t.options[s]&&t.options[s][2]?""+t.options[s][2]:"-")?"":e)+"</small> </li> ";return i+=' </ul><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-arrow-down"></use></svg>'},this.joms.jst["html/widget/select-form"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+="<span>"+(null==(e=t.placeholder||"")?"":e)+'</span> <ul class=joms-list style="display:none;"> ',t.options&&t.options.length)for(var s=0;s<t.options.length;s++)i+=' <li data-value="'+(null==(e=t.options[s][0])?"":e)+'">'+(null==(e=t.options[s][1])?"":e)+"</li> ";return i+=" </ul> <div>abc</div>"},this.joms.jst["html/widget/select"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+="<span>"+(null==(e=t.placeholder||"")?"":e)+'</span> <ul class=joms-list style="display:none;"> ',t.options&&t.options.length)for(var s=0;s<t.options.length;s++)i+=' <li data-value="'+(null==(e=t.options[s][0])?"":e)+'">'+(null==(e=t.options[s][1])?"":e)+"</li> ";return i+=' </ul><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-arrow-down"></use></svg>'},joms||(joms={}),joms.map={queue:[],execute:function(t){window.google&&window.google.maps&&window.google.maps.places?t():joms.map.loading?joms.map.queue.push(t):(joms.map.loading=!0,joms.map.queue.push(t),joms.map.loadScript())},loadScript:function(){var t=document.createElement("script");t.type="text/javascript",t.src="https://maps.googleapis.com/maps/api/js?libraries=places"+(window.joms_gmap_key?"&key="+window.joms_gmap_key:"")+"&callback=joms.map.loadScriptCallback",document.body.appendChild(t)},loadScriptCallback:function(){if(joms.map.queue&&joms.map.queue.length)for(;joms.map.queue.length;)joms.map.queue.shift()();joms.map.loading=!1}},function(){var requirejs,require,define;!function(t){function e(t,e){return f.call(t,e)}function i(t,e){var i,s,o,n,a,l,r,h,d,c,p,u=e&&e.split("/"),m=v.map,g=m&&m["*"]||{};if(t&&"."===t.charAt(0))if(e){for(u=u.slice(0,u.length-1),a=(t=t.split("/")).length-1,v.nodeIdCompat&&x.test(t[a])&&(t[a]=t[a].replace(x,"")),t=u.concat(t),d=0;d<t.length;d+=1)if("."===(p=t[d]))t.splice(d,1),d-=1;else if(".."===p){if(1===d&&(".."===t[2]||".."===t[0]))break;d>0&&(t.splice(d-1,2),d-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((u||g)&&m){for(d=(i=t.split("/")).length;d>0;d-=1){if(s=i.slice(0,d).join("/"),u)for(c=u.length;c>0;c-=1)if((o=m[u.slice(0,c).join("/")])&&(o=o[s])){n=o,l=d;break}if(n)break;!r&&g&&g[s]&&(r=g[s],h=d)}!n&&r&&(n=r,l=h),n&&(i.splice(0,l,n),t=i.join("/"))}return t}function s(e,i){return function(){return d.apply(t,b.call(arguments,0).concat([e,i]))}}function o(t){return function(e){return i(e,t)}}function n(t){return function(e){u[t]=e}}function a(i){if(e(m,i)){var s=m[i];delete m[i],g[i]=!0,h.apply(t,s)}if(!e(u,i)&&!e(g,i))throw new Error("No "+i);return u[i]}function l(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function r(t){return function(){return v&&v.config&&v.config[t]||{}}}var h,d,c,p,u={},m={},v={},g={},f=Object.prototype.hasOwnProperty,b=[].slice,x=/\.js$/;c=function(t,e){var s,n=l(t),r=n[0];return t=n[1],r&&(s=a(r=i(r,e))),r?t=s&&s.normalize?s.normalize(t,o(e)):i(t,e):(r=(n=l(t=i(t,e)))[0],t=n[1],r&&(s=a(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:s}},p={require:function(t){return s(t)},exports:function(t){var e=u[t];return void 0!==e?e:u[t]={}},module:function(t){return{id:t,uri:"",exports:u[t],config:r(t)}}},h=function(i,o,l,r){var h,d,v,f,b,x,w=[],y=typeof l;if(r=r||i,"undefined"===y||"function"===y){for(o=!o.length&&l.length?["require","exports","module"]:o,b=0;b<o.length;b+=1)if(f=c(o[b],r),"require"===(d=f.f))w[b]=p.require(i);else if("exports"===d)w[b]=p.exports(i),x=!0;else if("module"===d)h=w[b]=p.module(i);else if(e(u,d)||e(m,d)||e(g,d))w[b]=a(d);else{if(!f.p)throw new Error(i+" missing "+d);f.p.load(f.n,s(r,!0),n(d),{}),w[b]=u[d]}v=l?l.apply(u[i],w):void 0,i&&(h&&h.exports!==t&&h.exports!==u[i]?u[i]=h.exports:v===t&&x||(u[i]=v))}else i&&(u[i]=l)},requirejs=require=d=function(e,i,s,o,n){if("string"==typeof e)return p[e]?p[e](i):a(c(e,i).f);if(!e.splice){if((v=e).deps&&d(v.deps,v.callback),!i)return;i.splice?(e=i,i=s,s=null):e=t}return i=i||function(){},"function"==typeof s&&(s=o,o=n),o?h(t,e,i,s):setTimeout(function(){h(t,e,i,s)},4),d},d.config=function(t){return d(t)},requirejs._defined=u,(define=function(t,i,s){i.splice||(s=i,i=[]),e(u,t)||e(m,t)||(m[t]=[t,i,s])}).amd={jQuery:!0}}(),define("libs/almond",function(){}),define("sandbox",[],function(){function t(t,i){return e(t,i)}var e=window.joms.jQuery,i=window.joms._,s=window.joms.Backbone;s.$=e,i.pick(i,["each","map","filter","union","intersection","without","bind","debounce","defer","keys","extend","pick","omit","isArray","isNumber","isString","isUndefined","uniqueId"]),i.extend(t,s.Events,i,{mvc:{Model:s.Model,Models:s.Collection,View:s.View},ajax:e.ajax,param:e.param,noop:function(){}}),t.__extend=t.extend,t._$extend=e.extend,t.extend=function(){return t[!0===arguments[0]?"_$extend":"__extend"].apply(null,arguments)};var o=(t.ua=navigator.userAgent).toLowerCase();return t.mobile=!!o.match(/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i),t.webkit=!!o.match(/webkit/i),t.ie=!!o.match(/msie/i),t.ieVersion=t.ie&&+o.match(/msie (\d+)\./i)[1],t.xpriment=!t.ie&&1,t(document.body).on("click",function(e){t.trigger("click",t(e.target))}),t}),define("views/base",["sandbox"],function(t){return t.mvc.View.extend({assign:function(e,i){t.isArray(e)||(e=[[e,i]]),t.each(e,function(t){t[1].setElement(t[0]).render()})},show:function(){this.isHidden()&&(this.$el.show(),this.trigger("show"))},hide:function(){this.isHidden()||(this.$el.hide(),this.trigger("hide"))},toggle:function(){this.isHidden()?this.show():this.hide()},isHidden:function(){return"none"===this.el.style.display}})}),define("app",[],function(){var t;return t=window.joms_script_url||"",t=t.replace(/js\/$/,""),{staticUrl:t,legacyUrl:t+"../../"}}),define("utils/ajax",["sandbox"],function(t){function e(e,i){var s={};s.option="community",s.view=window.joms_page||void 0,s.task="azrul_ajax",s.func=e,s.no_html=1,s[window.jax_token_var]=1,t.isArray(i)||(i=[]);for(var o,n=0;n<i.length;n++)o=i[n],t.isString(o)&&(o=o.replace(/"/g,"&quot;")),t.isArray(o)||(o=["_d_",o]),s["arg"+(n+2)]=JSON.stringify(o);return s}var i={type:"post",data:{},dataType:"json",error:t.noop,success:t.noop,complete:t.noop};return function(s){return s=t.extend({},i,s||{}),s.url=window.jax_live_site,s.data=e(s.fn,s.data),t.ajax(s)}}),define("utils/constants",["sandbox"],function(t){var e={};return{get:function(i){if("string"==typeof i&&i.length){joms&&joms.constants&&(t.extend(!0,e,joms&&joms.constants),delete joms.constants);var s=e;for(i=i.split(".");i.length;)s=s[i.shift()];return s}},set:function(t,i){var s,o;if("string"==typeof t&&t.length){for(s=e,o=t.split("."),t.length;o.length-1;)s[t=o.shift()]||(s[t]={}),s=s[t];s[t]=i}}}}),define("views/postbox/default",["sandbox","app","views/base","utils/ajax","utils/constants"],function(t,e,i,s,o){return i.extend({subviews:{},template:function(){throw new Error("Method not implemented.")},events:{"click li[data-tab]":"onToggleDropdown","click button.joms-postbox-cancel":"onCancel","click button.joms-postbox-save":"onPost"},initialize:function(t){t&&t.single&&(this.single=!0),this.subflags={},this.reset()},render:function(){var t=this.getTemplate();return this.$el.replaceWith(t),this.setElement(t),this.$tabs=this.$(".joms-postbox-tab"),this.$action=this.$(".joms-postbox-action").hide(),this.$loading=this.$(".joms-postbox-loading").hide(),this.$save=this.$(".joms-postbox-save").hide(),this},show:function(){this.showInitialState(),i.prototype.show.apply(this)},showInitialState:function(){this.reset(),this.$tabs.hide(),this.$action.hide(),this.$save.hide(),this.trigger("show:initial")},showMainState:function(){this.$tabs.show(),this.$action.show(),this.trigger("show:main")},reset:function(){this.data={},this.data.text="",this.data.attachment={};for(var t in this.subflags)this.subviews[t].reset(),this.subviews[t].hide()},value:function(e){var i=t.extend({},this.getStaticAttachment(),this.data.attachment);return[this.data.text,e?i:JSON.stringify(i)]},validate:t.noop,onToggleDropdown:function(e){var i=t(e.currentTarget);if(!i.data("bypass")){var s=i.data("tab");if(this.subviews[s])if(this.subflags[s]||this.initSubview(s),this.subviews[s].isHidden()){for(var o in this.subflags)o!==s&&this.subviews[o].hide();this.subviews[s].show()}else this.subviews[s].hide()}},onCancel:function(){e.postbox&&e.postbox.value&&(e.postbox.value=!1),this.saving||this.showInitialState()},onPost:function(){if(!this.saving){var e=this.validate();if(e)window.alert(e);else{this.saving=!0,this.$loading.show();var i=this,o=this.value();window.joms_filter_params&&o.push(JSON.stringify(window.joms_filter_params)),window.joms_postbox_posting=!0,s({fn:"system,ajaxStreamAdd",data:o,success:t.bind(this.onPostSuccess,this),complete:function(){window.joms_postbox_posting=!1,i.$loading.hide(),i.saving=!1,i.showInitialState()}})}}},onPostSuccess:function(e){var i=this.parseResponse(e);i&&(t(".joms-stream__wrapper").first().html(i),t.trigger("postbox:status"),window.joms&&joms.view&&joms.view.streams&&(joms.view.streams.start(),joms.view.misc.fixSVG()))},initSubview:function(t,e){var i=t.replace(/^./,function(t){return t.toUpperCase()});this.subflags[t]||(this.subviews[t]=new this.subviews[t](e),this.assign(this.getSubviewElement(),this.subviews[t]),this.listenTo(this.subviews[t],"init",this["on"+i+"Init"]),this.listenTo(this.subviews[t],"show",this["on"+i+"Show"]),this.listenTo(this.subviews[t],"hide",this["on"+i+"Hide"]),this.listenTo(this.subviews[t],"select",this["on"+i+"Select"]),this.listenTo(this.subviews[t],"remove",this["on"+i+"Remove"]),this.subflags[t]=!0)},getSubviewElement:function(){return t("<div>").hide().appendTo(this.$el)},parseResponse:function(e){var i,s;if(e.html)return e.html;if(e&&e.length)for(var o=0;o<e.length;o++)"__throwError"===e[o][1]&&(s=e[o][3],window.alert(t.isArray(s)?s.join(". "):s)),i||"activity-stream-container"!==e[o][1]||(i=e[o][3]);return i},getTemplate:function(){var e=this.template({juri:o.get("juri")});return t(e).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},o.get("postbox.attachment")||{},{type:""}),this.staticAttachment)}})}),define("utils/image",[],function(){function t(t,e){this.images=[],this.loaded=[],this.processed=0,this.callback=e,t&&t.length||(t=[]);for(var i=/^(http:|https:)?\/\/([a-z0-9-]+\.)+[a-z]{2,18}\/.*$/i,s=0;s<t.length;s++)t[s].match(i)&&this.images.push(t[s])}return t.prototype.load=function(){if(this.images&&this.images.length)for(var t,e=0;e<this.images.length;e++)(t=new Image).onload=this.onload,t.onerror=this.onerror,t.onabort=this.onabort,t.preloader=this,t.src=t._src=this.images[e];else this.callback([])},t.prototype.onload=function(){this.preloader.loaded.push(this._src),this.preloader.oncomplete()},t.prototype.onerror=function(){this.preloader.oncomplete()},t.prototype.onabort=function(){this.preloader.oncomplete()},t.prototype.oncomplete=function(){var t,e=[];if(++this.processed>=this.images.length){for(t=0;t<this.images.length;t++)this.loaded.indexOf(this.images[t])>-1&&e.push(this.images[t]);this.callback(e)}},{preload:function(e,i){new t(e,i).load()}}}),define("utils/language",["sandbox"],function(t){var e={};return{get:function(i){if("string"==typeof i&&i.length){joms&&joms.language&&(t.extend(!0,e,joms&&joms.language),delete joms.language);var s=e;for(i=i.split(".");i.length;)s=s[i.shift()];return s}}}}),define("views/postbox/fetcher",["sandbox","views/base","utils/ajax","utils/image","utils/language"],function(t,e,i,s,o){return e.extend({template:joms.jst["html/postbox/fetcher"],events:{"click .joms-fetched-close":"onClose","click .joms-fetched-field span":"onFocus","keyup .joms-fetched-field input":"onKeyup","keyup .joms-fetched-field textarea":"onKeyup","blur .joms-fetched-field input":"onBlur","blur .joms-fetched-field textarea":"onBlur","click .joms-fetched-previmg":"prevImage","click .joms-fetched-nextimg":"nextImage"},initialize:function(){var t=o.get("fetch")||{};this.titlePlaceholder=t.title_hint||"",this.descPlaceholder=t.description_hint||""},fetch:function(e){var s=/^(|.*\s)((https?:\/\/|www\.)([a-z0-9-]+\.)+[a-z]{2,18}(:\d+)?(\/.*)?)(\s.*|)$/i,o=e.match(s);!this.fetching&&o&&(e=o[2],this.fetching=!0,this.fetched=!1,delete this.url,this.trigger("fetch:start"),i({fn:"system,ajaxGetFetchUrl",data:[e],success:t.bind(this.render,this),complete:t.noop}))},render:function(e){e||(e={}),this.fetched=!0,this.url=e.url||"";var i={title:e.title||"",titlePlaceholder:this.titlePlaceholder,description:e.description||"",descPlaceholder:this.descPlaceholder,image:(e.image||[]).concat(e["og:image"]||[]),lang:{prev:(o.get("prev")||"").toLowerCase(),next:(o.get("next")||"").toLowerCase(),cancel:(o.get("cancel")||"").toLowerCase()}};this.url.match(/^https?:\/\//i)||(this.url="http://"+this.url);for(var n=0;n<i.image.length;n++)i.image[n].match(/^(http:|https:)?\/\//i)||(i.image[n]="//"+i.image[n]);s.preload(i.image,t.bind(function(t){i.image=t,this.$el.html(this.template(i)),this.$images=this.$(".joms-fetched-images").find("img"),this.$title=this.$(".joms-fetched-title").find("input"),this.$description=this.$(".joms-fetched-description").find("textarea"),this.fetching=!1,this.trigger("fetch:done")},this))},change:function(e){var i=t(e),s=i.prev("span"),o=i.val().replace(/^\s+|\s+$/g,"");o||(o=i.parent().hasClass("joms-fetched-title")?this.titlePlaceholder:this.descPlaceholder),i.hide(),s.text(o).show()},remove:function(){delete this.url,e.prototype.remove.apply(this),this.trigger("remove")},prevImage:function(){var t=this.$images.filter(":visible"),e=t.prev();e.length&&(t.hide(),e.show())},nextImage:function(){var t=this.$images.filter(":visible"),e=t.next();e.length&&(t.hide(),e.show())},value:function(){if(!this.fetching&&this.url)return[this.url,this.$images&&this.$images.filter(":visible").attr("src"),this.$title&&this.escapeValue(this.$title.val()),this.$description&&this.escapeValue(this.$description.val())]},onClose:function(){this.remove()},onFocus:function(e){var i=t(e.currentTarget),s=i.next("input,textarea");i.hide(),s.show(),setTimeout(function(){s[0].focus()},300)},onKeyup:function(t){13===t.keyCode&&this.change(t.currentTarget)},onBlur:function(t){this.change(t.currentTarget)},parseResponse:function(t){if(t=t&&t[2]&&t[2][3]&&t[2][3][0]||!1){var e;try{e=JSON.parse(t)}catch(t){}return e}},escapeValue:function(t){return"string"!=typeof t?t:t.replace(/\\/g,"&#92;").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/&quot;/g,'"')}})}),define("views/inputbox/base",["sandbox","views/base","utils/constants"],function(t,e,i){return e.extend({events:{"focus textarea":"onFocus","keydown textarea":"onKeydownProxy","input textarea":"onInput","paste textarea":"onPaste","blur textarea":"onBlur"},initialize:function(e){t.mobile||(this.onInput=this.onKeydown,this.onKeydownProxy=this.onKeydown,this.updateCharCounterProxy=this.updateCharCounter),e||(e={}),this.flags={},this.flags.attachment=e.attachment,this.flags.charcount=e.charcount,this.listenTo(t,"postbox:tab:change",this.reset)},render:function(){this.$mirror=this.$("span.input"),this.$textarea=this.$("textarea.input"),this.placeholder=this.$textarea.attr("placeholder"),this.flags.attachment&&(this.$attachment=t("<span class=attachment>").insertAfter(this.$mirror)),this.reset()},set:function(t){this.$textarea.val(t),this.flags.attachment&&this.updateAttachment(),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},reset:function(){this.$textarea.val(""),this.flags.attachment&&this.updateAttachment(),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},value:function(){var t=this.$textarea[0];return(t.joms_hidden?t.joms_hidden.val():t.value).replace(/\t/g,"\\t").replace(/%/g,"%25")},onFocus:function(){this.trigger("focus")},onKeydown:function(e){if(void 0===this.maxchar&&(this.maxchar=+i.get("conf.statusmaxchar")||0),this.value().length>=this.maxchar&&this.isPrintable(e))e.preventDefault();else{var s=this;t.defer(function(){s.updateInput(e)})}},onKeydownProxy:t.debounce(function(t){this.onKeydown(t)},10),onInput:function(){this.onKeydownProxy()},onPaste:function(){var t=this;this.onKeydownProxy(function(){t.trigger("paste",t.$textarea[0].value,13)})},onBlur:function(){this.trigger("blur",this.$textarea[0].value,13)},updateInput:function(t){var e=t&&t.keyCode||!1,s=this.$textarea[0],o=s.value;""===o.replace(/^\s+|\s+$/g,"")&&(s.value=o=""),void 0===this.maxchar&&(this.maxchar=+i.get("conf.statusmaxchar")||0),o.length>this.maxchar&&(s.value=o=o.substr(0,this.maxchar)),this.$mirror.html(this.normalize(o)+"."),this.$textarea.css("height",this.$mirror.height()),this.flags.charcount&&this.updateCharCounterProxy(),this.trigger("keydown",o,e),"function"==typeof t&&t()},updateAttachment:t.noop,updateCharCounterProxy:t.debounce(function(){this.updateCharCounter()},300),updateCharCounter:function(){void 0===this.maxchar&&(this.maxchar=+i.get("conf.statusmaxchar")||0),this.$charcount||(this.$charcount=this.$(".charcount")),!this.maxchar||this.maxchar<=0?this.$charcount.hide():this.$charcount.html(this.maxchar-this.$textarea[0].value.length).show()},isPrintable:function(t){if(!t)return!1;if((t.crtlKey||t.metaKey)&&!t.altKey&&!t.shiftKey)return!1;var e=t&&t.keyCode;return 13===e||32===e||e>47&&e<58||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223},normalize:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")},resetTextntags:function(e,i){try{(e=t(e)).removeData("joms-tagging"),e.val(i).jomsTagging(),e.data("joms-tagging").initialize()}catch(t){}}})}),define("views/inputbox/status",["sandbox","views/inputbox/base","utils/constants","utils/language"],function(t,e,i,s){return e.extend({template:joms.jst["html/inputbox/status"],initialize:function(){var t,s,o,n;if(e.prototype.initialize.apply(this,arguments),this.moods=i.get("moods"),t={},this.moods&&this.moods.length)for(n=0;n<this.moods.length;n++)s=[o=this.moods[n].id,this.moods[n].description],this.moods[n].custom&&(s[2]=this.moods[n].image),t[o]=s;this.moods=t},render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},set:function(t){this.resetTextntags(this.$textarea,t),this.flags.attachment&&this.updateAttachment(!1,!1),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},reset:function(){this.resetTextntags(this.$textarea,""),this.flags.attachment&&this.updateAttachment(!1,!1),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},value:function(){var t=this.$textarea[0];return(t.joms_hidden?t.joms_hidden.val():t.value).replace(/\t/g,"\\t").replace(/%/g,"%25")},updateInput:function(){e.prototype.updateInput.apply(this,arguments)},updateAttachment:function(t,e){var i=[];if(this.mood=t||!1===t?t:this.mood,this.location=e||!1===e?e:this.location,this.location&&this.location.name&&i.push("<b>"+s.get("at")+" "+this.location.name+"</b>"),this.mood&&this.moods[this.mood]&&(void 0!==this.moods[this.mood][2]?i.push('<img class="joms-emoticon" src="'+this.moods[this.mood][2]+'"> <b>'+this.moods[this.mood][1]+"</b>"):i.push('<i class="joms-emoticon joms-emo-'+this.mood+'"></i> <b>'+this.moods[this.mood][1]+"</b>")),!i.length)return this.$attachment.html(""),void this.$textarea.attr("placeholder",this.placeholder);this.$attachment.html(" &nbsp;&mdash; "+i.join(" "+s.get("and")+" ")+"."),this.$textarea.removeAttr("placeholder")},getTemplate:function(){var e=s.get("status.status_hint")||"",i=this.template({placeholder:e});return t(i)}})}),define("views/dropdown/base",["sandbox","views/base"],function(t,e){return e.extend({initialize:function(){this.listenTo(t,"click",this._onDocumentClick)},_onDocumentClick:function(t){t.closest(".joms-postbox").length||this.hide()}})}),define("views/dropdown/mood",["sandbox","views/dropdown/base","utils/constants","utils/language"],function(t,e,i,s){return e.extend({template:joms.jst["html/dropdown/mood"],events:{"click li":"onSelect","click .joms-remove-button":"onRemove"},render:function(){var e,o,n,a,l,r,h;if(this.moods=i.get("moods"),e=[],o={},this.moods&&this.moods.length)for(h=0;h<this.moods.length;h++)a=[n=this.moods[h].id,this.moods[h].title],this.moods[h].custom&&(a[2]=this.moods[h].image),e.push(a),o[n]=a;return this.moods=o,l=this.template({items:e,language:{status:s.get("status")||{}}}),r=t(l).hide(),this.$el.replaceWith(r),this.setElement(r),this.$btnremove=this.$(".joms-remove-button").hide(),this},select:function(t){this.moods[t]&&(this.$btnremove.show(),this.trigger("select",this.mood=t))},value:function(){return this.mood},reset:function(){this.mood=!1,this.$btnremove.hide(),this.trigger("reset")},onSelect:function(e){var i=t(e.currentTarget).attr("data-mood");this.select(i),this.hide()},onRemove:function(){this.mood=!1,this.$btnremove.hide(),this.trigger("remove")}})}),define("views/dropdown/location",["sandbox","views/dropdown/base","utils/language"],function(t,e,i){var s=i.get("geolocation")||{};return e.extend({template:{div:joms.jst["html/dropdown/location"],list:joms.jst["html/dropdown/location-list"]},placeholders:{loading:s.loading||"",loaded:s.loaded||"",error:s.error||""},initialize:function(){e.prototype.initialize.apply(this),this.location=!1,this.locations={},this.nearbyLocations=!1,this.listenTo(t,"postbox:tab:change",this.onRemove)},events:{"keyup input.joms-postbox-keyword":"onKeyup","click li":"onSelect","click button.joms-add-location":"onAdd","click button.joms-remove-location":"onRemove"},render:function(){this.$el.html(this.getTemplate()),this.$keyword=this.$(".joms-postbox-keyword"),this.$list=this.$(".joms-postbox-locations"),this.$map=this.$(".joms-postbox-map"),this.$btnadd=this.$(".joms-add-location").hide(),this.$btnremove=this.$(".joms-remove-location").hide(),this.$keyword.attr("placeholder",this.placeholders.loading);var t=this;return this.getService(function(){t.setInitialLocation=!0,t.searchLocation()}),this},show:function(){this.$el.show(),this.trigger("show")},hide:function(){this.$el.hide(),this.trigger("hide")},toggle:function(){"none"===this.el.style.display?this.show():this.hide()},filter:function(t){return},draw:function(t){var e=this.template.list({language:{geolocation:i.get("geolocation")},items:t});this.filtered=t,this.$list.html(e).css({height:"160px",overflowY:"auto"}),this.setInitialLocation&&(this.setInitialLocation=!1,this.select(0))},select:function(t){var e=this.filtered[t];e&&(this.location=e,this.$map.show(),this.$keyword.val(e.name),this.map&&this.marker&&this.marker.setMap(this.map),this.showMap(e.latitude,e.longitude),this.$btnadd.show(),this.$btnremove.hide())},value:function(){var t=[];return!!this.location&&(t.push(this.location.name),t.push(this.location.latitude),t.push(this.location.longitude),t)},reset:function(){this.location=!1,this.marker&&this.marker.setMap(null),this.$keyword.val(""),this.$btnadd.hide(),this.$btnremove.hide(),this.trigger("reset")},onKeyup:t.debounce(function(){this.service&&this.searchLocation()},300),onSelect:function(e){var i=t(e.currentTarget).attr("data-index");this.select(+i)},onAdd:function(){this.location&&(this.trigger("select",this.location),this.$btnadd.hide(),this.$btnremove.show(),this.hide())},onRemove:function(){this.reset(),this.trigger("remove"),this.hide(),this.filter()},initMap:function(e,i){var s=t("<div>").prependTo(this.$map);s.css("height",110);var o={center:new google.maps.LatLng(1,1),zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAD,mapTypeControl:!1,disableDefaultUI:!0,draggable:!1,scaleControl:!1,scrollwheel:!1,navigationControl:!1,streetViewControl:!1,disableDoubleClickZoom:!0};this.map=new google.maps.Map(s[0],o),this.marker=new google.maps.Marker({draggable:!1,map:this.map}),this.marker.setAnimation(null)},showMap:function(t,e){var i=new google.maps.LatLng(t,e);this.marker.setPosition(i),this.map.panTo(i)},getService:function(t){var e;"function"!=typeof t&&(t=function(){}),this.service?t.call(this,this.service):(e=this,joms.map.execute(function(){e.initMap(),e.service=new google.maps.places.PlacesService(e.map),t.call(e,e.service)}))},searchLocation:function(){var t=this.$keyword.val().replace(/^\s+|\s+$/g,"");this.$keyword.attr("placeholder",this.placeholders.loading),this.searchToken=(this.searchToken||0)+1,this[t?"searchLocationQuery":"searchLocationNearby"]({query:t,token:this.searchToken,callback:this.searchLocationCallback})},searchLocationQuery:function(e){var i;this.locations[e.query]?e.callback.apply(this,[this.locations[e.query],null,e]):(i=this,this.service.textSearch({query:e.query},function(s,o){if(o===google.maps.places.PlacesServiceStatus.OK)if(t.isArray(s)){for(var n,a=0,l=[];a<s.length;a++)n=s[a],l.push({name:n.name,latitude:n.geometry.location.lat(),longitude:n.geometry.location.lng(),vicinity:n.formatted_address});i.locations[e.query]=l,e.callback.apply(i,[i.locations[e.query],null,e])}else e.callback.apply(i,[null,i.placeholders.error,e]);else e.callback.apply(i,[null,i.placeholders.error,e])}))},searchLocationNearby:function(t){var e=this;navigator.geolocation.getCurrentPosition(function(i){e.detectLocationSuccess(i,t)},function(){e.detectLocationFallback(t)},{timeout:1e4})},searchLocationCallback:function(t,e,i){this.searchToken===i.token&&(this.$keyword.attr("placeholder",this.placeholders.loaded),this.draw(t))},detectLocationSuccess:function(t,e){var i=t&&t.coords||{},s=i.latitude,o=i.longitude;s&&o?this.detectLocationNearby(s,o,e):e.callback.apply(this,[null,this.placeholders.error,e])},detectLocationFallback:function(e){var i=!1,s=this;t.ajax({url:"//freegeoip.net/json/",dataType:"jsonp",success:function(t){var o=t.latitude,n=t.longitude;o&&n&&(i=!0,s.detectLocationNearby(o,n,e))},complete:function(){i||e.callback.apply(s,[null,s.placeholders.error,e])}})},detectLocationNearby:function(e,i,s){var o,n;this.nearbyLocations?s.callback.apply(this,[this.nearbyLocations,null,s]):(o={location:new google.maps.LatLng(e,i),types:["establishment"],rankBy:google.maps.places.RankBy.DISTANCE},n=this,this.service.nearbySearch(o,function(e,i){if(i===google.maps.places.PlacesServiceStatus.OK)if(t.isArray(e)){for(var o,a=0,l=[];a<e.length;a++)o=e[a],l.push({name:o.name,latitude:o.geometry.location.lat(),longitude:o.geometry.location.lng(),vicinity:o.vicinity});n.nearbyLocations=l,s.callback.apply(n,[n.nearbyLocations,null,s])}else s.callback.apply(n,[null,n.placeholders.error,s]);else s.callback.apply(n,[null,n.placeholders.error,s])}))},getTemplate:function(){return this.template.div({language:{geolocation:i.get("geolocation")||{}}})}})}),define("views/dropdown/privacy",["sandbox","views/dropdown/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/dropdown/privacy"],events:{"click li":"select"},privacies:{public:[10,"earth"],site_members:[20,"users"],friends:[30,"user"],me:[40,"lock"]},privmaps:{public:"10",site_members:"20",friends:"30",me:"40",0:"public",10:"public",20:"site_members",30:"friends",40:"me"},initialize:function(s){e.prototype.initialize.apply(this),this.privkeys=t.keys(this.privacies),s&&s.privacylist&&s.privacylist.length&&(this.privkeys=t.intersection(this.privkeys,s.privacylist));var o=i.get("privacy")||{};for(var n in this.privacies)this.privacies[n][2]=o[n]||n,this.privacies[n][3]=o[n+"_desc"]||n;this.defaultPrivacy=this.privkeys[0],void 0!==s.defaultPrivacy&&(s.defaultPrivacy=""+s.defaultPrivacy,s.defaultPrivacy.match(/^\d+$/)&&(s.defaultPrivacy=this.privmaps[s.defaultPrivacy]||this.defaultPrivacy),this.privkeys.indexOf(s.defaultPrivacy)>=0&&(this.defaultPrivacy=s.defaultPrivacy))},render:function(){for(var t,e=[],i=0;i<this.privkeys.length;i++)t=this.privkeys[i],e[i]=[t,this.privacies[t][1],this.privacies[t][2],this.privacies[t][3]];return this.$el.html(this.template({items:e})),this.setPrivacy(this.defaultPrivacy),this},select:function(e){var i=t(e.currentTarget).attr("data-priv");this.setPrivacy(i),this.hide()},setPrivacy:function(t){var e={};this.privkeys.indexOf(t)>=0&&(this.privacy=this.privacies[t][0],e.icon=this.privacies[t][1],e.label=this.privacies[t][2].toLowerCase(),this.trigger("select",e))},value:function(){return this.privacy},reset:function(){this.setPrivacy(this.defaultPrivacy)}})}),define("views/postbox/status",["sandbox","app","views/postbox/default","views/postbox/fetcher","views/inputbox/status","views/dropdown/mood","views/dropdown/location","views/dropdown/privacy","utils/constants","utils/language"],function(t,e,i,s,o,n,a,l,r,h){return i.extend({subviews:{mood:n,location:a,privacy:l},template:joms.jst["html/postbox/status"],events:t.extend({},i.prototype.events,{"click li[data-tab=photo]":"onAddPhoto","click li[data-tab=video]":"onAddVideo"}),initialize:function(){var e=r.get("settings")||{};(this.inheritPrivacy=e.isGroup||e.isEvent||!e.isMyProfile)&&(this.subviews=t.omit(this.subviews,"privacy"));var s=r.get("moods");this.enableMood=+r.get("conf.enablemood")&&s&&s.length,this.enableMood||(this.subviews=t.omit(this.subviews,"mood")),this.enableLocation=+r.get("conf.enablelocation"),this.enableLocation||(this.subviews=t.omit(this.subviews,"location")),i.prototype.initialize.apply(this)},render:function(){i.prototype.render.apply(this),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$fetcher=this.$(".joms-postbox-fetched"),this.$tabmood=this.$tabs.find("[data-tab=mood]"),this.$tablocation=this.$tabs.find("[data-tab=location]"),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.enableMood||this.$tabmood.remove(),this.enableLocation||this.$tablocation.remove(),this.inheritPrivacy&&(this.$tabprivacy.next().length?this.$tabprivacy.remove():this.$tabprivacy.css({visibility:"hidden"})),this.inputbox=new o({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus),this.listenTo(this.inputbox,"keydown",this.onInputUpdate),this.listenTo(this.inputbox,"paste",this.onInputUpdate);var e,s;return this.inheritPrivacy||((s=r.get("settings")||{}).isProfile&&s.isMyProfile&&(e=r.get("conf.profiledefaultprivacy")),this.initSubview("privacy",{privacylist:window.joms_privacylist,defaultPrivacy:e||"public"})),this.single&&this.listenTo(t,"click",this.onDocumentClick),this},reset:function(){i.prototype.reset.apply(this),this.inputbox&&this.inputbox.reset(),this.fetcher&&this.fetcher.remove()},value:function(){this.data.text=this.inputbox.value()||"",this.data.attachment={},this.data.text=this.data.text.replace(/\n/g,"\\n");var t;for(var e in this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);return this.fetcher&&(this.data.attachment.fetch=this.fetcher.value()),i.prototype.value.apply(this,arguments)},validate:t.noop,onInputFocus:function(){this.showMainState()},onInputUpdate:function(t,e){t=t||"",this.togglePostButton(t),32===e||13===e?this.fetch(t):this.fetchProxy(t)},fetchProxy:t.debounce(function(t){this.fetch(t)},1e3),fetch:function(e){var i;this.fetcher&&(this.fetcher.fetching||this.fetcher.fetched)||(this.fetcher&&this.fetcher.remove(),i=t("<div>").appendTo(this.$fetcher),this.fetcher=new s,this.fetcher.setElement(i),this.listenTo(this.fetcher,"fetch:start",this.onFetchStart),this.listenTo(this.fetcher,"fetch:done",this.onFetchDone),this.listenTo(this.fetcher,"remove",this.onFetchRemove),this.fetcher.fetch(e.replace(/^\s+|\s+$/g,"")))},onFetchStart:function(){this.saving=!0,this.$loading.show()},onFetchDone:function(){this.$loading.hide(),this.saving=!1},onFetchRemove:function(){this.fetcher=!1},onDocumentClick:function(t){if(!t.closest(".joms-postbox").length){var e=this.inputbox.value();(e=e.replace(/^\s+|\s+$/g,""))||this.showInitialState()}},onMoodSelect:function(t){this.inputbox.updateAttachment(t),this.togglePostButton()},onMoodRemove:function(){this.inputbox.updateAttachment(!1),this.togglePostButton()},onLocationSelect:function(t){this.inputbox.updateAttachment(null,t),this.togglePostButton()},onLocationRemove:function(){this.inputbox.updateAttachment(null,!1),this.togglePostButton()},onPrivacySelect:function(t){var e=this.$tabprivacy.find("use").attr("xlink:href");e=e.replace(/#.+$/,"#joms-icon-"+t.icon),this.$tabprivacy.find("use").attr("xlink:href",e),this.$tabprivacy.find("span").html(t.label)},onAddPhoto:function(){e.postbox||(e.postbox={}),e.postbox.value=this.value(!0),e.postbox.value[0]=e.postbox.value[0].replace(/\\n/g,"\n"),t.trigger("postbox:photo")},onAddVideo:function(){e.postbox||(e.postbox={}),e.postbox.value=this.value(!0),e.postbox.value[0]=e.postbox.value[0].replace(/\\n/g,"\n"),t.trigger("postbox:video")},getTemplate:function(){var e=r.get("settings")||{},i=r.get("conf")||{},s=!0,o=!0;(e.isProfile||e.isGroup||e.isEvent)&&(i.enablephotos||(s=!1),i.enablevideos||(o=!1));var n=this.template({juri:r.get("juri"),enablephoto:s,enablevideo:o,language:{postbox:h.get("postbox")||{},status:h.get("status")||{}}});return t(n).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},r.get("postbox.attachment")||{},{type:"message"}),this.staticAttachment)},togglePostButton:function(t){var e=!1;t&&(e=!0),!e&&this.subflags.mood&&(e=this.subviews.mood.value()),!e&&this.subflags.location&&(e=this.subviews.location.value()),this.$save[e?"show":"hide"]()}})}),define("views/widget/select",["sandbox","views/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/widget/select"],events:{"click span":"toggle","click li":"onSelect"},initialize:function(t){this.options=t.options||[],+t.width&&(this.width=+t.width+"px")},render:function(){var t={};t.options=this.options,t.width=this.width||!1,t.placeholder=i.get("select_category"),this.$el.html(this.template(t)),this.$span=this.$("span"),this.$ul=this.$("ul"),t.options&&t.options.length>6&&this.$ul.css({height:"175px",overflowY:"auto"})},select:function(t,e){this.$span.html(e),this.$span.data("value",t),this.trigger("select",t,e)},toggle:function(){this.$ul.toggle()},value:function(){return this.$span.data("value")},reset:function(){this.$ul&&this.$ul.hide(),this.options&&this.options.length&&(this.$span.html(this.options[0][1]),this.$span.data("value",this.options[0][0]))},onSelect:function(e){var i=t(e.currentTarget),s=i.data("value"),o=i.html();this.select(s,o),this.toggle()}})}),define("views/widget/select-album",["sandbox","views/widget/select","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/widget/select-album"],render:function(){var t={};t.options=this.options,t.width=this.width||!1,t.placeholder=i.get("select_category"),this.$el.html(this.template(t)),this.$span=this.$("span"),this.$ul=this.$("ul"),t.options&&(t.options.length>3&&this.$ul.css({height:"160px",overflowY:"auto"}),t.options[0]&&this.select(t.options[0][0],t.options[0][1]))},onSelect:function(e){var i=t(e.currentTarget),s=i.data("value"),o=i.find("p").html();this.select(s,o),this.toggle()}})}),define("views/postbox/photo-preview",["sandbox","app","views/base","views/widget/select-album","utils/ajax","utils/constants","utils/language"],function(t,e,i,s,o,n,a){return i.extend({templates:{div:joms.jst["html/postbox/photo-preview"],img:joms.jst["html/postbox/photo-item"]},events:{"click .joms-postbox-photo-remove":"onRemove"},render:function(){this.$el.html(this.templates.div()),this.$list=this.$("ul"),this.$form=this.$("div.joms-postbox-photo-form")},add:function(i){if(this.$list.append(this.templates.img({id:this.getFileId(i),src:e.legacyUrl+"/assets/photo-upload-placeholder.png"})),(n.get("settings")||{}).isMyProfile&&!this.select){var o=n.get("album"),l=a.get("privacy"),r=[],h={0:"public",10:"public",20:"site_members",30:"friends",40:"me"},d={0:"earth",10:"public",20:"users",30:"user",40:"lock"};if(o&&o.length){this.albummap={};for(var c,p,u=0;u<o.length;u++)p=""+(c=o[u]).permissions,this.albummap[""+c.id]=p,r[+(c=[c.id,c.name,l[h[p]||"0"],d[p||"0"]]).default?"unshift":"push"](c);this.select=new s({options:r});var m=t('<div class="joms-postbox-select-album joms-select" style="padding:3px 0">').insertAfter(this.$form);this.assign(m,this.select)}}},value:function(){var t,e=n.get("settings")||{};return t={id:this.pics||[]},this.select&&e.isMyProfile&&(t.album_id=""+this.select.value(),t.privacy=this.albummap[void 0]),t},updateProgress:function(t){var e,i=this.getFileId(t),s=this.$list.find("#"+i).find(".joms-postbox-photo-progress");s&&s.length&&(e=Math.min(100,Math.floor(t.loaded/t.size*100)),s.stop().animate({width:e+"%"}))},setImage:function(t,e){e||(e={});var i=this.$list.find("#"+this.getFileId(t)),s=n.get("juri.base")+e.thumbnail,o=e.id;i.find("img").attr("src",s).data("id",o),i.find("img").attr("style","visibility:visible"),i.find(".joms-postbox-photo-action").show(),i.addClass("joms-postbox-photo-loaded"),i.find(".joms-postbox-photo-progressbar").remove(),this.pics||(this.pics=[]),this.pics.push(""+o),this.trigger("update",this.pics.length)},removeFailed:function(){this.$list.find(".joms-postbox-photo-item").not(".joms-postbox-photo-loaded").remove(),this.trigger("update",this.pics&&this.pics.length||0)},onRemove:function(e){var i,s=t(e.target).closest("li"),o=s.find("img").data("id");s.remove(),this.pics=t.without(this.pics,""+o),(i=this.pics.length)<=0&&this.select&&this.select.remove(),this.ajaxRemove([o]),this.trigger("update",i)},remove:function(){return this.pics&&this.pics.length&&this.ajaxRemove(this.pics),i.prototype.remove.apply(this,arguments)},ajaxRemove:function(e){var i={};i.option="community",i.no_html=1,i.task="azrul_ajax",i.func="system,ajaxDeleteTempImage",i[window.jax_token_var]=1,e&&e.length&&(i["arg2[]"]=e),t.ajax({url:window.jax_live_site,type:"post",dataType:"json",data:i})},getFileId:function(t){return"postbox-preview-"+t.id}})}),define("views/postbox/gif-preview",["views/postbox/photo-preview"],function(t){return t.extend({render:function(){t.prototype.render.apply(this,arguments),this.$el.addClass("joms-postbox-gif-preview")},add:function(){t.prototype.add.apply(this,arguments),this.$el.find(".joms-postbox-select-album").hide()},setImage:function(t,e){e||(e={});var i=this.$list.find("#"+this.getFileId(t)),s=e.image,o=e.id;i.find("img").attr("src",s).data("id",o),i.find("img").attr("style","visibility:visible"),i.find(".joms-postbox-photo-action").show(),i.addClass("joms-postbox-photo-loaded"),i.find(".joms-postbox-photo-progressbar").remove(),this.pics||(this.pics=[]),this.pics.push(""+o),this.trigger("update",this.pics.length)}})}),define("views/inputbox/photo",["sandbox","views/inputbox/status","utils/constants","utils/language"],function(t,e,i,s){return e.extend({template:joms.jst["html/inputbox/photo"],initialize:function(){var t,o,n,a;if(e.prototype.initialize.apply(this,arguments),this.hint={single:s.get("status.photo_hint")||"",multiple:s.get("status.photos_hint")||""},this.moods=i.get("moods"),t={},this.moods&&this.moods.length)for(a=0;a<this.moods.length;a++)o=[n=this.moods[a].id,this.moods[a].description],this.moods[a].custom&&(o[2]=this.moods[a].image),t[n]=o;this.moods=t},reset:function(){e.prototype.reset.apply(this,arguments),this.single()},single:function(){this.hint.current=this.hint.single,this.$textarea.attr("placeholder")&&this.$textarea.attr("placeholder",this.hint.current)},multiple:function(){this.hint.current=this.hint.multiple,this.$textarea.attr("placeholder")&&this.$textarea.attr("placeholder",this.hint.current)},updateAttachment:function(t){var e=[];if(this.mood=t||!1===t?t:this.mood,this.mood&&this.moods[this.mood]&&(void 0!==this.moods[this.mood][2]?e.push('<img class="joms-emoticon" src="'+this.moods[this.mood][2]+'"> <b>'+this.moods[this.mood][1]+"</b>"):e.push('<i class="joms-emoticon joms-emo-'+this.mood+'"></i> <b>'+this.moods[this.mood][1]+"</b>")),!e.length)return this.$attachment.html(""),void this.$textarea.attr("placeholder",this.hint.current);this.$attachment.html(" &nbsp;&mdash; "+e.join(" "+s.get("and")+" ")+"."),this.$textarea.removeAttr("placeholder")},getTemplate:function(){var e=this.template({placeholder:this.hint.current=this.hint.single});return t(e)}})}),define("utils/uploader",["sandbox","app"],function(t,e){function i(t){if(this.queue=[],this.ready=!1,window.plupload)return this.ready=!0,void this.create(t);var i=this;joms.$LAB.script(e.legacyUrl+"assets/vendors/plupload.min.js").wait(function(){i.ready=!0,i.create(t),i.execQueue()})}var s={runtimes:"html5,html4",url:"index.php"};return i.prototype.create=function(e){var i,o=this.$button=e.browse_button,n=!1;"string"==typeof e.container?(i=t("#"+e.container)).length||(i=t('<div id="'+e.container+'" style="width:1px; height:1px; overflow:hidden">').appendTo(document.body)):(n=(i=t(e.container)).attr("id"))?e.container=n:(e.container=n=t.uniqueId("uploader_parent_"),i.attr("id",n)),"string"==typeof o?(this.$button=t("#"+o),this.$button.length||(this.$button=t('<button id="'+o+'">').appendTo(i))):(n=o.attr("id"))?this.$button=t(document.getElementById(n)):(e.browse_button=n=t.uniqueId("uploader_"),o.attr("id",n)),this.onProgress=e.onProgress||t.noop,this.onAdded=e.onAdded||t.noop,e=t.extend({},s,e||{}),this.uploader=new plupload.Uploader(e)},i.prototype.init=function(){this.ready?(this.uploader.init(),this.uploader.bind("FilesAdded",this.onAdded),this.uploader.bind("Error",this.onError),this.uploader.bind("BeforeUpload",this.onBeforeUpload),this.uploader.bind("UploadProgress",this.onProgress),this.uploader.bind("FileUploaded",this.onUploaded),this.uploader.bind("UploadComplete",this.onComplete)):this.queue.push(["init",this,arguments])},i.prototype.open=function(){this.ready?this.$button.click():this.queue.push(["open",this,arguments])},i.prototype.reset=function(){this.ready||this.queue.push(["reset",this,arguments])},i.prototype.remove=function(){this.ready||this.queue.push(["remove",this,arguments])},i.prototype.params=function(t){this.uploader.settings.multipart_params=t},i.prototype.upload=function(){this.ready||this.queue.push(["upload",this,arguments])},i.prototype.execQueue=function(){for(var t;this.queue.length;)this[(t=this.queue.shift())[0]].apply(t[1],t[2])},i.prototype.onAdded=t.noop,i.prototype.onError=t.noop,i.prototype.onBeforeUpload=t.noop,i.prototype.onProgress=t.noop,i.prototype.onUploaded=t.noop,i.prototype.onComplete=t.noop,i}),define("views/postbox/photo",["sandbox","app","views/postbox/default","views/postbox/photo-preview","views/postbox/gif-preview","views/inputbox/photo","views/dropdown/mood","views/widget/select","utils/constants","utils/language","utils/uploader"],function(t,e,i,s,o,n,a,l,r,h,d){return i.extend({subviews:{mood:a},template:joms.jst["html/postbox/photo"],events:t.extend({},i.prototype.events,{"click .joms-postbox-photo-upload":"onPhotoAdd","click li[data-tab=upload]":"onPhotoAdd","click .joms-postbox-gif-upload":"onGifAdd"}),initialize:function(){var e=r.get("moods");this.enableMood=+r.get("conf.enablemood")&&e&&e.length,this.enableMood||(this.subviews=t.omit(this.subviews,"mood")),this.enableGif=+r.get("conf.enablephotosgif"),i.prototype.initialize.apply(this)},render:function(){i.prototype.render.apply(this),this.$initial=this.$(".joms-postbox-inner-panel"),this.$main=this.$(".joms-postbox-photo"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$preview=this.$(".joms-postbox-preview"),this.$tabupload=this.$tabs.find("[data-tab=upload]"),this.$tabmood=this.$tabs.find("[data-tab=mood]"),this.enableMood||this.$tabmood.remove(),this.$uploader=this.$("#joms-postbox-photo-upload"),this.$uploaderParent=this.$uploader.parent(),this.inputbox=new n({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus);var e=joms.BASE_URL+"index.php?option=com_community&view=photos&task=ajaxPreview",s=r.get("settings")||{};s.isGroup&&(e+="&no_html=1&tmpl=component&groupid="+(r.get("groupid")||"")),s.isEvent&&(e+="&no_html=1&tmpl=component&eventid="+(r.get("eventid")||"")),t.ie&&(this.$uploader.appendTo(document.body),this.$uploader.show());var o=+r.get("conf.maxuploadsize")||0;o&&(o+="mb");var a={container:"joms-postbox-photo-upload",browse_button:"joms-postbox-photo-upload-btn",url:e,filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}],max_file_size:o};if(t.mobile||(a.resize={width:2100,height:2100,quality:90}),this.uploader=new d(a),this.uploader.onAdded=t.bind(this.onPhotoAdded,this),this.uploader.onError=t.bind(this.onPhotoError,this),this.uploader.onProgress=t.bind(this.onPhotoProgress,this),this.uploader.onUploaded=t.bind(this.onPhotoUploaded,this),this.uploader.init(),t.ie&&(this.$uploader.hide(),this.$uploader.appendTo(this.$uploaderParent)),this.enableGif){var l={container:"joms-postbox-gif-upload",browse_button:"joms-postbox-gif-upload-btn",url:e+"&gifanimation=1",filters:[{title:"Image files",extensions:"gif"}],max_file_size:o,multi_selection:!1};this.gifuploader=new d(l),this.gifuploader.onAdded=t.bind(this.onGifAdded,this),this.gifuploader.onError=t.bind(this.onGifError,this),this.gifuploader.onProgress=t.bind(this.onGifProgress,this),this.gifuploader.onUploaded=t.bind(this.onGifUploaded,this),this.gifuploader.init()}return this},showInitialState:function(){this.$main.hide(),this.$initial.show(),t.ie&&t.ieVersion<10&&this.ieUploadButtonFix(!0),this.inputbox&&this.inputbox.single(),this.preview&&this.preview.remove(),this.preview=!1,this.gifPreview&&this.gifPreview.remove(),this.gifPreview=!1,this.showMoreButton(),i.prototype.showInitialState.apply(this)},showMainState:function(){i.prototype.showMainState.apply(this),this.$action.hide(),this.$initial.hide(),this.$main.show(),this.$save.show(),t.ie&&t.ieVersion<10&&this.ieUploadButtonFix(),e.postbox&&e.postbox.value&&e.postbox.value.length&&(this.inputbox.set(e.postbox.value[0]),e.postbox.value=!1)},showMoreButton:function(){this.$tabupload.removeClass("hidden invisible")},hideMoreButton:function(){this.$tabupload.addClass(this.subviews.mood?"hidden":"invisible")},reset:function(){i.prototype.reset.apply(this),this.inputbox&&this.inputbox.reset(),this.preview&&this.preview.remove(),this.preview=!1,this.gifPreview&&this.gifPreview.remove(),this.gifPreview=!1},value:function(){this.data.text=this.inputbox.value()||"",this.data.attachment={},this.data.text=this.data.text.replace(/\n/g,"\\n");var e;for(var s in this.subflags)(e=this.subviews[s].value())&&(this.data.attachment[s]=e);return this.preview?t.extend(this.data.attachment,this.preview.value()):this.gifPreview&&t.extend(this.data.attachment,this.gifPreview.value()),i.prototype.value.apply(this,arguments)},validate:function(){var t=this.value(!0)[1]||{};if(!t.id&&t.id.length)return"No image selected."},onPhotoAdd:function(){if(!this.uploading){var e=r.get("conf")||{},i=+e.limitphoto,s=+e.uploadedphoto;this.preview&&this.preview.pics&&this.preview.pics.length>=8?window.alert(h.get("photo.batch_notice")):(this.preview&&this.preview.pics&&this.preview.pics.length&&(s+=this.preview.pics.length),s>=i?window.alert(h.get("photo.upload_limit_exceeded")||"You have reached the upload limit."):window.opera||t.ie&&10===t.ieVersion?this.$("#joms-postbox-photo-upload").find("input[type=file]").click():this.uploader.open())}},onPhotoAdded:function(e,i){if(!this.uploading&&i&&i.length){var o=0;this.preview&&this.preview.pics&&this.preview.pics.length&&(o=this.preview.pics.length),o+i.length>8&&(o=o+i.length-8,i.splice(0-o,o),e.splice(0-o,o),window.alert(h.get("photo.batch_notice")));var n=r.get("conf")||{},a=+n.limitphoto,l=+n.uploadedphoto;this.preview&&this.preview.pics&&this.preview.pics.length&&(l+=this.preview.pics.length);var d;l+i.length>a&&(d=l+i.length-a,i.splice(0-d,d),e.splice(0-d,d));var c;this.preview||(c=t("<div>").appendTo(this.$preview),this.preview=new s,this.assign(c,this.preview),this.listenTo(this.preview,"update",function(t){if(!t||t<=0)return this.showInitialState(),this.inputbox.single(),void(this.uploading=0);t>=8?this.hideMoreButton():this.showMoreButton(),this.inputbox[t>1?"multiple":"single"]()})),this.showMainState();for(var p=0;p<i.length;p++)this.preview.add(i[p]);this.uploading=i.length,this.$action.hide(),e.start(),e.refresh()}},onPhotoError:function(t,e){+e.code==+plupload.FILE_EXTENSION_ERROR?window.alert("Selected file type is not permitted."):+e.code==+plupload.FILE_SIZE_ERROR?window.alert(h.get("photo.max_upload_size_error")):console.log(e.message)},onPhotoProgress:function(t,e){this.preview.updateProgress(e)},onPhotoUploaded:function(t,e,i){var s;try{s=JSON.parse(i.response)}catch(t){}if(s||(s={}),!s.thumbnail)return t.stop(),t.splice(),window.alert(s&&s.msg||"Undefined error."),this.uploading=0,this.$action.show(),void(this.preview&&this.preview.removeFailed());--this.uploading<=0&&this.$action.show(),this.preview&&this.preview.setImage(e,s)},onGifAdd:function(){this.hideMoreButton(),this.gifuploader.open()},onGifAdded:function(e,i){var s;this.gifPreview||(s=t("<div>").appendTo(this.$preview),this.gifPreview=new o,this.assign(s,this.gifPreview),this.listenTo(this.gifPreview,"update",function(t){if(!t||t<=0)return this.showInitialState(),this.inputbox.single(),void(this.uploading=0);this.hideMoreButton(),this.inputbox.single()})),this.showMainState(),this.gifPreview.add(i[0]),e.start(),e.refresh()},onGifError:function(t,e){+e.code==+plupload.FILE_EXTENSION_ERROR?window.alert("Selected file type is not permitted."):+e.code==+plupload.FILE_SIZE_ERROR?window.alert(h.get("photo.max_upload_size_error")):console.log(e.message)},onGifProgress:function(t,e){this.gifPreview.updateProgress(e)},onGifUploaded:function(t,e,i){var s;try{s=JSON.parse(i.response)}catch(t){}if(s||(s={}),!s.image)return t.stop(),t.splice(),window.alert(s&&s.msg||"Undefined error."),this.$action.show(),void(this.gifPreview&&this.gifPreview.removeFailed());this.$action.show(),this.gifPreview&&this.gifPreview.setImage(e,s)},onMoodSelect:function(t){this.inputbox.updateAttachment(t)},onMoodRemove:function(){this.inputbox.updateAttachment(!1)},getTemplate:function(){var e=this.template({juri:r.get("juri"),allowgif:r.get("conf.enablephotosgif")||!1,language:{postbox:h.get("postbox")||{},status:h.get("status")||{},photo:h.get("photo")||{}}});return t(e).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},r.get("postbox.attachment")||{},{type:"photo"}),this.staticAttachment)},ieUploadButtonFix:function(t){this.ieUploadButtonFix.init||(this.ieUploadButtonFix.init=!0,this.$uploader.css({display:"block",position:"absolute",opacity:0,width:"",height:""}).children("button,form").css({display:"block",position:"absolute",width:"",height:"",top:0,right:0,bottom:0,left:0}).children("input").css({cursor:"pointer",height:"100%"})),t?(this.$uploader.appendTo(this.$uploaderParent),this.$uploader.css({top:12,right:12,bottom:12,left:12}).children("form").css({width:"100%",height:"100%"})):(this.$uploader.appendTo(this.$tabupload),this.$uploader.css({top:0,right:0,bottom:0,left:0}))}})}),define("views/inputbox/videourl",["sandbox","views/inputbox/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/videourl"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},onKeydown:function(e){e&&13===e.keyCode&&e.preventDefault();var i=this;t.defer(function(){i.updateInput(e)})},getTemplate:function(){var e=i.get("video.link_hint")||"",s=this.template({placeholder:e});return t(s)}})}),define("views/postbox/fetcher-video",["sandbox","views/base","views/widget/select","utils/ajax","utils/language"],function(t,e,i,s,o){return e.extend({template:joms.jst["html/postbox/fetcher-video"],events:{"click .joms-fetched-close":"onClose","click .joms-fetched-field span":"onFocus","keyup .joms-fetched-field input":"onKeyup","keyup .joms-fetched-field textarea":"onKeyup","blur .joms-fetched-field input":"onBlur","blur .joms-fetched-field textarea":"onBlur"},initialize:function(){var t=o.get("fetch")||{};this.titlePlaceholder=t.title_hint||"",this.descPlaceholder=t.description_hint||"",t=o.get("video"),this.categoryLabel=t.category_label},fetch:function(e){var i=/^(|.*\s)(https?:\/\/|www\.)([a-z0-9-]+\.)+[a-z]{2,18}(:\d+)?(\/.*)?(\s.*|)$/i,o=e.match(i);if(!this.fetching&&o){this.id=!1,this.url=e,this.fetching=!0,this.fetched=!1,this.trigger("fetch:start");var n=this;s({fn:"videos,ajaxLinkVideoPreview",data:[e],complete:function(){n.fetching=!1,n.trigger("fetch:done")},success:t.bind(this.render,this)})}},render:function(t){if(t=this.parseResponse(t)){var e=t&&t.video,s=this.sortCategories(t&&t.category||[]);if(e&&e.id){this.video_id=e.id,this.fetched=!0;var n={title:e.title||"",titlePlaceholder:this.titlePlaceholder,description:e.description||"",descPlaceholder:this.descPlaceholder,image:e.thumb||!1,lang:{cancel:(o.get("cancel")||"").toLowerCase()}};this.select&&this.select.remove(),this.$el.html(this.template(n)),this.$image=this.$(".joms-fetched-images").find("img"),this.$title=this.$(".joms-fetched-title").find("input"),this.$description=this.$(".joms-fetched-description").find("textarea"),this.$category=this.$(".joms-fetched-category");for(var a=[],l=0;l<s.length;l++)a.push([s[l].id,this.categoryLabel+": "+s[l].name]);return this.select=new i({options:a}),this.assign(this.$category,this.select),this}this.trigger("fetch:failed",t)}else this.trigger("fetch:failed")},change:function(e){var i=t(e),s=i.prev("span"),o=i.val().replace(/^\s+|\s+$/g,"");o||(o=i.parent().hasClass("joms-fetched-title")?this.titlePlaceholder:this.descPlaceholder),i.hide(),s.text(o).show()},remove:function(){e.prototype.remove.apply(this),this.trigger("remove")},value:function(){return this.fetching?[]:[this.video_id,this.url,this.$image&&this.$image.attr("src"),this.$title&&this.escapeValue(this.$title.val()),this.$description&&this.escapeValue(this.$description.val()),this.select&&this.select.value()]},onClose:function(){this.remove()},onFocus:function(e){var i=t(e.currentTarget),s=i.next("input,textarea");i.hide(),s.show(),setTimeout(function(){s[0].focus()},300)},onKeyup:function(t){13===t.keyCode&&this.change(t.currentTarget)},onBlur:function(t){this.change(t.currentTarget)},parseResponse:function(t){var e;if(t&&t.length)for(var i=0;i<t.length;i++){if("__throwError"===t[i][1]){e={msg:t[i][3]};break}if("__callback"===t[i][1]){e=t[i][3][0];break}}return e},sortCategories:function(t,e,i){if(!t||!t.length)return[];e||(e=0),i||(i="");for(var s,o,n=[],a=0;a<t.length;a++)+t[a].parent===e&&(s=+t[a].id,o=i+t[a].name,n.push({id:s,name:o}),n=n.concat(this.sortCategories(t,s,o+" &rsaquo; ")));return n},escapeValue:function(t){return"string"!=typeof t?t:t.replace(/\\/g,"&#92;").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/&quot;/g,'"')}})}),define("views/inputbox/video",["sandbox","views/inputbox/status","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/video"],getTemplate:function(){var e=i.get("status.video_hint")||"",s=this.template({placeholder:e});return t(s)}})}),define("views/postbox/video",["sandbox","app","views/postbox/default","views/inputbox/videourl","views/postbox/fetcher-video","views/inputbox/video","views/dropdown/mood","views/dropdown/location","views/dropdown/privacy","views/widget/select","utils/ajax","utils/constants","utils/language","utils/uploader"],function(t,e,i,s,o,n,a,l,r,h,d,c,p,u){return i.extend({subviews:{mood:a,location:l,privacy:r},template:joms.jst["html/postbox/video"],events:t.extend({},i.prototype.events,{"click [data-action=share]":"onVideoUrl","click [data-action=upload]":"onVideoUpload"}),initialize:function(){this.enableUpload=+c.get("conf.enablevideosupload"),this.enableLocation=+c.get("conf.enablevideosmap");var e=c.get("moods");this.enableMood=+c.get("conf.enablemood")&&e&&e.length,this.enableMood||(this.subviews=t.omit(this.subviews,"mood")),this.enableLocation||(this.subviews=t.omit(this.subviews,"location"));var s=c.get("settings")||{};(this.inheritPrivacy=s.isGroup||s.isEvent||!s.isMyProfile)&&(this.subviews=t.omit(this.subviews,"privacy")),this.language={postbox:p.get("postbox"),status:p.get("status"),video:p.get("video")},this.onVideoInit(),i.prototype.initialize.apply(this)},render:function(){i.prototype.render.apply(this),this.$initial=this.$(".joms-initial-panel"),this.$main=this.$(".joms-postbox-video"),this.$stateurl=this.$(".joms-postbox-video-state-url"),this.$stateupload=this.$(".joms-postbox-video-state-upload"),this.$url=this.$stateurl.find(".joms-postbox-url"),this.$fetcher=this.$stateurl.find(".joms-postbox-fetched"),this.$file=this.$stateupload.find(".joms-postbox-url"),this.$fileprogress=this.$stateupload.find(".joms-postbox-photo-progress"),this.$title=this.$stateupload.find("input.input"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$tabupload=this.$tabs.find("[data-tab=upload]"),this.$tabmood=this.$tabs.find("[data-tab=mood]"),this.$tablocation=this.$tabs.find("[data-tab=location]"),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.enableMood||this.$tabmood.remove(),this.enableLocation||this.$tablocation.remove(),this.inheritPrivacy&&this.$tabprivacy.css({visibility:"hidden"}),this.url=new s,this.assign(this.$url,this.url),this.listenTo(this.url,"focus",this.onUrlFocus),this.listenTo(this.url,"keydown",this.onUrlUpdate),this.inputbox=new n({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus);var t,e;return this.inheritPrivacy||((e=c.get("settings")||{}).isProfile&&e.isMyProfile&&(t=c.get("conf.profiledefaultprivacy")),this.initSubview("privacy",{privacylist:window.joms_privacylist,defaultPrivacy:t||"public"})),this},showInitialState:function(){this.reset(),this.$tabs.hide(),this.$action.hide(),this.$save.hide(),this.enableUpload?(this.$main.hide(),this.$initial.show()):this.showUrlState(),this.trigger("show:initial")},showMainState:function(t){t?this.showUploadState():this.showUrlState(),this.$tabs.show(),this.$action.show(),this.trigger("show:main")},showUrlState:function(){this.inputbox.$el.find(".joms-postbox-input-placeholder").html(this.language.status.video_hint),this.$save.html(this.language.postbox.post_button),this.$stateupload.hide(),this.$stateurl.show(),this.$initial.hide(),this.$main.show(),this.upload=!1,e.postbox&&e.postbox.value&&e.postbox.value.length&&(this.inputbox.set(e.postbox.value[0]),e.postbox.value=!1)},showUploadState:function(){var t,i,s;if(!this.uploadcat){for(t=this.sortCategories(c.get("videoCategories")||[]),i=[],s=0;s<t.length;s++)i.push([t[s].id,this.language.video.category_label+": "+t[s].name]);this.uploadcat=new h({options:i}),this.$uploadcat=this.$stateupload.find(".joms-fetched-category"),this.assign(this.$uploadcat,this.uploadcat)}this.inputbox.$el.find(".joms-postbox-input-placeholder").html(this.language.video.upload_hint),this.$save.html(this.language.postbox.upload_button),this.$stateurl.hide(),this.$stateupload.show(),this.$initial.hide(),this.$main.show(),this.$save.show(),this.upload=!0,e.postbox&&e.postbox.value&&e.postbox.value.length&&(this.inputbox.set(e.postbox.value[0]),e.postbox.value=!1)},reset:function(){i.prototype.reset.apply(this),this.url&&this.url.reset(),this.inputbox&&this.inputbox.reset(),this.fetcher&&this.fetcher.remove()},value:function(){this.data.text=this.inputbox.value()||"",this.data.attachment={},this.data.text=this.data.text.replace(/\n/g,"\\n");var t;for(var e in this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);return this.upload?this.status&&"success"===this.status.status&&(this.data.attachment.fetch=[this.status.videoid]):this.fetcher&&(this.data.attachment.fetch=this.fetcher.value()),i.prototype.value.apply(this,arguments)},validate:function(){var t=(this.value(!0)[1]||{}).fetch;if(this.upload){if(!this.uploadcat||!this.uploadcat.value())return p.get("video.select_category")||"Please select video category."}else{if(!t||!t.length)return p.get("video.invalid_url")||"Please share a valid video url.";if(!t[5])return p.get("video.select_category")||"Please select video category."}},onPost:function(){if(!this.saving){var e=this.validate();if(e)window.alert(e);else if(this.saving=!0,this.$loading.show(),!0!==this.upload){var i=this,s=this.value();window.joms_filter_params&&s.push(JSON.stringify(window.joms_filter_params)),window.joms_postbox_posting=!0,d({fn:"system,ajaxStreamAdd",data:s,success:t.bind(this.onPostSuccess,this),complete:function(){window.joms_postbox_posting=!1,i.$loading.hide(),i.saving=!1,i.showInitialState()}})}else this.uploader.uploader.start()}},onMoodSelect:function(t){this.inputbox.updateAttachment(t)},onMoodRemove:function(){this.inputbox.updateAttachment(!1)},onLocationSelect:function(t){this.inputbox.updateAttachment(null,t)},onLocationRemove:function(){this.inputbox.updateAttachment(null,!1)},onPrivacySelect:function(t){var e=this.$tabprivacy.find("use").attr("xlink:href");e=e.replace(/#.+$/,"#joms-icon-"+t.icon),this.$tabprivacy.find("use").attr("xlink:href",e),this.$tabprivacy.find("span").html(t.label)},onUrlFocus:function(){this.enableUpload||this.showMainState()},onUrlUpdate:function(t,e){t&&(t=t.replace(/^\s+|\s+$/g,"")),32===e||13===e?this.fetch(t):this.fetchProxy(t)},onInputFocus:function(){this.enableUpload||this.showMainState()},fetchProxy:t.debounce(function(t){this.fetch(t)},1e3),fetch:function(e){var i;this.fetcher&&(this.fetcher.fetching||this.fetcher.fetched)||(delete this.data.attachment.fetch,i=t("<div>").appendTo(this.$fetcher),this.fetcher&&this.fetcher.remove(),this.fetcher=new o,this.fetcher.setElement(i),this.listenTo(this.fetcher,"fetch:start",this.onFetchStart),this.listenTo(this.fetcher,"fetch:failed",this.onFetchFailed),this.listenTo(this.fetcher,"fetch:done",this.onFetchDone),this.listenTo(this.fetcher,"remove",this.onFetchRemove),this.fetcher.fetch(e))},onFetchStart:function(){this.saving=!0,this.$loading.show(),this.$save.hide()},onFetchFailed:function(t){this.fetcher&&this.fetcher.remove(),this.saving=!1,this.$loading.hide(),this.$save.hide();var e=t&&t.msg||"Undefined error.";window.alert(e)},onFetchDone:function(){this.saving=!1,this.$loading.hide(),this.fetcher&&this.fetcher.fetched&&this.$save.show()},onFetchRemove:function(){this.fetcher=!1,this.$save.hide()},onVideoUrl:function(){this.showMainState()},onVideoInit:function(){if(!this.uploader){var e=+c.get("conf.maxvideouploadsize")||0;e&&(e+="mb");var i="index.php?option=com_community&view=videos&task=uploadvideo",s=c.get("videocreatortype"),o=c.get("settings")||{},n=+c.get("groupid"),a=+c.get("eventid");s&&(i+="&creatortype="+s),o.isProfile&&!o.isMyProfile?i+="&target="+c.get("postbox.attachment.target"):+a>0?i+="&eventid="+a:+n>0&&(i+="&groupid="+n),this.uploader=new u({container:"joms-js--videouploader-upload",browse_button:"joms-js--videouploader-upload-button",url:i,multi_selection:!1,filters:[{title:"Video files",extensions:"3g2,3gp,asf,asx,avi,flv,mov,mp4,mpg,rm,swf,vob,wmv,m4v"}],max_file_size:e}),this.uploader.onAdded=t.bind(this.onVideoAdded,this),this.uploader.onError=t.bind(this.onVideoError,this),this.uploader.onBeforeUpload=t.bind(this.onVideoBeforeUpload,this),this.uploader.onProgress=t.bind(this.onVideoProgress,this),this.uploader.onUploaded=t.bind(this.onVideoUploaded,this),this.uploader.init()}},onVideoUpload:function(){var t=c.get("conf")||{},e=+t.limitvideo;+t.uploadedvideo>=e?window.alert(p.get("video.upload_limit_exceeded")||"You have reached the upload limit."):(this.uploader.uploader.splice(),this.uploader.open())},onVideoAdded:function(t,e){if(e&&e.length){for(var i=e[0],s="<b>"+i.name+"</b>",o=i.size||0,n="Bytes",a=["KB","MB","GB"];o>=1e3&&a.length;)n=a.shift(),o=Math.ceil(o/1e3);o&&(s+=" ("+o+" "+n+")"),this.$file.html(s),this.$fileprogress.css({width:0}),this.showMainState("upload")}},onVideoError:function(t,e){var i;+e.code==+plupload.FILE_SIZE_ERROR?(i=+c.get("conf.maxvideouploadsize")||0,window.alert("Maximum file size for video upload is "+i+" MB.")):+e.code==+plupload.FILE_EXTENSION_ERROR&&window.alert("Selected file type is not permitted.")},onVideoBeforeUpload:function(){var t={title:this.$title.val(),description:this.inputbox.value()};this.subflags.privacy&&(t.permissions=this.subviews.privacy.value());var e=this.subflags.location&&this.subviews.location.value();e&&e.length&&(t.location=e),this.uploadcat&&(t.category_id=this.uploadcat&&this.uploadcat.value()),this.uploader.params(t)},onVideoProgress:function(t,e){var i=Math.min(100,Math.round(100*e.loaded/e.size));this.$fileprogress.animate({width:i+"%"})},onVideoUploaded:function(t,e,i){var s,o;try{s=JSON.parse(i.response)}catch(t){}this.status=s||{},o=this,setTimeout(function(){o.$loading.hide(),o.saving=!1,o.showInitialState(),"success"!==o.status.status?window.alert(o.status.message||"Undefined error."):(++(c.get("conf")||{}).uploadedvideo,window.alert(o.status.processing_str))},1e3)},getTemplate:function(){var e=this.template({juri:c.get("juri"),enable_upload:this.enableUpload,video_maxsize:c.get("conf.maxvideouploadsize"),language:{postbox:p.get("postbox")||{},status:p.get("status")||{},video:p.get("video")||{}}});return t(e).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},c.get("postbox.attachment")||{},{type:"video"}),this.staticAttachment)},sortCategories:function(t,e,i){if(!t||!t.length)return[];e||(e=0),i||(i="");for(var s,o,n=[],a=0;a<t.length;a++)+t[a].parent===e&&(s=+t[a].id,o=i+t[a].name,n.push({id:s,name:o}),n=n.concat(this.sortCategories(t,s,o+" &rsaquo; ")));return n}})}),define("views/inputbox/eventtitle",["sandbox","views/inputbox/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/eventtitle"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},getTemplate:function(){var e=i.get("event.title_hint")||"",s=this.template({placeholder:e});return t(s)}})}),define("views/inputbox/eventdesc",["sandbox","views/inputbox/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/eventdesc"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},getTemplate:function(){var e=i.get("status.event_hint")||"",s=this.template({placeholder:e});return t(s)}})}),define("views/dropdown/event",["sandbox","views/dropdown/base","utils/constants","utils/language"],function(t,e,i,s){return e.extend({template:joms.jst["html/dropdown/event"],events:{"click .joms-postbox-done":"onSave"},render:function(){var e,o,n=this.getTemplate(),a=+i.get("conf.eventshowampm"),l=+i.get("conf.firstday"),r=a?"h:i A":"H:i",h={};for(h.monthsFull=[s.get("datepicker.january"),s.get("datepicker.february"),s.get("datepicker.march"),s.get("datepicker.april"),s.get("datepicker.may"),s.get("datepicker.june"),s.get("datepicker.july"),s.get("datepicker.august"),s.get("datepicker.september"),s.get("datepicker.october"),s.get("datepicker.november"),s.get("datepicker.december")],h.monthsShort=[],o=0;o<h.monthsFull.length;o++)h.monthsShort[o]=h.monthsFull[o].substr(0,3);for(h.weekdaysFull=[s.get("datepicker.sunday"),s.get("datepicker.monday"),s.get("datepicker.tuesday"),s.get("datepicker.wednesday"),s.get("datepicker.thursday"),s.get("datepicker.friday"),s.get("datepicker.saturday")],h.weekdaysShort=[],o=0;o<h.weekdaysFull.length;o++)h.weekdaysShort[o]=h.weekdaysFull[o].substr(0,3);if(h.today=s.get("datepicker.today"),h.clear=s.get("datepicker.clear"),h.firstDay=l,h.selectYears=200,h.selectMonths=!0,this.$el.replaceWith(n),this.setElement(n),this.$category=this.$(".joms-event-category").empty(),this.$location=this.$("[name=location]").val(""),this.$startdate=this.$(".joms-pickadate-startdate").pickadate(t.extend({},h,{min:new Date,format:"d mmmm yyyy",klass:{frame:"picker__frame startDate"}})),this.$starttime=this.$(".joms-pickadate-starttime").pickatime({interval:15,format:r,formatLabel:r,klass:{frame:"picker__frame startTime"}}),this.$enddate=this.$(".joms-pickadate-enddate").pickadate(t.extend({},h,{format:"d mmmm yyyy",klass:{frame:"picker__frame endDate"}})),this.$endtime=this.$(".joms-pickadate-endtime").pickatime({interval:15,format:r,formatLabel:r,klass:{frame:"picker__frame endTime"}}),this.$done=this.$(".joms-event-done"),(e=i.get("eventCategories")||[])&&e.length)for(o=0;o<e.length;o++)this.$category.append('<option value="'+e[o].id+'">'+e[o].name+"</option>");return this.startdate=this.$startdate.pickadate("picker"),this.starttime=this.$starttime.pickatime("picker"),this.enddate=this.$enddate.pickadate("picker"),this.endtime=this.$endtime.pickatime("picker"),this.startdate.on({set:t.bind(this.onSetStartDate,this)}),this.starttime.on({set:t.bind(this.onSetStartTime,this)}),this.enddate.on({set:t.bind(this.onSetEndDate,this)}),this.endtime.on({set:t.bind(this.onSetEndTime,this)}),this},value:function(){return this.data},reset:function(){this.$category.val(this.$category.find("option").eq(0).attr("value")),this.$location.val(""),this.$startdate.val(""),this.$starttime.val(""),this.$enddate.val(""),this.$endtime.val("")},onSetStartDate:function(t){var e=t.select;this.enddate.set({min:new Date(e)},{muted:!0}),this._checkTime()},onSetEndDate:function(t){var e=t.select;this.startdate.set({max:new Date(e)},{muted:!0}),this._checkTime()},onSetStartTime:function(){this._checkTime("start")},onSetEndTime:function(){this._checkTime("end")},onSave:function(){var t,e=this.$category.val(),i=this.$location.val(),o=this.startdate.get("select"),n=this.starttime.get("select"),a=this.enddate.get("select"),l=this.endtime.get("select");e=[e,this.$category.find("[value="+e+"]").text()],o&&(o=[this.startdate.get("select","yyyy-mm-dd"),this.startdate.get("value")]),n&&(n=[this.starttime.get("select","HH:i"),this.starttime.get("value")]),a&&(a=[this.enddate.get("select","yyyy-mm-dd"),this.enddate.get("value")]),l&&(l=[this.endtime.get("select","HH:i"),this.endtime.get("value")]),this.data={category:e,location:i,startdate:o,starttime:n,enddate:a,endtime:l,allday:!1},this.data.category?this.data.location?this.data.startdate?this.data.starttime?this.data.enddate?this.data.endtime||(t=s.get("event.end_time_not_selected")):t=s.get("event.start_time_not_selected"):t=s.get("event.end_date_not_selected"):t=s.get("event.start_date_not_selected"):t=s.get("event.location_not_selected"):t=s.get("event.category_not_selected"),t?window.alert(t):(this.trigger("select",this.data),this.hide())},getTemplate:function(){var e=this.template({language:{event:s.get("event")||{}}});return t(e).hide()},_checkTime:function(){var t,e,i=this.startdate.get("select"),s=this.enddate.get("select");i&&s&&(s.year<=i.year&&s.month<=i.month&&s.date<=i.date?(t=this.starttime.get("select"),e=this.endtime.get("select"),t?(this.endtime.set({min:[t.hour,t.mins]},{muted:!0}),e&&e.time<t.time&&this.endtime.set({select:[t.hour,t.mins]},{muted:!0})):this.endtime.set({min:!1},{muted:!0}),e?(this.starttime.set({max:[e.hour,e.mins]},{muted:!0}),t&&t.time>e.time&&this.starttime.set({select:[e.hour,e.mins]},{muted:!0})):this.starttime.set({max:!1},{muted:!0})):(this.starttime.set({max:!1},{muted:!0}),this.endtime.set({min:!1},{muted:!0})))}})}),define("utils/format",["sandbox"],function(t){return{pad:function(e,i,s){if(!t.isString(e))return e;if(!t.isNumber(i)||e.length>=i)return e;i-=e.length;for(var o=0;o<i;o++)e=(s||" ")+e;return e}}}),define("views/postbox/event",["sandbox","views/postbox/default","views/inputbox/eventtitle","views/inputbox/eventdesc","views/dropdown/event","utils/constants","utils/format","utils/language"],function($,DefaultView,TitleView,InputboxView,EventView,constants,format,language){return DefaultView.extend({subviews:{event:EventView},template:joms.jst["html/postbox/event"],events:$.extend({},DefaultView.prototype.events,{"click .joms-postbox-event-title":"onFocus"}),render:function(){return DefaultView.prototype.render.apply(this),this.$title=this.$(".joms-postbox-title"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$category=this.$(".joms-postbox-event-label-category"),this.$location=this.$(".joms-postbox-event-label-location"),this.$date=this.$(".joms-postbox-event-label-date"),this.title=new TitleView,this.assign(this.$title,this.title),this.listenTo(this.title,"focus",this.onInputFocus),this.listenTo(this.title,"keydown",this.onNewInputUpdate),this.inputbox=new InputboxView({charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus),this.listenTo(this.inputbox,"keydown",this.onNewInputUpdate),this},reset:function(){DefaultView.prototype.reset.apply(this),this.title&&this.title.reset(),this.inputbox&&this.inputbox.reset(),this.$category&&this.onEventSelect({})},value:function(){this.data.text=this.inputbox.value()||"",this.data.attachment={};var t;for(var e in this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);var i=(this._data.starttime||"").split(":"),s=(this._data.endtime||"").split(":");return $.extend(this.data.attachment,{title:this.title.value(),catid:this._data.category&&this._data.category[0]||null,location:this._data.location,startdate:this._data.startdate,enddate:this._data.enddate,allday:!1,"starttime-hour":i[0]||null,"starttime-min":i[1]||null,"endtime-hour":s[0]||null,"endtime-min":s[1]||null}),DefaultView.prototype.value.apply(this,arguments)},validate:function(){if(!this.value(!0)[0])return"Event description cannot be empty."},onInputFocus:function(){this.showMainState()},onInputUpdate:$.debounce(function(){var t=this.value(!0),e=t[0],i=t[1],s=!0;this.trim(i.title)&&this.trim(e)&&i.catid&&i.location&&i.startdate&&i.enddate&&(i["starttime-hour"]||i["starttime-min"])?i["endtime-hour"]||i["endtime-min"]||(s=!1):s=!1,this.$save[s?"show":"hide"]()},300),onNewInputUpdate:$.debounce(function(){var t=this.value(!0),e=t[0],i=t[1],s=!0;this.trim(i.title)&&this.trim(e)&&i.catid&&i.location&&i.startdate&&i.enddate&&(i["starttime-hour"]||i["starttime-min"])?i["endtime-hour"]||i["endtime-min"]||(s=!1):s=!1,this.$save[s?"show":"hide"]()},300),onPost:function(){var t,e=constants.get("conf")||{},i=+e.limitevent;if(+e.createdevent>=i)return t=language.get("event.create_limit_exceeded")||"You have reached the event creation limit.",t=t.replace("%1$s",i),void window.alert(t);DefaultView.prototype.onPost.apply(this,arguments)},onPostSuccess:function(){DefaultView.prototype.onPostSuccess.apply(this,arguments);var t=constants.get("conf")||{};t.createdevent=+t.createdevent+1},onEventSelect:function(t){t.category?(this.$category.find(".joms-input-text").html(t.category&&t.category[1]),this.$category.show()):this.$category.hide(),t.location?(this.$location.find(".joms-input-text").html(t.location),this.$location.show()):this.$location.hide();var e=[];t.startdate&&t.enddate?(e.push(t.startdate[1]+" "+t.starttime[1]),e.push(t.enddate[1]+" "+t.endtime[1]),this.$date.find(".joms-input-text").html(e.join(" &mdash; ")),this.$date.show()):this.$date.hide(),t.startdate&&(t.startdate=t.startdate[0]),t.starttime&&(t.starttime=t.starttime[0]),t.enddate&&(t.enddate=t.enddate[0]),t.endtime&&(t.endtime=t.endtime[0]),this._data=t,this.onInputUpdate()},onPrivacySelect:function(t){var e=this.$tabprivacy.find("use").attr("xlink:href");e=e.replace(/#.+$/,"#joms-icon-"+t.icon),this.$tabprivacy.find("use").attr("xlink:href",e),this.$tabprivacy.find("span").html(t.label)},parseResponse:function(response){var elid="activity-stream-container",data,temp;if(response&&response.length)for(var i=0;i<response.length;i++)if(response[i][1]===elid&&(data=response[i][3]),"al"===response[i][0]&&(temp=response[i][3],window.alert($.isArray(temp)?temp.join(". "):temp)),"__throwError"===response[i][1]&&(temp=response[i][3],window.alert($.isArray(temp)?temp.join(". "):temp)),"cs"===response[i][0])try{eval(response[i][1])}catch(t){}return data},getTemplate:function(){var t=language.get("event")||{};t.event_detail&&(t.event_detail=t.event_detail.toLowerCase());var e=this.template({juri:constants.get("juri"),language:{postbox:language.get("postbox")||{},event:t}});return $(e).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=$.extend({},constants.get("postbox.attachment")||{},{type:"event"}),this.staticAttachment)},trim:function(t){return(t||"").replace(/^\s+|\s+$/g,"")}})}),define("views/postbox/custom",["sandbox","views/postbox/default","views/dropdown/privacy","utils/ajax","utils/constants","utils/language"],function(t,e,i,s,o,n){return e.extend({subviews:{privacy:i},template:joms.jst["html/postbox/custom"],events:t.extend({},e.prototype.events,{"click .joms-postbox-predefined-message":"onCustomPredefined","click .joms-postbox-custom-message":"onCustomCustom","keyup [name=custom]":"onTextareaUpdate"}),initialize:function(){var i=o.get("settings")||{};(this.inheritPrivacy=i.isGroup||i.isEvent||!i.isMyProfile)&&(this.subviews=t.omit(this.subviews,"privacy")),e.prototype.initialize.apply(this),this.attachment={type:"custom"},t.extend(this.attachment,o.get("postbox.attachment")||{})},render:function(){return e.prototype.render.apply(this),this.$initial=this.$el.children(".joms-postbox-inner-panel"),this.$main=this.$el.children(".joms-postbox-custom"),this.$statepredefined=this.$(".joms-postbox-custom-state-predefined"),this.$statecustom=this.$(".joms-postbox-custom-state-custom"),this.$predefined=this.$("[name=predefined]"),this.$custom=this.$("[name=custom]"),this.$divs=this.$(".joms-postbox-dropdown").hide(),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.inheritPrivacy&&this.$tabprivacy.css({visibility:"hidden"}),this.inheritPrivacy||(this.initSubview("privacy",{privacylist:["public","site_members"]}),this.subviews.privacy.setPrivacy("public")),this},showInitialState:function(){this.$main.hide(),this.$initial.show(),e.prototype.showInitialState.apply(this)},showMainState:function(t){e.prototype.showMainState.apply(this),t?this.showPredefinedState():this.showCustomState()},showPredefinedState:function(){this.$initial.hide(),this.$statepredefined.show(),this.$statecustom.hide(),this.$main.show(),this.$save.show(),this.predefined=!0},showCustomState:function(){this.$initial.hide(),this.$statepredefined.hide(),this.$statecustom.show(),this.$main.show(),this.predefined=!1},reset:function(){e.prototype.reset.apply(this),this.$predefined&&this.$predefined.val(this.$predefined.find("option:first").val()),this.$custom&&this.$custom.val("")},value:function(){var t=[];return this.predefined?(t.push(this.$predefined.val()),t.push(this.$predefined.find("option:selected").text())):(t.push("system.message"),t.push(this.$custom.val().replace(/\n/g,"\\n"))),"privacy"in this.subflags&&t.push(this.subviews.privacy.value()),t},validate:function(){var t,e=this.value();return this.predefined?e[0]||(t="Predefined message cannot be empty."):e[1]||(t="Custom message cannot be empty."),t},onTextareaUpdate:function(){var t=this.$custom.val();t=t.replace(/^\s+|\s+$/g,""),this.$save[t?"show":"hide"]()},onCustomPredefined:function(){this.showMainState("predefined")},onCustomCustom:function(){this.showMainState()},onPost:function(){if(!this.saving){var e=this.validate();if(e)window.alert(e);else{this.saving=!0,this.$loading.show();var i=this;s({fn:"activities,ajaxAddPredefined",data:this.value(),success:t.bind(this.onPostSuccess,this),complete:function(){i.$loading.hide(),i.saving=!1,i.showInitialState()}})}}},onPrivacySelect:function(t){var e=this.$tabprivacy.find("use").attr("xlink:href");e=e.replace(/#.+$/,"#joms-icon-"+t.icon),this.$tabprivacy.find("use").attr("xlink:href",e),this.$tabprivacy.find("span").html(t.label)},getTemplate:function(){var e=o.get("customActivities")||{},i=[];for(var s in e)i.push([s,e[s]]);var a=this.template({juri:o.get("juri"),messages:i,language:{postbox:n.get("postbox"),custom:n.get("custom")}});return t(a).hide()}})}),define("views/postbox/layout",["sandbox","views/base","views/postbox/status","views/postbox/photo","views/postbox/video","views/postbox/event","views/postbox/custom","utils/constants"],function(t,e,i,s,o,n,a,l){return e.extend({subflags:{},subviews:{status:i,photo:s,video:o,event:n,custom:a},events:{"click .joms-postbox-tab-root li":"onChangeTab"},initialize:function(){this.listenTo(t,"postbox:status",this.onOpenStatusTab),this.listenTo(t,"postbox:photo",this.onOpenPhotoTab),this.listenTo(t,"postbox:video",this.onOpenVideoTab)},render:function(){var e=l.get("settings")||{},i=l.get("conf")||{};e.isAdmin&&i.enablecustoms||(this.subviews=t.omit(this.subviews,"custom")),e.isProfile&&!e.isMyProfile&&(this.subviews=t.pick(this.subviews,"status","photo","video")),e.isEvent&&(this.subviews=t.omit(this.subviews,"event")),(e.isProfile||e.isGroup||e.isEvent)&&(i.enablephotos||(this.subviews=t.omit(this.subviews,"photo")),i.enablevideos||(this.subviews=t.omit(this.subviews,"video")),i.enableevents||(this.subviews=t.omit(this.subviews,"event"))),this.subkeys=t.keys(this.subviews),this.$subviews=this.$(".joms-postbox-tabs"),this.$tab=this.$(".joms-postbox-tab-root").hide();var s=this;this.$tab.find("li").each(function(){var e=t(this),i=e.data("tab");s.subkeys.indexOf(i)<0&&e.remove()}),this.subkeys&&this.subkeys.length&&this.changeTab(this.subkeys[0])},show:function(){this.$el[t.isMobile?"show":"fadeIn"]()},changeTab:function(e){if(this.subviews[e]){var i=this.$tab.find("li[data-tab="+e+"]");i&&i.length&&(i.hasClass("active")||i.addClass("active"),i.siblings(".active").removeClass("active")),this.subflags[e]||this.initSubview(e);for(var s in this.subflags)s!==e&&this.subviews[s].hide();this.subviews[e].show(),t.trigger("postbox:tab:change",e)}},onChangeTab:function(e){this.changeTab(t(e.currentTarget).data("tab"))},onOpenStatusTab:function(){this.changeTab("status")},onOpenPhotoTab:function(){this.changeTab("photo")},onOpenVideoTab:function(){this.changeTab("video")},onShowInitialState:function(){this.subkeys.length>1&&this.$tab.show()},onShowMainState:function(){this.$tab.hide()},initSubview:function(t){this.subflags[t]||(this.subviews[t]=new this.subviews[t]({single:this.subkeys.length<=1}),this.assign(this.getSubviewElement(),this.subviews[t]),this.listenTo(this.subviews[t],"show:initial",this.onShowInitialState),this.listenTo(this.subviews[t],"show:main",this.onShowMainState),this.subflags[t]=!0)},getSubviewElement:function(){return t("<div>").hide().appendTo(this.$subviews)}})}),define("views/stream/filterbar",["sandbox","views/base","utils/ajax"],function(t,e,i){return e.extend({render:function(){this.$btn=t(".joms-activity-filter-action"),this.$list=t(".joms-activity-filter-dropdown"),this.$options=t(".joms-activity-filter__options"),this.$btn.on("click",t.bind(this.toggle,this)),this.$list.on("click","li",t.bind(this.select,this)),this.$list.on("change","select",t.bind(this.filterChange,this)),this.$list.on("keyup","input[type=text]",t.bind(this.filterKeyup,this)),this.$list.on("click","button.joms-button--primary",t.bind(this.filterSearch,this)),this.$options.find("li").not(".noselect").addClass("joms-js-filterbar-item"),t(document).on("click",".joms-js-filterbar-item",t.bind(this.makeDefault,this)),this.listenTo(t,"click",this.onDocumentClick)},toggle:function(){"none"===this.$list[0].style.display?this.expand():this.collapse()},expand:function(){this.$list.show()},collapse:function(){this.$list.hide()},select:function(e){var i=t(e.currentTarget),s=i.data("url")||"/";"__filter__"!==i.data("filter")&&(this.toggle(),window.location=s)},filterChange:function(t){var e=t.target.value,i=this.$list.find("input[type=text]"),s=this.$list.find(".joms-button--primary");"hashtag"!==e&&"keyword"!==e||(i.attr("placeholder",i.data("label-"+e)),s.html(s.data("label-"+e)))},filterKeyup:function(e){var i=t(e.currentTarget),s=i.val(),o=s;(o=o.replace(/#/g,"")).length!==s.length&&i.val(o)},filterSearch:function(e){var i,s,o,n;e.preventDefault(),e.stopPropagation(),s=(i=t(e.currentTarget).closest("li")).find("select").val(),(o=i.find("input").val().replace(/^\s+|\s+$/g,""))&&("hashtag"===s&&(o=(o=o.split(" "))[0]),n=(n=(n=i.data("url")).replace("__filter__",s)).replace("__value__",o),window.location=n)},makeDefault:function(e){var s,o,n,a;e.preventDefault(),e.stopPropagation(),o=(s=t(e.currentTarget)).find("a").data("value"),"hidden"===(n=this.$options.find(".noselect > img")).css("visibility")&&(n.css("visibility","visible"),a={},i({fn:"system,ajaxDefaultUserStream",data:[o],success:function(t){t&&(a=t)},complete:t.bind(function(){a.error?joms.popup.info("Error",a.error):a.success&&(joms.popup.info("",a.message),this.$options.find(".joms-dropdown").hide(),s.addClass("active").siblings("li").removeClass("active"),n.css("visibility","hidden"))},this)}))},onDocumentClick:function(t){t.closest(".joms-activity-filter").length||this.collapse()}})}),define("views/stream/layout",["sandbox","views/base","views/stream/filterbar"],function(t,e,i){return e.extend({initialize:function(){this.filterbar=new i},render:function(){this.filterbar.render()}})}),require(["sandbox","views/postbox/layout","views/stream/layout","utils/constants"],function(t,e,i,s){function o(){var i,s=t(".joms-postbox");s.length&&((i=new e({el:s})).render(),i.show())}function n(){(new i).render()}function a(){s.set("friends","fetching");var t=window.setInterval(function(){window.joms_friends&&(window.clearInterval(t),s.set("friends",window.joms_friends))},200)}t(function(){o(),n(),+window.joms_my_id&&a()})}),define("init",function(){}),require.config({deps:["init"]}),define("bundle",function(){})}(),joms_init_postbox=void 0}