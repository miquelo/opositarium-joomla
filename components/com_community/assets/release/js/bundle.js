!function(){var o,t,e;!function(n){function s(o,t){return g.call(o,t)}function i(o,t){var e,n,s,i,p,a,u,c,r,m,l,d=t&&t.split("/"),j=h.map,f=j&&j["*"]||{};if(o&&"."===o.charAt(0))if(t){for(d=d.slice(0,d.length-1),p=(o=o.split("/")).length-1,h.nodeIdCompat&&k.test(o[p])&&(o[p]=o[p].replace(k,"")),o=d.concat(o),r=0;r<o.length;r+=1)if("."===(l=o[r]))o.splice(r,1),r-=1;else if(".."===l){if(1===r&&(".."===o[2]||".."===o[0]))break;r>0&&(o.splice(r-1,2),r-=2)}o=o.join("/")}else 0===o.indexOf("./")&&(o=o.substring(2));if((d||f)&&j){for(r=(e=o.split("/")).length;r>0;r-=1){if(n=e.slice(0,r).join("/"),d)for(m=d.length;m>0;m-=1)if((s=j[d.slice(0,m).join("/")])&&(s=s[n])){i=s,a=r;break}if(i)break;!u&&f&&f[n]&&(u=f[n],c=r)}!i&&u&&(i=u,a=c),i&&(e.splice(0,a,i),o=e.join("/"))}return o}function p(o,t){return function(){return d.apply(n,w.call(arguments,0).concat([o,t]))}}function a(o){return function(t){return i(t,o)}}function u(o){return function(t){v[o]=t}}function c(o){if(s(b,o)){var t=b[o];delete b[o],_[o]=!0,l.apply(n,t)}if(!s(v,o)&&!s(_,o))throw new Error("No "+o);return v[o]}function r(o){var t,e=o?o.indexOf("!"):-1;return e>-1&&(t=o.substring(0,e),o=o.substring(e+1,o.length)),[t,o]}function m(o){return function(){return h&&h.config&&h.config[o]||{}}}var l,d,j,f,v={},b={},h={},_={},g=Object.prototype.hasOwnProperty,w=[].slice,k=/\.js$/;j=function(o,t){var e,n=r(o),s=n[0];return o=n[1],s&&(e=c(s=i(s,t))),s?o=e&&e.normalize?e.normalize(o,a(t)):i(o,t):(s=(n=r(o=i(o,t)))[0],o=n[1],s&&(e=c(s))),{f:s?s+"!"+o:o,n:o,pr:s,p:e}},f={require:function(o){return p(o)},exports:function(o){var t=v[o];return void 0!==t?t:v[o]={}},module:function(o){return{id:o,uri:"",exports:v[o],config:m(o)}}},l=function(o,t,e,i){var a,r,m,l,d,h,g=[],w=typeof e;if(i=i||o,"undefined"===w||"function"===w){for(t=!t.length&&e.length?["require","exports","module"]:t,d=0;d<t.length;d+=1)if(l=j(t[d],i),"require"===(r=l.f))g[d]=f.require(o);else if("exports"===r)g[d]=f.exports(o),h=!0;else if("module"===r)a=g[d]=f.module(o);else if(s(v,r)||s(b,r)||s(_,r))g[d]=c(r);else{if(!l.p)throw new Error(o+" missing "+r);l.p.load(l.n,p(i,!0),u(r),{}),g[d]=v[r]}m=e?e.apply(v[o],g):void 0,o&&(a&&a.exports!==n&&a.exports!==v[o]?v[o]=a.exports:m===n&&h||(v[o]=m))}else o&&(v[o]=e)},o=t=d=function(o,t,e,s,i){if("string"==typeof o)return f[o]?f[o](t):c(j(o,t).f);if(!o.splice){if((h=o).deps&&d(h.deps,h.callback),!t)return;t.splice?(o=t,t=e,e=null):o=n}return t=t||function(){},"function"==typeof e&&(e=s,s=i),s?l(n,o,t,e):setTimeout(function(){l(n,o,t,e)},4),d},d.config=function(o){return d(o)},o._defined=v,(e=function(o,t,e){t.splice||(e=t,t=[]),s(v,o)||s(b,o)||(b[o]=[o,t,e])}).amd={jQuery:!0}}(),e("../../vendors/almond",function(){}),function(o){joms.BASE_URL=o.joms_base_url,delete o.joms_base_url;var t=/https?:\/\/[^/]+/,n=joms.BASE_URL.match(t),s=location.href.match(t);n&&s&&n[0]!==s[0]&&joms.BASE_URL.replace(t,s[0]),joms.ASSETS_URL=o.joms_assets_url,delete o.joms_assets_url,joms.mobile=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent),joms.ios=/iphone|ipad|ipod/i.test(navigator.userAgent),joms.screenSize=function(){var o=window.innerWidth;return o<=480?"small":o<=991?"medium":"large"},joms.ajax=function(t){var e=o.jax_live_site||"",n=o.jax_token_var||"_no_token_found_",s={};if(t||(t={}),s[n]=1,s.task="azrul_ajax",s.option=t.option||"community",s.func=t.func,s.no_html=1,delete t.option,delete t.func,t.data&&t.data.length)for(var i,p=0;p<t.data.length;p++)"string"==typeof(i=t.data[p])&&(i=i.replace(/"/g,"&quot;")),joms._.isArray(i)||(i=["_d_",encodeURIComponent(i)]),s["arg"+(p+2)]=JSON.stringify(i);var a;return t.url=e,t.type="post",t.dataType="json",t.data=s,t.success=function(o){o&&(a=o)},t.complete=function(){if(a||(a={error:"Undefined error."}),a.noLogin)return joms.api&&joms.api.login(a),void joms.view.misc.fixSVG();var o;if(joms._onAjaxReponseQueue&&joms._onAjaxReponseQueue[s.func]&&joms._onAjaxReponseQueue[s.func].length)for(var e=0;e<joms._onAjaxReponseQueue[s.func].length;e++)"function"==typeof joms._onAjaxReponseQueue[s.func][e]&&!1===joms._onAjaxReponseQueue[s.func][e](a)&&(o=!0);"function"!=typeof t.callback||o||t.callback(a),joms.view.misc.fixSVG()},joms.jQuery.ajax(t)},joms.____=function(){for(var o=joms.jQuery("#community-wrap");o.length&&"body"!==o[0].tagName.toLowerCase();)o.siblings().hide(),(o=o.parent()).css({border:"0 none",padding:0,marginTop:0,marginBottom:0,width:"auto"})},joms._printSVGIcons=function(){for(var o=["home","newspaper","pencil","image","images","camera","play","film","camera2","bullhorn","library","profile","support","envelope","location","clock","bell","calendar","box-add","box-remove","bubble","bubbles","user","users","spinner","search","key","lock","wrench","cog","gift","remove","briefcase","switch","signup","list","menu","earth","link","eye","star","star2","star3","thumbs-up","happy","smiley","tongue","sad","wink","grin","cool","angry","evil","shocked","confused","neutral","wondering","warning","info","blocked","spam","close","checkmark","plus","arrow-right","arrow-left","tab","filter","console","share","facebook","libreoffice","file-zip","arrow-down","redo","tag","search-user"],t=joms.jQuery("<div>"),e=0;e<o.length;e++)t.append('<svg viewBox="0 0 30 30" class="joms-icon" style="width:30px;height:30px"><use xlink:href="#joms-icon-'+o[e]+'"></use></svg>');t.appendTo(document.body)},"function"==typeof e&&e("core",[],function(){return o.joms})}(this),function(o,t,e,n){joms.util||(joms.util={}),joms.util.crop=n(o,t,e)}(window,joms.jQuery,!joms.mobile,function(o,t,e){function n(o){return n.attach(o)}function s(){f.css({top:"",left:"",right:"",bottom:"",width:"",height:"",webkitTransform:"",mozTransform:"",transform:""})}function i(){var o=v[0],t=v.children("img"),e=f.position();h={imageWidth:t.width(),imageHeight:t.height(),wrapperTop:o.scrollTop,wrapperLeft:o.scrollLeft,wrapperWidth:v.width(),wrapperHeight:v.height(),cropperTop:e.top+o.scrollTop,cropperLeft:e.left+o.scrollLeft,cropperWidth:f.outerWidth(),cropperHeight:f.outerHeight()}}function p(o){i(),_=m(o)}function a(o){var t,e=h,n=o.deltaY,s=o.deltaX;s=Math.min(s,e.imageWidth-e.cropperWidth-e.cropperLeft),s=Math.max(s,0-e.cropperLeft),n=Math.min(n,e.imageHeight-e.cropperHeight-e.cropperTop),t="translate3d("+s+"px, "+(n=Math.max(n,0-e.cropperTop))+"px, 0)",f.css({webkitTransform:t,mozTransform:t,transform:t})}function u(o){var t=_,e=h,n={};t.match(/n/)?(n.top="auto",n.bottom=e.wrapperHeight-e.cropperTop-e.cropperHeight,n.height=e.cropperHeight-o.deltaY):t.match(/s/)&&(n.bottom="auto",n.top=e.cropperTop,n.height=e.cropperHeight+o.deltaY),t.match(/e/)?(n.right="auto",n.left=e.cropperLeft,n.width=e.cropperWidth+o.deltaX):t.match(/w/)&&(n.left="auto",n.right=e.wrapperWidth-e.cropperLeft-e.cropperWidth,n.width=e.cropperWidth-o.deltaX),n.width=n.height=Math.max(n.width||0,n.height||0,64),t.match(/n/)?n.height=Math.min(n.height,e.wrapperHeight-n.bottom):t.match(/s/)?n.height=Math.min(n.height,e.imageHeight-n.top):"auto"!==f[0].style.top?n.height=Math.min(n.height,e.imageHeight-parseInt(f.css("top"))):n.height=Math.min(n.height,e.wrapperHeight-parseInt(f.css("bottom"))),t.match(/e/)?n.width=Math.min(n.width,e.imageWidth-n.left):t.match(/w/)?n.width=Math.min(n.width,e.wrapperWidth-n.right):"auto"!==f[0].style.left?n.width=Math.min(n.width,e.imageWidth-parseInt(f.css("left"))):n.width=Math.min(n.width,e.wrapperWidth-parseInt(f.css("right"))),n.width=n.height=Math.min(n.width,n.height),f.css(n)}function c(){var o=f.position(),t=h;f.css({top:Math.max(o.top+t.wrapperTop,0),left:Math.max(o.left+t.wrapperLeft,0),right:"",bottom:"",webkitTransform:"",mozTransform:"",transform:""}),i()}function r(o,t){var e=f.offset();return{top:t-e.top,left:o-e.left}}function m(o){var t=e?15:20,n=r(o.center.pageX,o.center.pageY),s=h,i="";return n.top<t?i+="n":n.top>s.cropperHeight-t&&(i+="s"),n.left<t?i+="w":n.left>s.cropperWidth-t&&(i+="e"),i}function l(){e&&f.on("mousemove.joms-cropper",j)}function d(){e&&f.off("mousemove.joms-cropper")}function j(o){var e,n=t(o.target).parent().offset(),s=o.pageX-n.left,p=o.pageY-n.top,a="";i(),p<(e=h).cropperTop-e.wrapperTop+15?a+="n":p>e.cropperTop-e.wrapperTop+e.cropperHeight-15&&(a+="s"),s<e.cropperLeft-e.wrapperLeft+15?a+="w":s>e.cropperLeft-e.wrapperLeft+e.cropperWidth-15&&(a+="e"),f.css({cursor:a?a+"-resize":""})}var f,v,b,h,_;n.init=function(){v||(v=t('<div class="joms-cropper__wrapper" />')),f||(f=t('<div class="joms-cropper__box" />'))},n.attach=function(o){return n.init(),n.detach(),s(),t(o).wrap(v),v=t(o).parent(),f.insertAfter(o),b||(b=new joms.Hammer(f[0])).on("touch drag release",function(o){o.stopPropagation(),o.preventDefault(),o.gesture.stopPropagation(),o.gesture.preventDefault(),"touch"===o.type?(d(),p(o.gesture)):"release"!==o.type?g(o.gesture):(c(o.gesture),l())}),l(),o},n.detach=function(){n.init(),f.detach(),v.children().unwrap(),v.detach()},n.getSelection=function(){var o=h;return{x:o.cropperLeft,y:o.cropperTop,width:o.cropperWidth,height:o.cropperHeight}};var g=joms._.throttle(function(o){_?u(o):a(o)},e?10:100);return n}),e("utils/crop",function(){}),e("utils/map",["core"],function(){function o(){t||(t=this)}var t,e=window.joms_gmap_key,n=jQuery;o.prototype={search:function(o){var t=this;return n.Deferred(function(e){t.autocompleteService().then(function(n){n.getPlacePredictions({input:o},function(o,n){"OK"===n?e.resolve(t.mapResult(o)):e.reject(n)})})})},mapResult:function(o){var t=[];return _.isArray(o)&&_.each(o,function(o){var e=o.place_id,n=o.description.split(/,\s(.+)?/),s=n[0],i=n[1]||"";t.push({id:e,name:s,description:i})}),t},render:function(o,t){var e,s,i=n(o).show(),p=i.data("joms-map"),a=i.data("joms-map-marker"),u=t.formatted_address||"";t.geometry?(e=t.geometry.location,s=t.geometry.viewport):e=new google.maps.LatLng(t.latitude,t.longitude),p||i.data("joms-map",p=new google.maps.Map(o,{center:e,zoom:15,draggable:!1,scrollwheel:!1,disableDefaultUI:!0})),a||i.data("joms-map-marker",a=new google.maps.Marker({map:p,position:e,title:u})),p.setCenter(e),a.setPosition(e),s?p.fitBounds(s):p.setZoom(15)},loadAPI:function(){var o=this;return n.Deferred(function(t){var n,s;window.google&&window.google.maps&&window.google.maps.places?t.resolve():o.loaded?t.resolve():(o.queue=o.queue||[],o.queue.push(t),o.loading||(o.loading=!0,s=_.uniqueId("jomsCallback"),(n=document.createElement("script")).type="text/javascript",n.src="https://maps.googleapis.com/maps/api/js?libraries=places"+(e?"&key="+e:"")+"&callback="+s,window[s]=function(){for(o.loaded=!0,o.loading=!1;o.queue.length;)o.queue.shift().resolve();delete window[s]},document.body.appendChild(n)))})},autocompleteService:function(){var o=this;return n.Deferred(function(t){o.loadAPI().then(function(){var e="_cacheAutocompleteService";o[e]=o[e]||new google.maps.places.AutocompleteService,t.resolve(o[e])})})},placeService:function(){var o=this;return n.Deferred(function(t){o.loadAPI().then(function(){var e="_cachePlaceService",n=document.createElement("div");document.body.appendChild(n),o[e]=o[e]||new google.maps.places.PlacesService(n),t.resolve(o[e])})})},placeDetail:function(o){var t=this;return n.Deferred(function(e){t.placeService().then(function(n){var s="_cachePlaceDetail";t[s]=t[s]||{},t[s][o]?e.resolve(t[s][o]):n.getDetails({placeId:o},function(n,i){"OK"===i?(t[s][o]=n,e.resolve(n)):e.reject(i)})})})}},joms.util||(joms.util={}),joms.util.map=function(t){"function"==typeof t&&(new o).loadAPI().done(function(){t()})},joms.util.map.search=function(t){return n.Deferred(function(e){(new o).search(t).done(function(o){e.resolve(o)})})},joms.util.map.detail=function(t){return n.Deferred(function(e){(new o).placeDetail(t).done(function(o){e.resolve(o)})})}}),e("utils/popup",["core","utils/map"],function(){function o(){}o.prototype.prepare=function(o){var t,e;if(joms.jQuery.magnificPopup)return t=this.showPopup(),void o(t);e=this,this.loadlib(function(){joms.jQuery.magnificPopup&&(t=e.showPopup(),o(t))})},o.prototype.showPopup=function(){joms.jQuery.magnificPopup.open({type:"inline",items:{src:[]},tClose:window.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,tLoading:window.joms_lang.COM_COMMUNITY_POPUP_LOADING});var o=joms.jQuery.magnificPopup.instance,t="joms-popup__wrapper";return joms.mobile&&(t+=" joms-popup__mobile"),o.container.addClass(t),o.updateStatus("loading"),o.container.off("click.joms-closepopup",".joms-js--button-close").on("click.joms-closepopup",".joms-js--button-close",function(){o.close()}),o},o.prototype.loadlib=function(o){o()},joms.util||(joms.util={}),joms.util.popup=new o}),function(o,t,n){joms.util||(joms.util={}),joms.util.dropdown=n(o,t),e("utils/dropdown",["utils/popup"],function(){return joms.util.dropdown})}(window,joms.jQuery,function(o,t,e){function n(){m&&m.hide(),r&&p(r)}function s(o){var e,s;if(o.stopPropagation(),o.preventDefault(),e=t(o.currentTarget),(s=e.siblings(h)).length)return s.is(":visible")?(s.hide(),void p(e)):"large"===joms.screenSize()?(n(),s.show(),i(e),r=e,m=s,void u(s)):void joms.util.popup.prepare(function(o){(l=o).items[0]={type:"inline",src:a(s)},l.updateItemHTML(),u(s),(d=l.contentContainer).on("click","li > a",function(){l.close()})})}function i(o){var t=o.parent();t.hasClass(".joms-focus__button--options--desktop")?t.addClass("active"):o.addClass("active")}function p(o){var t=o.parent();t.hasClass(".joms-focus__button--options--desktop")?t.removeClass("active"):o.removeClass("active")}function a(o){return'<div class="joms-popup joms-popup--dropdown">'+o[0].outerHTML+"</div>"}function u(o){var t=o.attr("class")||"";o.css("left",""),o.offset().left<0&&o.css("left",-25),t.match("joms-popover--toolbar-general")?joms.api.notificationGeneral():t.match("joms-popover--toolbar-friendrequest")?joms.api.notificationFriend():t.match("joms-popover--toolbar-pm")&&joms.api.notificationPm()}function c(){j&&(j.off(f),j.off(f,b),j.off(v,b),j.off(f,h))}var r,m,l,d,j,f="click.dropdown",v="collapse.dropdown",b="[data-ui-object=joms-dropdown-button]",h=".joms-dropdown,.joms-popover",_=joms._.debounce(function(e){var s,i,p,a,u,c;(e.currentTarget.className||"").indexOf("joms-dropdown--privacy")<0||(s=t(e.currentTarget),(i=t(e.target).closest("li")).length&&(a=(p=t(".joms-button--privacy").filter('[data-name="'+s.data("name")+'"]')).children("[data-ui-object=joms-dropdown-value]"),u=p.children("span"),c=p.find("use"),a.val(i.data("value")),u.html(i.children("span").html()),c.attr("xlink:href",o.location.href.replace(/#.*$/,"")+"#"+i.data("classname"))),n(),l&&l.close())},100);return{start:function(){c(),j||(j=t(document.body)),j.on(f,n),j.on(f,b,s),j.on(v,b,n),j.on(f,h,function(o){t(o.target).data("propagate")||t(o.currentTarget).data("propagate")||o.stopPropagation(),_(o)})},stop:c}}),function(o,t,e){joms.util||(joms.util={}),joms.util.hovercard=e(o,t)}(window,joms.jQuery,function(o,t){function e(o){var e=t(o.target),n=e.data("author");if(e.removeAttr("title"),p||s(),clearTimeout(u),c[n])return clearTimeout(a),void(a=setTimeout(function(){i(c[n],e)},400));joms.ajax({func:"profile,ajaxFetchCard",data:[n],callback:function(o){o.html&&(c[n]=o.html,clearTimeout(a),i(o.html,e))}})}function n(){clearTimeout(a),u=setTimeout(function(){p&&p.hide()},400)}function s(){(p=t("<div>Loading...</div>")).css({position:"absolute",zIndex:2e3}),p.appendTo(document.body),p.on(r,function(){clearTimeout(u)}),p.on(m,n)}function i(e,n){var s=t(document),i=n.offset(),a=n.width(),u=n.height(),c=o.innerWidth,r=o.innerHeight+s.scrollTop(),m=140,l=i.left+320<c,d=i.top+u+10;p.html(e),p.css({top:-1e4,left:l?i.left:"",right:l?"":c-i.left-a}),p.show(),d+(m=p.height())>r&&(d=i.top-m-4),p.css({top:d})}var p,a,u,c={},r="mouseover.joms-hcard",m="mouseout.joms-hcard",l="img[data-author]";return{initialize:function(){joms.mobile||t(document.body).off(r).off(m).on(r,l,e).on(m,l,n)}}}),e("utils/hovercard",function(){}),function(o,t){joms.util||(joms.util={}),joms.util.loadLib=t(o)}(window,function(o){function t(o){return o()}function e(t){if(o.MediaElement)return t();joms.$LAB.script(joms.ASSETS_URL+"vendors/mediaelement/mediaelement-and-player.min.js").wait(function(){t()})}function n(t){if(o.flowplayer)return t();joms.$LAB.script(joms.ASSETS_URL+"flowplayer/flowplayer-3.2.6.min.js").wait(function(){t()})}function s(t){if(o.plupload)return t();joms.$LAB.script(joms.ASSETS_URL+"vendors/plupload.min.js").wait(function(){t()})}function i(o){return!!joms.jQuery&&(joms.jQuery.trumbowyg?o():(joms.loadCSS(joms.ASSETS_URL+"vendors/trumbowyg/ui/trumbowyg.min.css"),void joms.$LAB.script(joms.ASSETS_URL+"vendors/trumbowyg/trumbowyg.min.js").wait().script(joms.ASSETS_URL+"vendors/trumbowyg/plugins/base64/trumbowyg.base64.min.js").wait().script(joms.ASSETS_URL+"vendors/trumbowyg/plugins/upload/trumbowyg.upload.js").wait(function(){o()})))}function p(t){if(o.Sortable)return t();joms.$LAB.script(joms.ASSETS_URL+"dragsort/jquery.dragsort-0.5.1.min.js").wait(function(){t()})}return function(o,a){return"gmap"===o?t(a):"mediaelement"===o?e(a):"flowplayer"===o?n(a):"plupload"===o?s(a):"trumbowyg"===o?i(a):"dragsort"===o?p(a):void a()}}),e("utils/loadlib",function(){}),function(o,t,n,s){var i=s(window,t,n);e("utils/location-autocomplete",["utils/map"],function(){return i}),t.fn.locationAutocomplete=function(){return this.each(function(){var o="location-autocomplete",e=t(this);e.data(o)||e.data(o,new i(this))})},t(function(){t(".joms-input--location").locationAutocomplete()})}(0,joms.jQuery,window._,function(o,t,e){function n(o){this.$input=t(o),this.$wrapper=this.$input.parent(".joms-location__wrapper"),this.$inputDesc=this.$input.siblings(".js-desc"),this.$inputLat=this.$input.siblings(".js-lat"),this.$inputLng=this.$input.siblings(".js-lng"),this.$description=this.$input.siblings(".joms-location__description"),this.$dropdown=this.$input.siblings(".joms-location__dropdown"),this.$loading=this.$dropdown.find(".joms-location__loading"),this.$result=this.$dropdown.find(".joms-location__result"),this.$header=this.$dropdown.find(".joms-location__header"),this.$map=this.$dropdown.find(".joms-location__map"),this.$list=this.$dropdown.find(".joms-location__list"),this.$input.on("focus.joms-location",t.proxy(this.focus,this)),this.$input.on("blur.joms-location",t.proxy(this.hide,this)),this.$input.on("input.joms-location",t.proxy(this.search,this)),this.$dropdown.on("mousedown",".joms-location__list a",t.proxy(this.select,this)),this.$dropdown.on("click",".joms-location__close",t.proxy(this.hide,this))}return n.prototype.show=function(){this.$dropdown.show()},n.prototype.hide=function(){this.$dropdown&&this.$dropdown.hide()},n.prototype.focus=function(){this._search_success&&this.show()},n.prototype.search=function(){var o=t.trim(this.$input.val());this.$wrapper.css("display","inline-block"),this.$description.html(this.$description.data("tips")),o&&(this.$result.hide(),this.$loading.show(),this.$dropdown.show(),this._search(o)),setTimeout(t.proxy(function(){this.$wrapper.css("display","")},this),0)},n.prototype._search=e.debounce(function(o){this._get_autocomplete_service().done(function(e){e.getPlacePredictions({input:o},t.proxy(function(o,t){this.$loading.hide(),this.$result.show(),"OK"===t&&(this.$list.html(this._format_result(o)),this._search_success=!0)},this))})},1e3),n.prototype.select=function(o){var e=t(o.currentTarget),n=e.find(".js-name").text(),s=e.find(".js-desc").text(),i=e.data("place-id");o.preventDefault(),o.stopPropagation(),i&&(this.$input.val(n),this.$inputDesc.val(s),this.$description.html(s),this._get_location_detail(i).done(function(o){var t=o.geometry.location;this.$inputLat.val(t.lat()),this.$inputLng.val(t.lng()),this._render_map(this.$map[0],o)}))},n.prototype._load_library=function(){return t.Deferred(t.proxy(function(e){joms.util.map(t.proxy(function(){e.resolveWith(this,[o.google])},this))},this))},n.prototype._get_autocomplete_service=function(){return t.Deferred(t.proxy(function(o){this._autocomplete_service?o.resolveWith(this,[this._autocomplete_service]):this._load_library().done(function(t){this._autocomplete_service=new t.maps.places.AutocompleteService,o.resolveWith(this,[this._autocomplete_service])})},this))},n.prototype._get_location_service=function(){return t.Deferred(t.proxy(function(o){this._location_service?o.resolveWith(this,[this._location_service]):this._load_library().done(function(t){var e=document.createElement("div");document.body.appendChild(e),this._location_service=new t.maps.places.PlacesService(e),o.resolveWith(this,[this._location_service])})},this))},n.prototype._get_location_detail=function(o){return t.Deferred(t.proxy(function(e){this._location_cache&&this._location_cache[o]?e.resolveWith(this,[this._location_cache[o]]):this._get_location_service().done(function(n){n.getDetails({placeId:o},t.proxy(function(t,n){"OK"===n?(this._location_cache||(this._location_cache={}),this._location_cache[o]=t,e.resolveWith(this,[t])):e.rejectWith(this,[n])},this))})},this))},n.prototype._render_map=function(e,n){var s,i,p=n.geometry.location,a=n.geometry.viewport;s=(e=t(e).show()).data("joms-map"),i=e.data("joms-map-marker"),s||(s=new o.google.maps.Map(e[0],{center:p,zoom:15,draggable:!1,scrollwheel:!1,disableDefaultUI:!0}),e.data("joms-map",s)),i||(i=new o.google.maps.Marker({position:p,map:s,title:"You are here (more or less)"}),e.data("joms-map-marker",i)),s.setCenter(p),i.setPosition(p),a?s.fitBounds(a):s.setZoom(15)},n.prototype._format_result=function(o){var t,e,n,s,i=[];for(t=['<a href="javascript:" data-place-id="{place_id}">','<span class="joms-location__name js-name">{name}</span>','<span class="joms-location__desc js-desc">{description}</span>',"</a>"].join(""),s=0;s<o.length;s++)e=(e=o[s].description).split(/,\s(.+)?/),n=t.replace("{place_id}",o[s].place_id).replace("{name}",e[0]).replace("{description}",e[1]||"&nbsp;"),i.push(n);return i.join("")},n}),function(o,t){joms.util||(joms.util={}),joms.util.tab=t()}(window,function(){function o(){function o(o){var t,e,i=joms.jQuery(o.currentTarget),p=i.parent(n),a=i.attr("href");if(i.find(".joms-tab__bar--button").length&&((e=joms.jQuery(o.target)).hasClass("add")||e[0].tagName.match(/use|svg/i)))return o.preventDefault(),o.stopPropagation(),!1;if(0===a.indexOf("#"))return i.closest(n).siblings(a).show().siblings(s).hide(),i.addClass("active").siblings("a").removeClass("active"),(t=p.data("id"))&&(t="#tab:"+t+"/"+i.data("id"),window.location=t),!1}function t(){e&&e.off("click.joms-tab")}var e,n=".joms-tab__bar",s=".joms-tab__content";t(),e||(e=joms.jQuery(document.body)),e.on("click.joms-tab",n+" a",o)}function t(){joms.jQuery(".cTabsBar").on("click","li",function(o){var t,e,n=joms.jQuery(o.currentTarget),s=n.closest(".cTabsBar").siblings(".cTabsContentWrap");s.length&&(t=n.prevAll().length,(e=s.children(".cTabsContent").eq(t)).length&&(n.addClass("cTabCurrent").siblings(".cTabCurrent").removeClass("cTabCurrent"),e.siblings(".cTabsContent").hide(),e.show()))})}return{start:function(){o(),t()}}}),e("utils/tab",function(){}),function(o,t,e){joms.util||(joms.util={}),joms.util.tagging=e(o,t),t.fn.jomsTagging=function(o){return this.each(function(){joms.util.tagging(this,o)})}}(window,joms.jQuery,function(o,t){function e(o,e){return this.textarea=o,this.fetcher=e||!1,this.$textarea=t(o),this.$textarea.data("initialValue",o.value),this.$textarea.data(n,this),this.$textarea.on("focus."+n,t.proxy(this.initialize,this)),this}var n="joms-tagging",s=".joms-textarea",i=s+"__wrapper",p=s+"__beautifier",a=s+"__hidden",u=s+"__tag-ct",c=s+"__tag-item",r=c+"--active",m=/@\[\[(\d+):contact:([^\]]+)\]\]/g,l=/@\[\[(\d+):contact:([^\]]+)\]\]/,d=/(^|#|\s)(#[^#\s]+)/g,j=/\n/g;return e.prototype.initialize=function(){var o,e,s,i,p;if(this.dropdownIsOpened=!1,this.dropdownIsClicked=!1,this.dropdownSelectedItem=!1,this.domPrepare(),this.tagsAdded=[],o="",this.$textarea.data("initialValue")&&(o=this.textarea.value,e=o.match(m),this.textarea.value=o.replace(m,"$2"),e&&e.length))for(p=0;p<e.length;p++)s=e[p].match(l),i=o.indexOf(e[p]),o=o.replace(e[p],s[2]),this.tagsAdded.push({id:s[1],name:s[2],start:i,length:s[2].length});this.beautifierUpdate(o,this.tagsAdded),this.hiddenUpdate(o,this.tagsAdded),this.inputAutogrow(),this.$textarea.off("focus."+n).on("focus."+n,t.proxy(this.inputOnKeydown,this)).off("click."+n).on("click."+n,t.proxy(this.inputOnKeydown,this)).off("keydown."+n).on("keydown."+n,t.proxy(this.inputOnKeydown,this)).off("keyup."+n).on("keyup."+n,t.proxy(this.inputOnKeyup,this)).off("input."+n).on("input."+n,t.proxy(this.inputOnInput,this)).off("blur."+n).on("blur."+n,t.proxy(this.inputOnBlur,this)),this.$dropdown.off("mouseenter."+n).on("mouseenter."+n,c,t.proxy(this.dropdownOnMouseEnter,this)).off("mousedown."+n).on("mousedown."+n,c,t.proxy(this.dropdownOnMouseDown,this)).off("mouseup."+n).on("mouseup."+n,c,t.proxy(this.dropdownOnMouseUp,this)),this.textarea.joms_beautifier=this.$beautifier,this.textarea.joms_hidden=this.$hidden;var a=this;this.textarea.joms_reset=function(){a.inputReset()}},e.prototype.domPrepare=function(){this.$wrapper=this.$textarea.parent(i),this.$wrapper.length||(this.$textarea.wrap('<div class="'+i.substr(1)+'"></div>'),this.$wrapper=this.$textarea.parent()),this.$beautifier=this.$wrapper.children(p),this.$beautifier.length||(this.$beautifier=t('<div class="'+s.substr(1)+" "+p.substr(1)+'"></div>'),this.$beautifier.prependTo(this.$wrapper)),this.$hidden=this.$wrapper.children(a),this.$hidden.length||(this.$hidden=t('<input type="hidden" class="'+a.substr(1)+'">'),this.$hidden.appendTo(this.$wrapper)),this.$dropdown=this.$wrapper.children(u),this.$dropdown.length||(this.$dropdown=t('<div class="'+u.substr(1)+'"></div>'),this.$dropdown.appendTo(this.$wrapper))},e.prototype.inputPrepare=function(){},e.prototype.inputReset=function(){this.tagsAdded&&(this.tagsAdded=[])},e.prototype.inputAutogrow=function(){var o,t=+this.$textarea.data(n+"-prevHeight");this.$wrapper.css({height:t}),this.$textarea.css({height:""}),o=this.textarea.scrollHeight+2,this.$textarea.css({height:o}),o!==+t&&this.$textarea.data(n+"-prevHeight",o),this.$wrapper.css({height:""})},e.prototype.inputOnKeydown=function(o){return!(this.dropdownIsOpened&&[13,27,38,40].indexOf(o.keyCode)>=0)&&(27===o.keyCode?(this.inputReset(),!1):(this.prevSelStart=this.textarea.selectionStart,void(this.prevSelEnd=this.textarea.selectionEnd)))},e.prototype.inputOnKeyup=function(o){if(this.dropdownIsOpened){if(38===o.keyCode||40===o.keyCode)return this.dropdownChangeItem(o.keyCode),!1;if(13===o.keyCode)return this.dropdownSelectItem(),!1;if(27===o.keyCode)return this.dropdownHide(),!1}},e.prototype.inputOnInput=function(){var o,t,e,n,s,i,p,a,u,c,r,m=this.textarea.value;if(this.tagsAdded){if(this.prevSelStart!==this.prevSelEnd)for(c=0;c<this.tagsAdded.length;c++)e=(t=this.tagsAdded[c]).start+t.length,(this.prevSelStart>t.start&&this.prevSelStart<e||this.prevSelEnd>t.start&&this.prevSelEnd<e||t.start>=this.prevSelStart&&e<=this.prevSelEnd)&&this.tagsAdded.splice(c--,1);for(o=this.textarea.selectionStart-this.prevSelStart-(this.prevSelEnd-this.prevSelStart),c=0;c<this.tagsAdded.length;c++)if((t=this.tagsAdded[c]).start>=this.prevSelStart)t.start+=o;else if((e=t.start+t.length)<this.prevSelStart);else if(e>this.prevSelStart){if(o>0)this.tagsAdded.splice(c--,1);else if(o<0){for(i=(n=m.substring(t.start,this.prevSelStart+o)).split(" ").length-1,(n=t.name.split(" ")).splice(i,1),n=n.join(" "),s=(s=(s=t.name.split(" ")).slice(0,i)).join(" "),p=new RegExp("^([\\s\\S]{"+t.start+"})([\\s\\S]{"+(t.length+o)+"})"),a="$1"+n,this.textarea.value=this.textarea.value.replace(p,a),this.textarea.setSelectionRange(t.start+s.length,t.start+s.length),m=this.textarea.value,u=t.length-n.length,t.name=n,t.length=n.length,r=c+1;r<this.tagsAdded.length;r++)this.tagsAdded[r].start-=u;n.length||this.tagsAdded.splice(c--,1),c=this.tagsAdded.length}}else if(o<0){for((n=t.name.split(" ")).pop(),n=n.join(" "),p=new RegExp("^([\\s\\S]{"+t.start+"})([\\s\\S]{"+(t.length+o)+"})"),a="$1"+n,this.textarea.value=this.textarea.value.replace(p,a),this.textarea.setSelectionRange(t.start+n.length,t.start+n.length),m=this.textarea.value,u=t.length-n.length,t.name=n,t.length=n.length,r=c+1;r<this.tagsAdded.length;r++)this.tagsAdded[r].start-=u;n.length||this.tagsAdded.splice(c--,1),c=this.tagsAdded.length}}this.inputAutogrow(),this.beautifierUpdate(m,this.tagsAdded||[]),this.hiddenUpdate(m,this.tagsAdded||[]),this.dropdownToggle()},e.prototype.inputOnBlur=function(){this.dropdownIsClicked||this.dropdownHide()},e.prototype.beautifierUpdate=joms._.debounce(function(o,t){var e,n,s,i,p;if(t.length){for(e="^",n="",s=0,p=0;p<t.length;p++)e+="([\\s\\S]{"+((i=t[p]).start-s)+"})([\\s\\S]{"+i.length+"})",n+="$"+(2*p+1)+"[b]"+i.name+"[/b]",s=i.start+i.length;e=new RegExp(e),o=o.replace(e,n)}o=(o=(o=(o=o.replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/\[(\/?b)\]/g,"<$1>")).replace(d,"$1<b>$2</b>")).replace(j,"<br>"),this.$beautifier.html(o)},joms.mobile?100:1),e.prototype.hiddenUpdate=joms._.debounce(function(o,t){var e,n,s,i,p;if(t.length){for(e="^",n="",s=0,p=0;p<t.length;p++)e+="([\\s\\S]{"+((i=t[p]).start-s)+"})([\\s\\S]{"+i.length+"})",n+="$"+(2*p+1)+"@[["+i.id+":contact:"+i.name+"]]",s=i.start+i.length;e=new RegExp(e),o=o.replace(e,n)}this.$hidden.val(o)},joms.mobile?500:50),e.prototype.dropdownToggle=joms._.debounce(function(){var o=this.textarea.selectionStart,t=this.textarea.value.substr(0,o),e=t.lastIndexOf("@");e<0||++e>=o?this.dropdownHide():(t=t.substring(e,o),this.dropdownFetch(t,joms._.bind(this.dropdownUpdate,this)))},joms.mobile?1e3:200),e.prototype.dropdownFetch=function(t,e,n){var s,i,p,a,u,c=(o.joms_friends||[]).concat(n||[]),r=this.tagsAdded||[],m=[],l=[];if(c&&c.length)for(t=t.toLowerCase(),a=0;a<c.length&&m.length<20;a++)if(s=c[a],(s.name||"").toLowerCase().indexOf(t)>=0){for(i=!1,u=0;u<r.length;u++)if(+s.id==+r[u].id){i=!0;break}!i&&l.indexOf(+s.id)<0&&(l.push(+s.id),m.push({id:s.id,name:s.name,img:s.avatar}))}m.sort(function(o,t){return o.name<t.name?-1:o.name>t.name?1:0}),e(m),"function"!=typeof this.fetcher||n||(p=this,this.fetcher(function(o){o||(o=[]),p.dropdownFetch(t,joms._.bind(p.dropdownUpdate,p),o)}))},e.prototype.dropdownUpdate=function(o){var t,e,n,s,i;if(o&&o.length){for(t="",n=c.substr(1),i=Math.min(10,o.length),s=0;s<i;s++)t+='<a href="javascript:" class='+n+' data-id="'+(e=o[s]).id+'" data-name="'+e.name+'">',t+='<img src="'+e.img+'">'+e.name+"</a>";this.dropdownShow(t)}else this.dropdownHide()},e.prototype.dropdownShow=function(o){this.$dropdown.html(o).show(),this.dropdownIsOpened=!0,this.dropdownSelectedItem=!1},e.prototype.dropdownHide=function(){this.$dropdown.hide(),this.dropdownIsOpened=!1},e.prototype.dropdownOnMouseEnter=function(o){this.dropdownChangeItem(o)},e.prototype.dropdownOnMouseDown=function(){this.dropdownIsClicked=!0},e.prototype.dropdownOnMouseUp=function(o){this.dropdownSelectItem(o),this.dropdownIsClicked=!1,this.dropdownHide()},e.prototype.dropdownChangeItem=function(o){var e,n,s,i=r.substr(1);if("number"!=typeof o)return e=this.dropdownSelectedItem=t(o.target),n=e.siblings(r),e.addClass(i),void n.removeClass(i);(e=this.$dropdown.children(r)).length?(s=e[38===o?"prev":"next"](),e.removeClass(i),s.length?(this.dropdownSelectedItem=s,s.addClass(i)):this.dropdownSelectedItem=!1):(e=this.dropdownSelectedItem=this.$dropdown.children()[38===o?"last":"first"]()).addClass(i)},e.prototype.dropdownSelectItem=function(o){var e,n,s=o?t(o.currentTarget):this.dropdownSelectedItem,i=s.data("id"),p=s.data("name"),a=this.textarea.selectionStart,u=this.textarea.value.substr(0,a).lastIndexOf("@");this.tagsAdded||(this.tagsAdded=[]),this.tagsAdded.push({id:i,name:p,start:u,length:p.length}),e=new RegExp("^([\\s\\S]{"+u+"})[\\s\\S]{"+(a-u)+"}"),n=this.textarea.value.replace(e,"$1"+p),this.textarea.value=n,this.inputAutogrow(),this.beautifierUpdate(n,this.tagsAdded),this.hiddenUpdate(n,this.tagsAdded),this.dropdownHide()},e.prototype.clear=function(){this.tagsAdded=[],this.$textarea&&this.$textarea.val(""),this.$hidden&&this.$hidden.val(""),this.$beautifier&&this.$beautifier.empty()},function(o,s){var i=t(o).data(n);return i||new e(o,s)}}),e("utils/tagging",function(){}),function(o,t,e){joms.util||(joms.util={}),joms.util.validation=e(o,t)}(window,joms.jQuery,function(o,t){function e(o){var e,n;return o=t(o),e=o.parent(".joms-select--wrapper, .joms-textarea__wrapper, .joms-location__wrapper"),(n=e.length?e.next("p.joms-help"):o.next("p.joms-help")).length||(n=t('<p class="joms-help" style="color:red">')).hide().insertAfter(e.length?e:o),n}function n(){t(".joms-form__group").find("[required]").add(t(".joms-form__group").find("[data-required]")).each(function(){var o=t(this).closest(".joms-form__group").children().first();o.find(".joms-required").length||o.append(' <span class="joms-required">*</span>')})}function s(){var o=t(".joms-form__group").find("textarea[data-maxchars]");o.css("display","inline"),o.wrap('<div style="position:relative"></div>'),o.parent().append('<div class="joms-js--textarea-counter" style="position:absolute;bottom:2px;right:5px"></div>'),o.each(function(){var o=t(this);o.siblings(".joms-js--textarea-counter").html(o.data("maxchars"))}),o.off("input").on("input",function(){var o,e=t(this),n=e.siblings(".joms-js--textarea-counter"),s=e.data("maxchars")||0;s&&((o=e.val()).length>s&&(o=o.substr(0,s),e.val(o)),n.html(s-o.length))})}function i(){var o="joms-textarea--error",e="input.joms-textarea-limit";t(".joms-textarea__wrapper").find(".joms-textarea--limit").off(e).on(e,function(){var e=t(this),n=e.parent(".joms-textarea__wrapper"),s=n.find(".joms-textarea__limit > span > span"),i=e.data("min-char"),p=e.data("max-char"),a=e.val(),u=a.length;n.length||(n=e),i=isNaN(i)?0:Math.max(0,+i),p=!isNaN(p)&&Math.max(i,+p),u<i?n.hasClass(o)||n.addClass(o):(n.hasClass(o)&&n.removeClass(o),!1!==p&&u>p&&(a=a.substr(0,p),e.val(a))),n.css("display","inline-block"),s.html(a.length),setTimeout(function(){n.css("display","")},0)})}function p(){var o="validate.joms-validation",n=t(".joms-form__group");n.find("[required]").add(n.find("[data-required]")).off("focus.joms-validation").on("focus.joms-validation",function(){var o=t(this);o.data("currentValue",o.val())}).off("blur.joms-validation").on("blur.joms-validation",function(e,n){var s=t(this),i=s.data("currentValue");void 0!==i&&s.val()!==i&&s.trigger(o,n)}).off(o).on(o,function(n,s){var i,p=t(this),f=e(p),v=p.closest(".joms-form__group").children().first(),b=p.attr("name"),h=(p.attr("type")||"").toLowerCase(),_=p.prop("tagName").toLowerCase(),g=t.trim(v.text().replace(/\*/g,"")),w=t.trim(p.val());(h.match(/^(text|password)$/)||_.match(/^(select|textarea)$/))&&("function"!=typeof s&&(s=function(){var e,n=p.data("verify");n&&(e=t(n)).length&&t.trim(e.val())&&e.trigger(o)}),w?"username"===(i=p.data("validation")||"")?a(p,w,s,p.data("current")||""):"email"===i?u(p,w,s):i.match(/^email:/)?c(p,w,s):"password"===i?r(p,w,s):i.match(/^password:/)?m(p,w,s):(f.fadeOut(),s(d)):(l(p,[b,g,"COM_COMMUNITY_REGISTER_INVALID_VALUE"]),s(j)))})}function a(o,t,n,s){joms.ajax({func:"register,ajaxCheckUserName",data:[t,s],callback:function(t){var s=e(o);t.error?(s.html(t.error),s.show(),n(j)):(s.fadeOut(),n(d))}})}function u(o,t,n){if(!/^([*+!.&#$¦\'\\%\/0-9a-z^_`{}=?~:-]+)@(([0-9a-z-]+\.)+[0-9a-z]{2,8})$/i.test(t))return l(o,["","","COM_COMMUNITY_INVALID_EMAIL"]),void n(j);joms.ajax({func:"register,ajaxCheckEmail",data:[t],callback:function(t){var s=e(o);t.error?(s.html(t.error),s.show(),n(j)):(s.fadeOut(),n(d))}})}function c(o,n,s){var i,p,a;return i=o.data("validation").split(":"),p=t(i[1]),a=e(o),p.length&&n!==p.val()?(l(o,["","","COM_COMMUNITY_REGISTER_EMAIL_NOT_SAME"]),void s(j)):(a.fadeOut(),void s(d))}function r(o,t,n){joms.ajax({func:"register,ajaxCheckPass",data:[t],callback:function(t){var s=e(o);t.error?(s.html(t.error.replace(/\n/g,"<br/>")),s.show(),n(j)):(s.fadeOut(),n(d))}})}function m(o,n,s){var i,p,a;return i=o.data("validation").split(":"),p=t(i[1]),a=e(o),p.length&&n!==p.val()?(l(o,["","","COM_COMMUNITY_REGISTER_PASSWORD_NOT_SAME"]),void s(j)):(a.fadeOut(),void s(d))}function l(o,t){joms.ajax({func:"register,ajaxSetMessage",data:t,callback:function(t){var n=e(o);n.html(t.message),n.show()}})}var d="valid",j="invalid";return{start:function(){n(),s(),i(),p()},stop:function(){},validate:function(o,e){var n,s,i=0,p=0;return o=t(o),n=o.find("[required]").add(o.find("[data-required]")),s=n.length,n.length||e(i),n.each(function(){t(this).trigger("validate.joms-validation",function(o){o===j&&i++,++p>=s&&e(i)})}),!1}}}),e("utils/validation",function(){}),function(o,t,n){joms.util||(joms.util={}),joms.util.video=n(o,t),e("utils/video",["utils/loadlib"],function(){return joms.util.video})}(window,joms.jQuery,function(o,t){function e(o,e){var n,s,i,p=o.find(".joms-media__thumbnail");s=joms._.uniqueId("joms-js--video-"),i=e.path.match(/\.flv$/)?"flv":"mp4",n=t("flv"===i?'<div class="flowplayer" id="'+s+'" style="width:100%;height:281px;"></div>':'<video id="'+s+'" width="480" height="360" preload="metadata" autoplay="autoplay"><source src="'+e.path+'" type="video/mp4" /></video>'),o.addClass("being-played"),p.html(n),j(s,e.type,{fileType:i,filePath:e.path})}function n(o,e){var n,s,i,p;n=joms._.uniqueId("joms-js--video-"),s=e.path,joms.ios&&(s=(s=s.replace(/#.*$/,"")).replace(/&t=\d+/,"")),(i=t('<video id="'+n+'" controls="control" preload="none"><source src="'+s+'" type="video/youtube" /></video>')).css({visibility:"hidden"}),(p=o.find(".joms-media__thumbnail")).length||(p=o),o.addClass("being-played"),p.html(i),j(n,e.type)}function s(o,t){var e=o.find(".joms-media__thumbnail");e.length||(e=o),o.addClass("being-played joms-media--video-native"),e.html('<iframe src="//www.youtube.com/embed/'+t.id+'?autoplay=1&rel=0" width="500" height="281" frameborder="0" allowfullscreen></iframe>')}function i(o,t){var e=o.find(".joms-media__thumbnail");o.addClass("being-played"),e.html('<iframe src="//player.vimeo.com/video/'+t.id+'?autoplay=1" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')}function p(o,t){var e=o.find(".joms-media__thumbnail"),n=t.path;n=(n=(n=n.replace(/^https?:/,"")).replace(/myspace.com\/myspace\//,"myspace.com/play/")).replace(/\/(\d+)$/,"-$1"),o.addClass("being-played"),e.html('<iframe src="'+n+'" width="500" height="281" frameborder="0" allowtransparency="true" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')}function a(o,t){var e=o.find(".joms-media__thumbnail"),n="//blip.tv/play/"+t.id;o.addClass("being-played"),e.html('<iframe src="'+n+'" width="500" height="281" frameborder="0" allowfullscreen></iframe>')}function u(o,t){var e=o.find(".joms-media__thumbnail"),n=t.path;n=(n=n.replace(/^https?:/,"")).replace(/\/video\/([^_]+)_.+$/,"/embed/video/$1"),o.addClass("being-played"),e.html('<iframe src="'+n+'" width="500" height="281" frameborder="0" allowfullscreen></iframe>')}function c(o,t){var e=o.find(".joms-media__thumbnail"),n="//www.liveleak.com/ll_embed?i="+t.id;o.addClass("being-played"),e.html('<iframe src="'+n+'" width="500" height="281" frameborder="0" allowfullscreen></iframe>')}function r(o,t){var e=o.find(".joms-media__thumbnail"),n="https://www.flickr.com/apps/video/stewart.swf?photo_id="+t.id.replace(/^.*\/(\d+)$/,"$1");o.addClass("being-played"),e.html('<embed src="'+n+'" width="500" height="281"  wmode="transparent" allowFullScreen="true" type="application/x-shockwave-flash" />')}function m(o,t){var e=o.find(".joms-media__thumbnail"),n=t.path;n=n.replace("www.yahoo.com/movies/v","movies.yahoo.com/video"),n+="?format=embed&player_autoplay=true",o.addClass("being-played"),e.html('<iframe src="'+n+'" width="500" height="281" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>')}function l(o,t){var e=o.find(".joms-media__thumbnail"),n="http://www.metacafe.com/embed/"+t.id+"/";o.addClass("being-played"),e.html('<iframe src="'+n+'" width="500" height="281" frameborder="0" allowfullscreen></iframe>')}function d(t,e){o.open(e.path)}function j(e,n,s){"file"===n&&"flv"===s.fileType?joms.util.loadLib("flowplayer",function(){o.flowplayer(e,{src:joms.ASSETS_URL+"flowplayer/flowplayer-3.2.7.swf",wmode:"opaque"},{streamingServer:"lighttpd",playlist:[{url:s.filePath,autoPlay:!1,autoBuffering:!0,provider:"lighttpd",scaling:"scale"}],plugins:{lighttpd:{url:joms.ASSETS_URL+"flowplayer/flowplayer.pseudostreaming-3.2.7.swf",queryString:o.escape("?target=${start}")},controls:{url:joms.ASSETS_URL+"flowplayer/flowplayer.controls-3.2.5.swf"}}})}):joms.util.loadLib("mediaelement",function(){var o=t("#"+e).css({visibility:""}),s={iPadUseNativeControls:"file"===n,iPhoneUseNativeControls:"file"===n,success:function(o,t,e){setTimeout(function(){e.disableControls(),e.enableControls()},1),"flash"===o.pluginType?o.addEventListener("canplay",function(){o.play()},!1):(!joms.mobile||"youtube"!==o.pluginType&&"vimeo"!==o.pluginType)&&o.play()}};"youtube"===n&&(s.defaultVideoWidth=o.width(),s.defaultVideoHeight=o.height()),o.mediaelementplayer(s)})}return{play:function(t,j){"file"===j.type?e(t,j):"youtube"===j.type?o.joms_videoplayer_native?s(t,j):n(t,j):"vimeo"===j.type?i(t,j):"myspace"===j.type?p(t,j):"blip"===j.type?a(t,j):"dailymotion"===j.type?u(t,j):"liveleak"===j.type?c(t,j):"flickr"===j.type?r(t,j):"yahoo"===j.type?m(t,j):"metacafe"===j.type?l(t,j):d(0,j)}}}),function(o,t,n){joms.util||(joms.util={}),joms.util.wysiwyg=n(o,t),e("utils/wysiwyg",["utils/loadlib"],function(){return joms.util.wysiwyg})}(window,joms.jQuery,function(o,t){function e(o,e){return t("<button/>",{class:"joms-button--full-small joms-button--"+("submit"===o?"primary":"neutral"),type:o,text:this.lang[o]||o}).appendTo(e.find("form"))}function n(){t.extend(jQuery.trumbowyg.langs.en,o.joms_lang.wysiwyg||{})}return{start:function(){var o=t("textarea").filter("[data-wysiwyg=trumbowyg]");o.length&&joms.util.loadLib("trumbowyg",function(){n();var s=!1;"rtl"===t("html").attr("dir")&&(s=!0),t.extend(jQuery.trumbowyg,{upload:{serverPath:joms.BASE_URL+"index.php?option=com_community&view=photos&task=ajaxPreviewComment&isEditor=1"}}),o.each(function(){var o,n;o={btnsDef:{image:{dropdown:["insertImage","upload"],ico:"insertImage"}},btns:(t(this).data("btns")||"viewHTML,|,bold,italic,underline,|,unorderedList,orderedList,|,link,image").split(","),fullscreenable:!1,mobile:!1,tablet:!1,removeformatPasted:!0,autogrow:!0},s&&(o.dir="rtl"),(n=t(this).trumbowyg(o).on("tbwblur",function(){t(this).data("trumbowyg").syncCode()}).data("trumbowyg")).buildModalBtn=e,n._openModalInsert=n.openModalInsert,n.openModalInsert=function(o,e,s){var i=n._openModalInsert(o,e,s);return i.find("label").each(function(){var o,e=t(this),n=e.find("input"),s=n.attr("name"),i=n.attr("type");["url","file","title","text","target","alt"].indexOf(s)>=0&&(o='<div class="joms-form__group" style="text-align:left">',o+='<span style="width:90px;text-align:center">'+e.find(".trumbowyg-input-infos").text()+"</span>","file"===i?(o+='<input name="'+s+'" class="joms-input" value="'+(n.val()||"")+'" type="file"',o+=' accept="image/png,image/jpeg,image/gif,image/bmp">'):o+='<input name="'+s+'" class="joms-input" value="'+(n.val()||"")+'" type="'+(i||"text")+'">',o+="</div>",e.replaceWith(t(o)))}),i}})})}}}),function(o,t,n){joms.fn||(joms.fn={}),joms.fn.tagging=n(o,t),e("functions/tagging",["utils/tagging"],function(){return joms.fn.tagging})}(window,joms.jQuery,function(o,t){function e(e){var s,i=this,p=this.textarea.joms_data,a=p.tagId||p.id,u=(p.tagFunc||p.func||"").toLowerCase(),c=p.type||"",r=[];this.textarea.joms_friends?e(this.textarea.joms_friends):(u?(s="index.php?option=com_community&view=friends&task=ajaxAutocomplete",u.indexOf("album")>-1?s+="&albumid="+a:u.indexOf("photo")>-1?s+="&photoid="+a+"&rule=photo-comment":u.indexOf("video")>-1?s+="&videoid="+a:u.indexOf("discussion")>-1?s+="&discussionid="+a:u.indexOf("inbox")>-1?s+="&msgid="+a:c.match(/service\.comment\.joomla\.article/)&&(s+="&type=comment&streamid="+a)):(s="index.php?option=com_community&view=friends&task=ajaxAutocomplete&type=comment&streamid="+a,o.joms_group_id?s+="&groupid="+o.joms_group_id:o.joms_event_id&&(s+="&eventid="+o.joms_event_id)),this.fetchXHR&&this.fetchXHR.abort(),this.fetchXHR=t.ajax({url:joms.BASE_URL+s,dataType:"json",success:function(o){i.textarea.joms_friends=r=n(o)},complete:function(){var t,n,s,p;if(r.length&&o.joms_friends.length)for(t=0,s=Math.min(r.length,30);t<s;t++)for(n=0,p=Math.min(o.joms_friends.length,30);n<p;n++)+r[t].id==+o.joms_friends[n].id&&(o.joms_friends[n].avatar=r[t].avatar,o.joms_friends[n].name=r[t].name);i.fetchXHR=!1,e(r)}}))}function n(o){var t,e,n=[],s=[];if(o&&o.suggestions&&o.suggestions.length)for(e=0;e<o.suggestions.length;e++)t=""+o.data[e],n.indexOf(t)>=0||(n.push(t),s.push({id:t,name:o.suggestions[e],avatar:o.img[e].replace(/^.+src="([^"]+)".+$/,"$1"),type:"contact"}));return s}var s={},i={},p={},a={},u={},c={};return{initInputbox:function(){t(document.body).find(".joms-js--newcomment").find("textarea.joms-textarea").each(function(){var o=t(this);o[0].joms_beautifier||(o[0].joms_data=o.data(),o.jomsTagging(e))})},fetchInputbox:e,fetchFriendsInContext:function(){var t="index.php?option=com_community&view=friends&task=ajaxAutocomplete",e=[];o.joms_group_id?t+="&groupid="+o.joms_group_id:o.joms_event_id?t+="&eventid="+o.joms_event_id:t+="&allfriends=1",joms.jQuery.ajax({url:joms.BASE_URL+t,dataType:"json",success:function(o){e=n(o)},complete:function(){o.joms_friends=e}})},fetchGroupMembers:function(o,t){var e="index.php?option=com_community&view=friends&task=ajaxAutocomplete&groupid="+o;u[o]||(u[o]=[]),p[o]?u[o].push(t):s[o]?t(s[o]):(p[o]=!0,joms.jQuery.ajax({url:joms.BASE_URL+e,dataType:"json",success:function(t){s[o]=n(t)},complete:function(){for(t(s[o]);u[o].length;)try{u[o].shift()(s[o])}catch(o){}p[o]=!1}}))},fetchEventMembers:function(o,t){var e="index.php?option=com_community&view=friends&task=ajaxAutocomplete&eventid="+o;c[o]||(c[o]=[]),a[o]?c[o].push(t):i[o]?t(i[o]):(a[o]=!0,joms.jQuery.ajax({url:joms.BASE_URL+e,dataType:"json",success:function(t){i[o]=n(t)},complete:function(){for(t(i[o]);c[o].length;)try{c[o].shift()(i[o])}catch(o){}a[o]=!1}}))}}}),function(o,t,n){joms.view||(joms.view={}),joms.view.comment=n(o,t),e("views/comment",["utils/video","functions/tagging"],function(){return joms.view.comment})}(window,joms.jQuery,function(o,t){function e(){w&&(w.off("keydown.joms-comment",".joms-comment__reply textarea"),w.off("focus.joms-comment",".joms-comment__reply textarea"),w.off("focus.joms-comment",".joms-js--pm-message textarea"),w.off("click.joms-comment",".joms-comment__reply .joms-js--btn-send"),w.off("click.joms-comment",".joms-js--inbox-reply .joms-js--btn-send"),w.off("click.joms-comment",".joms-comment__more"))}function n(){joms.fn.tagging.initInputbox()}function s(){var o=".joms-js--video",e=t(".joms-comment__body,.joms-js--inbox").find(o).not(".joms-js--initialized").addClass(".joms-js--initialized".substr(1));e.length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),e.on("click.joms-video",o+"-play",function(){var e=t(this).closest(o);joms.util.video.play(e,e.data())}),joms.ios&&setTimeout(function(){e.find(o+"-play").click()},2e3))}function i(o){if(13===(o.keyCode||o.charCode)&&!o.shiftKey&&!t(o.target).data("noentersend")&&!joms.mobile)return setTimeout(function(){u(o)},100),!1}function p(o){var e=t(o.target).closest(".joms-textarea__wrapper").find(".joms-textarea__attachment");e.length&&(T=e)}function a(o){u({currentTarget:t(o.currentTarget).closest(".joms-comment__reply,.joms-js--inbox-reply").find("textarea")[0]})}function u(o){var e,n,i,p,a=t(o.currentTarget),u=a.val()||"",l=+a.data("edit");a[0].joms_hidden&&(u=a[0].joms_hidden.val()||u),(""!==u.replace(/^\s+|\s+$/g,"")||(p=a.siblings(".joms-textarea__attachment")).length&&p.is(":visible"))&&(e=+a.data("id"),n=a.data("func")||"",i=a.data("type")||"",l?m(a,e,n,i,u,function(){s(),c(a,"edit")}):r(a,e,n,i,u,function(){a.val(""),s(),c(a)}))}function c(o,t){o.css("height",""),"edit"!==t&&o.closest(".joms-comment__reply").find(".joms-textarea__attachment").hide(),(o=o[0]).joms_reset&&o.joms_reset(),o.joms_beautifier&&"none"!==o.joms_beautifier&&o.joms_beautifier.html(""),o.joms_hidden&&o.joms_hidden.val(o.value)}function r(e,n,s,i,p,a){var u,c,r,m,l=s,d=!1,j=!1,f=!1,v=!1,b=!1,_=!1;e.data("saving")||(e.data("saving",1),l&&((r=s.toLowerCase()).indexOf("album")>-1?!0:r.indexOf("photo")>-1?!0:r.indexOf("video")>-1?d=!0:r.indexOf("discussion")>-1?j=!0:r.indexOf("inbox")>-1?f=!0:r.indexOf("wall")&&(v=!0)),(c=T)&&c.is(":visible")&&(_=(b=c.find(".joms-textarea__attachment--thumbnail").find("img")).siblings("b"),b.is(":visible")?(b=b.data("photo_id"),_=""):_.is(":visible")&&(_=_.data("id"),b="")),b=b||"",_=_||"",l?u=d||j?[p,n,b]:f?[n,p,b,_]:v?[i,n,p,b]:[p,n,"",b]:(s="system,ajaxStreamAddComment",u=[n,p,b]),(m=t(e).siblings(".joms-textarea__loading")).show(),joms.ajax({func:s,data:u,callback:function(s){var i;if(m.hide(),s.success){if(f)return h(s.html),e.removeData("saving"),void(M&&M.siblings("svg").removeData("disabled").css("opacity",""));t(".joms-js--comments-"+n).append(s.html||""),(i=t(".joms-comment__counter--"+n)).length&&i.html(+i.eq(0).text()+1)}"function"==typeof a&&a(s),e.removeData("saving"),M&&M.siblings("svg").removeData("disabled").css("opacity",""),s.error&&o.alert(s.error)}}))}function m(o,e,n,s,i,p){var a,u,c,r,m,l=n;o.data("saving")||(o.data("saving",1),(a=o.siblings(".joms-textarea__attachment")).is(":visible")?(u=a.find(".joms-textarea__attachment--thumbnail").find("img"),c=u.attr("src"),u=u.data("photo_id")||"0"):u=a.data("no_thumb")?"0":"-1",l?(r=[e,i,n,u],n="system,ajaxUpdateWall"):(n="system,ajaxeditComment",r=[e,i,u]),(m=t(o).siblings(".joms-textarea__loading")).show(),joms.ajax({func:n,data:r,callback:function(n){var s,i,a;m.hide(),n.success&&(i=(s=t(".joms-js--comment-"+e)).find(".joms-js--comment-body"),a=t(".joms-js--newcomment-"+s.data("parent")),s.find(".joms-js--comment-editor").hide().find("textarea").val(n.originalComment||""),s.find(".joms-js--comment-content").html(n.comment||""),s.find(".joms-js--comment-actions").show(),i.show(),a.show(),(+u<0||+u>0)&&(i.children(".joms-js--comment-content").next("div").remove(),+u>0&&c&&i.children(".joms-js--comment-content").after(['<div style="padding:5px 0">','<a href="javascript:" onclick="joms.api.photoZoom(\'',c,"');\">",'<img class="joms-stream-thumb" src="',c,'">',"</a>","</div>"].join("")))),"function"==typeof p&&p(n);try{o.blur()}catch(o){}o.removeData("saving"),M&&M.siblings("svg").removeData("disabled").css("opacity","")}}))}function l(e){var n=t(e.currentTarget).closest(".joms-js--comments"),s=n.data("type")||"",i=+n.data("id"),p=n.children(".joms-js--comment").length,a=o.joms_prev_comment_load;i&&joms.ajax({func:"system,ajaxStreamShowComments",data:[i,s,p,a],callback:function(e){var n,p,a,u,c;e.success&&(n=t(t.trim(e.html)),s&&(n=n.filter(".joms-js--comments").children()),(p=t(".joms-js--comments-"+i)).find(".joms-js--comment").remove(),p.append(n),e.total=+e.total,(a=Math.max(0,e.total-p.children(".joms-js--comment").length))>0?(c=(u=p.find(".joms-js--more-comments a")).data("lang")||o.joms_lang.COM_COMMUNITY_SHOW_PREVIOUS_COMMENTS+" (%d)")&&u.text(c.replace("%d",a)):p.find(".joms-js--more-comments").remove())}})}function d(e,n){if("function"!=typeof n&&(n=function(){}),k)return T=e&&e.find(".joms-textarea__attachment"),void n();joms.util.loadLib("plupload",function(){setTimeout(function(){var s;s=t('<div id="joms-js--attachment-uploader" aria-hidden="true" style="width:1px; height:1px; overflow:hidden">').appendTo(document.body),t('<button id="joms-js--attachment-uploader-button">').appendTo(s),(k=new o.plupload.Uploader({url:joms.BASE_URL+"index.php?option=com_community&view=photos&task=ajaxPreviewComment",container:"joms-js--attachment-uploader",browse_button:"joms-js--attachment-uploader-button",runtimes:"html5,html4",multi_selection:!1})).bind("FilesAdded",j),k.bind("BeforeUpload",f),k.bind("Error",v),k.bind("FileUploaded",b),k.init(),T=e&&e.find(".joms-textarea__attachment"),C=s.find("input[type=file]"),n()})})}function j(t){S=!1,o.setTimeout(function(){var o=T,e=o.find(".joms-textarea__attachment--loading"),n=o.find(".joms-textarea__attachment--thumbnail"),s=o.find("button");S||(t.start(),t.refresh(),n.find("img").replaceWith("<img>"),n.hide(),s.hide(),e.show(),o.show(),M.siblings("svg").data("disabled",1).css("opacity",.5))},0)}function f(o){var t,e="";for(t in x)e+="&"+t+"="+x[t];o.settings.url+=e}function v(t,e){S=!0,o.alert(e&&e.message||"Undefined error.")}function b(e,n,s){var i,p,a,u,c,r,m;try{i=JSON.parse(s.response)}catch(o){}return i||(i={}),p=T,i.error||i.msg?(o.alert(i.error||i.msg),void p.hide()):i.thumb_url&&i.photo_id||i.id?(a=p.find(".joms-textarea__attachment--loading"),r=(u=p.find(".joms-textarea__attachment--thumbnail")).find("img"),c=p.find("button"),"file"===y?(m=t("<b>"+n.name+"</b>").data({id:i.id,path:i.path,name:n.name}),r.removeData("photo_id"),r.hide().siblings("b").remove(),r.after(m)):(r.siblings("b").remove(),r.attr("src",i.thumb_url),r.data("photo_id",i.photo_id).show()),a.hide(),u.show(),c.show(),void p.show()):(o.alert("Undefined error."),void p.hide())}function h(e){var n,i,p,a,u,c,r,m,l,d;for(n=t(".joms-js--inbox"),i=t(".joms-js--inbox-status"),a=(p=t(".joms-js--inbox-reply")).find("textarea"),c=p.find(".joms-textarea__attachment"),e=t(t.trim(e)),r=o.location.href.split("#")[0],m=e.find("use"),d=0;d<m.length;d++)l=r+"#"+(l=m.eq(d).attr("xlink:href").split("#")[1]),m.eq(d).attr("xlink:href",l);n.append(e),a.length&&((u=a.data("joms-tagging"))?u.clear():a.val("")),c.length&&c.hide(),i.length&&i.html("<span>"+i.data("lang-notseen")+"</span>"),s()}function _(e,n){var i,p,a;n?(i=t(".joms-js--inbox-item-"+e),n=t(t.trim(n)),a=o.location.href.split("#")[0]+"#"+(a=(p=n.find("use")).attr("xlink:href").split("#")[1]),p.attr("xlink:href",a),i.replaceWith(n),s()):g(e)}function g(o){var e;(e=t(".joms-js--inbox-item-"+o)).fadeOut(500,function(){e.remove()})}var w,k,y,x,C,T,M,S;return{start:function(){e(),(w=t(document.body)).on("keydown.joms-comment",".joms-comment__reply textarea",i),w.on("focus.joms-comment",".joms-comment__reply textarea",p),w.on("focus.joms-comment",".joms-js--pm-message textarea",p),w.on("click.joms-comment",".joms-comment__reply .joms-js--btn-send",a),w.on("click.joms-comment",".joms-js--inbox-reply .joms-js--btn-send",a),w.on("click.joms-comment",".joms-comment__more",l),d(),n(),s()},stop:e,like:function(e){joms.ajax({func:"system,ajaxStreamAddLike",data:[e,"comment"],callback:function(n){var s,i,p;n.success&&(s=t(".joms-js--comment-"+e)).length&&((i=s.find(".joms-comment__actions").find(".joms-button--liked")).attr("onclick","joms.api.commentUnlike('"+e+"');"),i.addClass("liked"),i.find("span").html(i.data("lang-unlike")),i.find("use").attr("xlink:href",o.location+"#joms-icon-thumbs-down"),p=s.find(".joms-comment__actions [data-action=showlike]"),n.html?p.length?p.replaceWith(n.html):i.after(n.html):p.remove())}})},unlike:function(e){joms.ajax({func:"system,ajaxStreamUnlike",data:[e,"comment"],callback:function(n){var s,i,p;n.success&&(s=t(".joms-js--comment-"+e)).length&&((i=s.find(".joms-comment__actions").find(".joms-button--liked")).attr("onclick","joms.api.commentLike('"+e+"');"),i.removeClass("liked"),i.find("span").html(i.data("lang-like")),i.find("use").attr("xlink:href",o.location+"#joms-icon-thumbs-up"),p=s.find(".joms-comment__actions [data-action=showlike]"),n.html?p.length?p.replaceWith(n.html):i.after(n.html):p.remove())}})},edit:function(o,e,n){var s,i,p,a="wall"===n;e=t(e),p=(s=e.closest(".joms-comment__item")).children(".joms-comment__reply").find("textarea"),(i=a?s.closest(".joms-comment").siblings(".joms-comment__reply"):s.closest(".joms-stream").children(".joms-comment__reply")).hide(),s.children(".joms-comment__body,.joms-comment__actions").hide(),s.children(".joms-comment__reply").show(),p.jomsTagging(),p.off("reset.joms-tagging"),p.on("reset.joms-tagging",function(){s.children(".joms-comment__reply").hide(),s.children(".joms-comment__body,.joms-comment__actions").show(),i.show()}),p[0].focus()},cancel:function(o){var e,n,s;(e=o&&o.nodeType?t(o).closest(".joms-js--comment"):t(".joms-js--comment-"+o)).length&&(s=e.data(),n=t(".joms-js--newcomment-"+s.parent),e.find(".joms-js--comment-editor").hide(),e.find(".joms-js--comment-body").show(),e.find(".joms-js--comment-actions").show(),n.show())},remove:function(e,n){var s,i,p="inbox"===n,a="wall"===n;p?(s="inbox,ajaxRemoveMessage",i=[e]):a?(s=o.joms_wall_remove_func,i=[e]):(s="system,ajaxStreamRemoveComment",i=[e]),joms.ajax({func:s,data:i,callback:function(n){var s;n.success?p?g(e):(s=t(".joms-js--comment-"+e)).length&&s.fadeOut(500,function(){s.remove();var o=t(".joms-comment__counter--"+n.parent_id);o.length&&o.html(+o.eq(0).text()-1)}):o.alert(n.error||"Undefined error.")}})},removeTag:function(o,e){joms.ajax({func:"activities,ajaxRemoveUserTag",data:[o,e||"comment"],callback:function(n){var s,i,p,a;n.success&&("inbox"===e?(i=(s=t(".joms-js--inbox-item-"+o)).find(".joms-button--remove-tag"),(p=s.find(".joms-js--inbox-content")).html(n.data),i.remove()):(i=(s=t(".joms-js--comment-"+o)).find(".joms-button--remove-tag"),p=s.find(".joms-js--comment-content"),a=s.find(".joms-js--comment-editor").find("textarea"),p.html(n.data),a.val(n.unparsed),i.remove()))}})},removePreview:function(e,n){var s,i,p="inbox"===n,a="wall"===n;p?(s="inbox,ajaxRemovePreview",i=[e]):a?(s="system,ajaxRemoveWallPreview",i=[e]):(s="system,ajaxRemoveCommentPreview",i=[e]),joms.ajax({func:s,data:i,callback:function(n){n.success?p?_(e,n.html):t(".joms-js--comment-"+e).find(".joms-js--comment-preview").remove():o.alert(n.error||"Undefined error.")}})},removeThumbnail:function(t,e){var n,s,i="inbox"===e;i&&(n="inbox,ajaxRemoveThumbnail",s=[t]),joms.ajax({func:n,data:s,callback:function(e){e.success?i&&_(t,e.html):o.alert(e.error||"Undefined error.")}})},addAttachment:function(e,n,s){var i,p,a;(e=t(e)).data("disabled")||(M=e,(e=e.siblings(".joms-textarea__wrapper")).length&&("file"!==n&&(n="image"),i=+(s=s||{}).max_file_size,p=s.exts,delete s.max_file_size,delete s.exts,y=n,x="file"===n?s:{},a={file:{url:joms.BASE_URL+"index.php?option=com_community&view=files&task=multiUpload",filters:{mime_types:[{title:"Document files",extensions:p}]},max_file_size:i>0?1048576*+i:0},image:{url:joms.BASE_URL+"index.php?option=com_community&view=photos&task=ajaxPreviewComment",filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}]},max_file_size:void 0}},d(e,function(){k.refresh(),k.settings.url=a[n].url,k.settings.filters=a[n].filters,k.settings.max_file_size=a[n].max_file_size,k.refresh(),o.joms_webdriver||C.click()})))},removeAttachment:function(o){(o=(o=t(o)).closest(".joms-textarea__attachment"))&&(o.find(".joms-textarea__attachment--thumbnail img").replaceWith('<img src="" alt="attachment">'),o.hide()),M&&M.siblings("svg").removeData("disabled").css("opacity","")},toggleText:function(o){var e=t(".joms-js--comment-text-"+o),n=t(".joms-js--comment-textfull-"+o),s=t(".joms-js--comment-texttoggle-"+o);n.is(":visible")?(n.hide(),e.show(),s.html(s.data("lang-more"))):(e.hide(),n.show(),s.html(s.data("lang-less")))},initInputbox:n}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.remove=t(),e("popups/stream.remove",["utils/popup"],function(){return joms.popup.stream.remove})}(window,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"activities,ajaxConfirmDeleteActivity",data:["",p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click","[data-ui-object=popup-button-cancel]",t),i.on("click","[data-ui-object=popup-button-save]",e)}})}function t(){i.off(),s.close()}function e(){joms.ajax({func:"activities,ajaxDeleteActivity",data:["",p],callback:function(o){var t;i.off(),s.close(),o.success&&(t=joms.jQuery(".joms-stream").filter("[data-stream-id="+p+"]")).fadeOut(500,function(){t.remove()})}})}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>","<div>",'<div class="joms-popup__content">',o.error||o.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnYes,"</button>","</div>","</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.editLocation=n(o,t),e("popups/stream.editlocation",["utils/popup"],function(){return joms.popup.stream.editLocation})}(window,joms.jQuery,function(o,t){function e(o,t){u&&u.off(),a=o,c=t,joms.ajax({func:"activities,ajaxeditLocation",data:[c],callback:function(o){a.items[0]={type:"inline",src:p(o)},a.updateItemHTML(),(u=a.contentContainer).on("click","[data-ui-object=popup-button-cancel]",n),u.on("click","[data-ui-object=popup-button-save]",s),_.defer(function(){i(o)})}})}function n(){u.off(),a.close()}function s(){var o=u.find(".joms-js--location-input"),e=o.data("name"),n=o.data("lat"),s=o.data("lng");joms.ajax({func:"activities,ajaxSaveLocation",data:[c,e,n,s],callback:function(o){u.off(),a.close(),o.success&&t(".joms-stream").filter("[data-stream-id="+c+"]").find(".joms-status-location a").html(e)}})}function i(e){joms.util.map(function(){var n,s,i,p=u.find(".joms-js--location-map"),a=u.find(".joms-js--location-input"),c=u.find(".joms-js--location-loading"),r=u.find(".joms-js--location-selector");s={center:n=new o.google.maps.LatLng(e.latitude,e.longitude),zoom:14,mapTypeId:o.google.maps.MapTypeId.ROADMAD,mapTypeControl:!1,disableDefaultUI:!0,draggable:!1,scaleControl:!1,scrollwheel:!1,navigationControl:!1,streetViewControl:!1,disableDoubleClickZoom:!0},p=new o.google.maps.Map(p[0],s),(i=new o.google.maps.Marker({draggable:!1,map:p})).setPosition(n),p.panTo(n),a.on("input",function(){r.hide(),c.show(),m(this.value)});var m=_.debounce(function(o){(o=t.trim(o))&&joms.util.map.search(o).done(function(o){var t="";_.isArray(o)&&_.each(o,function(o){t+='<a class="joms-map--location-item" data-id="'+o.id+'""><strong>'+o.name+"</strong><br /><span>"+(o.description||"")+"</span></a>"}),c.hide(),r.html(t),r.show()})},1e3);a.val(e.location),m(e.location),r.on("click",".joms-map--location-item",function(){var o=t(this),e=o.data(),n=o.find("strong").text();a.data("name",n),joms.util.map.detail(e.id).done(function(o){var t=o.geometry,e=t.location,n=t.viewport;a.data("lat",e.lat()),a.data("lng",e.lng()),p.setCenter(e),i.setPosition(e),n?p.fitBounds(n):p.setZoom(15)})})})}function p(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>","<div>",'<div class="joms-popup__content">',o.html||o.error,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnEdit,"</button>","</div>","</div>","</div>"].join("")}var a,u,c;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.addFeatured=t(o),e("popups/stream.addfeatured",["utils/popup"],function(){return joms.popup.stream.addFeatured})}(window,function(o){function t(t,p){s&&s.off(),n=t,i=p;var a,u=o.joms_page;"profile"===u?(u="profile",a=o.joms_user_id):"groups"===u?(u="group",a=o.joms_group_id):"events"===u?(u="event",a=o.joms_event_id):(u="frontpage",a=0),joms.ajax({func:"system,ajaxFeatureStream",data:[u,a,i],callback:function(t){t.success?o.location.reload():(n.items[0]={type:"inline",src:e(t)},n.updateItemHTML())}})}function e(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title||"&nbsp;","</div>",'<div class="joms-popup__content joms-popup__content--single">',o.error||o.message,"</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.removeFeatured=n(o),e("popups/stream.removefeatured",["utils/popup"],function(){return joms.popup.stream.removeFeatured})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p;var a,u=o.joms_page;"profile"===u?(u="profile",a=o.joms_user_id):"groups"===u?(u="group",a=o.joms_group_id):"events"===u?(u="event",a=o.joms_event_id):(u="frontpage",a=0),joms.ajax({func:"system,ajaxUnfeatureStream",data:[u,a,i],callback:function(t){t.success?o.location.reload():(n.items[0]={type:"inline",src:e(t)},n.updateItemHTML())}})}function e(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title||"&nbsp;","</div>",'<div class="joms-popup__content joms-popup__content--single">',o.error||o.message,"</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.removeLocation=t(),e("popups/stream.removelocation",["utils/popup"],function(){return joms.popup.stream.removeLocation})}(window,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"activities,ajaxRemoveLocation",callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click","[data-ui-object=popup-button-cancel]",t),i.on("click","[data-ui-object=popup-button-save]",e)}})}function t(){i.off(),s.close()}function e(){joms.ajax({func:"activities,deleteLocation",data:[p],callback:function(o){i.off(),s.close(),o.success&&joms.jQuery(".joms-stream").filter("[data-stream-id="+p+"]").find(".joms-status-location").remove()}})}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>","<div>",'<div class="joms-popup__content">',o.error||o.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnYes,"</button>","</div>","</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.removeMood=t(),e("popups/stream.removemood",["utils/popup"],function(){return joms.popup.stream.removeMood})}(window,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"activities,ajaxConfirmRemoveMood",callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click","[data-ui-object=popup-button-cancel]",t),i.on("click","[data-ui-object=popup-button-save]",e)}})}function t(){i.off(),s.close()}function e(){joms.ajax({func:"activities,ajaxRemoveMood",data:[p],callback:function(o){i.off(),s.close(),o.success&&joms.jQuery(".joms-stream").filter("[data-stream-id="+p+"]").find("[data-type=stream-content]").find("span").eq(0).html(o.html)}})}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>","<div>",'<div class="joms-popup__content">',o.error||o.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnYes,"</button>","</div>","</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.report=t(),e("popups/stream.report",["utils/popup"],function(){return joms.popup.stream.report})}(window,function(){function o(o,u){p&&p.off(),i=o,a=u,joms.ajax({func:"system,ajaxReport",data:[],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("change","select",t),p.on("click",".joms-js--button-cancel",e),p.on("click",".joms-js--button-save",n)}})}function t(o){p.find("textarea").val(o.target.value)}function e(){p.off(),i.close()}function n(){var o,t=/^\s+|\s+$/g;(o=(o=p.find("textarea").val()).replace(t,""))?(p.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["activities,reportActivities",window.location.href,o,a],callback:function(o){p.find(".joms-js--step1").hide(),p.find(".joms-js--step2").show().children().html(o.error||o.message)}})):p.find(".joms-js--error").show()}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">',o.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var i,p,a;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.selectPrivacy=n(o,t),e("popups/stream.selectprivacy",["utils/popup"],function(){return joms.popup.stream.selectPrivacy})}(window,joms.jQuery,function(o,t){function e(o,t){p&&p.off(),a=t,(i=o).items[0]={type:"inline",src:s()},i.updateItemHTML(),(p=i.contentContainer).on("click","a",n)}function n(e){var n=t(e.currentTarget),s=n.data("value"),u=n.data("classname");joms.ajax({func:"activities,ajaxUpdatePrivacyActivity",data:[a,s],callback:function(e){p.off(),i.close(),e.success&&t(".joms-stream").filter("[data-stream-id="+a+"]").find(".joms-stream__meta use").attr("xlink:href",o.location+"#"+u)}})}function s(){var t,e,n,s,i;if(t=[["public",10,o.joms_lang.COM_COMMUNITY_PRIVACY_PUBLIC,"earth"],["site_members",20,o.joms_lang.COM_COMMUNITY_PRIVACY_SITE_MEMBERS,"users"],["friends",30,o.joms_lang.COM_COMMUNITY_PRIVACY_FRIENDS,"user"],["me",40,o.joms_lang.COM_COMMUNITY_PRIVACY_ME,"lock"]],(e=o.joms_privacylist)&&e.length)for(i=t.length-1;i>=0;i--)e.indexOf(t[i][0])<0&&t.splice(i,1);for(n=(n=o.location.href).replace(/#.*$/,""),s="",i=0;i<t.length;i++)s+='<a href="javascript:" data-value="'+t[i][1]+'" data-classname="joms-icon-'+t[i][3]+'">',s+='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="'+n+"#joms-icon-"+t[i][3]+'"></use></svg> ',s+="<span>"+t[i][2]+"</span></a>";return['<div class="joms-popup joms-popup--whiteblock joms-popup--privacy">','<div><div class="joms-popup__content joms-popup__content--single">',s,"</div></div>","</div>"].join("")}var i,p,a;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.share=n(o,t),e("popups/stream.share",["utils/loadlib","utils/popup"],function(){return joms.popup.stream.share})}(window,joms.jQuery,function(o,t){function e(o,t){c&&c.off(),u=o,r=t,joms.ajax({func:"activities,ajaxSharePopup",data:[r],callback:function(o){u.items[0]={type:"inline",src:a(o)},u.updateItemHTML(),i(),p(),(c=u.contentContainer).on("click",".joms-js--button-cancel",n),c.on("click",".joms-js--button-save",s)}})}function n(){c.off(),u.close()}function s(){var o={msg:c.find("textarea.joms-textarea").val(),privacy:c.find("[data-ui-object=joms-dropdown-value]").val()};joms.ajax({func:"activities,ajaxAddShare",data:[r,JSON.stringify(o)],callback:function(o){c.off(),u.close(),o.success&&(t(".joms-stream__container").prepend(o.html),i(),p())}})}function i(){t(".joms-media--images").not(".joms-js--initialized").each(function(){var o=t(this),e=o.find("img"),n=0;e.each(function(){var s=t(this);t("<img>").load(function(){++n===e.length&&(o.siblings(".joms-media--loading").remove(),o.addClass(".joms-js--initialized".substr(1)),e.show(),joms.util.photos.arrange(o))}).attr("src",s.attr("src"))})})}function p(){var o=".joms-js--video",e=t(o).not(".joms-js--initialized").addClass(".joms-js--initialized".substr(1));e.length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),e.on("click.joms-video",o+"-play",function(){var e=t(this).closest(o);joms.util.video.play(e,e.data())}),joms.ios&&setTimeout(function(){e.find(o+"-play").click()},2e3))}function a(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>","<div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',t.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',t.btnShare,"</button> &nbsp;",'<div style="display:inline-block; position:relative;">','<div class="joms-button--privacy" data-ui-object="joms-dropdown-button" data-name="share-privacy">','<svg class="joms-icon" viewBox="0 0 16 16"><use xlink:href="#joms-icon-earth"></use></svg>','<input type="hidden" data-ui-object="joms-dropdown-value" value="10">',"</div>",'<ul class="joms-dropdown joms-dropdown--privacy" data-name="share-privacy">','<li data-classname="joms-icon-earth" data-value="10" style="white-space:nowrap">','<svg class="joms-icon" viewBox="0 0 16 16"><use xlink:href="#joms-icon-earth"></use></svg>'," <span>",o.joms_lang.COM_COMMUNITY_PRIVACY_PUBLIC,"</span>","</li>",'<li data-classname="joms-icon-users" data-value="20" style="white-space:nowrap">','<svg class="joms-icon" viewBox="0 0 16 16"><use xlink:href="#joms-icon-users"></use></svg>'," <span>",o.joms_lang.COM_COMMUNITY_PRIVACY_SITE_MEMBERS,"</span>","</li>",'<li data-classname="joms-icon-user" data-value="30" style="white-space:nowrap">','<svg class="joms-icon" viewBox="0 0 16 16"><use xlink:href="#joms-icon-user"></use></svg>'," <span>",o.joms_lang.COM_COMMUNITY_PRIVACY_FRIENDS,"</span>","</li>",'<li data-classname="joms-icon-lock" data-value="40" style="white-space:nowrap">','<svg class="joms-icon" viewBox="0 0 16 16"><use xlink:href="#joms-icon-lock"></use></svg>'," <span>",o.joms_lang.COM_COMMUNITY_PRIVACY_ME,"</span>","</li>","</ul>","</div>","</div>","</div>","</div>"].join("")}var u,c,r;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.showComments=n(o,t),e("popups/stream.showcomments",["utils/popup"],function(){return joms.popup.stream.showComments})}(window,joms.jQuery,function(o,t){function e(o,t,e){var u;i&&i.off(),s=o,u=[p=t],(a=e)&&u.push(a),joms.ajax({func:"system,ajaxStreamShowComments",data:u,callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML()}})}function n(e){var n=!0;return e||(e={}),t(t.trim(e.html||"")).children().length&&(n=!1),['<div class="joms-popup joms-popup--whiteblock joms-popup--rounded joms-popup--80pc">','<button class="mfp-close joms-hide"></button>','<div class="joms-comment">',n?o.joms_lang.COM_COMMUNITY_NO_COMMENTS_YET:e.html,"</div>","</div>"].join("")}var s,i,p,a;return function(o,t){joms.util.popup.prepare(function(n){e(n,o,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.showLikes=n(o,t),e("popups/stream.showlikes",["utils/popup"],function(){return joms.popup.stream.showLikes})}(window,joms.jQuery,function(o,t){function e(o,t,e){i&&i.off(),s=o,p=t,a=e,joms.ajax({func:"system,ajaxStreamShowLikes",data:[p,a],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML()}})}function n(e){var n=!0;return e||(e={}),t(t.trim(e.html||"")).children().length&&(n=!1),['<div class="joms-popup joms-popup--whiteblock joms-popup--rounded joms-popup--80pc">','<button class="mfp-close joms-hide"></button>','<div class="joms-comment">',n?o.joms_lang.COM_COMMUNITY_NO_LIKES_YET:e.html,"</div>","</div>"].join("")}var s,i,p,a;return function(o,t){joms.util.popup.prepare(function(n){e(n,o,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.showOthers=n(),e("popups/stream.showothers",["utils/popup"],function(){return joms.popup.stream.showOthers})}(window,joms.jQuery,function(){function o(o,i){n&&n.off(),e=o,s=i,joms.ajax({func:"activities,ajaxShowOthers",data:[s],callback:function(o){e.items[0]={type:"inline",src:t(o)},e.updateItemHTML()}})}function t(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--rounded joms-popup--80pc">','<button class="mfp-close joms-hide"></button>','<div class="joms-comment">',o.html||"","</div>","</div>"].join("")}var e,n,s;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.stream=t(o,joms.popup.stream||{}),e("popups/stream",["popups/stream.remove","popups/stream.editlocation","popups/stream.addfeatured","popups/stream.removefeatured","popups/stream.removelocation","popups/stream.removemood","popups/stream.report","popups/stream.selectprivacy","popups/stream.share","popups/stream.showcomments","popups/stream.showlikes","popups/stream.showothers"],function(){return joms.popup.stream})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,n){joms.view||(joms.view={}),joms.view.customize=n(),e("views/customize",["popups/stream"],function(){return joms.view.stream})}(window,joms.jQuery,function(){function o(){}return{start:function(){o()},stop:o}}),function(o,t,n){joms.view||(joms.view={}),joms.view.misc=n(o,t),e("views/misc",[],function(){return joms.view.misc})}(window,joms.jQuery,function(o,t){var e,n,s=joms._.debounce(function(){"large"!==joms.screenSize()?n.nextAll(".joms-main").length&&n.insertAfter(e):n.prevAll(".joms-main").length&&n.insertBefore(e)},500);return{start:function(){e=t(".joms-main"),n=t(".joms-sidebar"),s(),t(o).on("resize",s)},fixSVG:joms._.debounce(function(){var e=o.joms_current_url,n="joms-icon--svg-fixed";e&&t(".joms-icon use").not("."+n).each(function(){var o=this.getAttribute("xlink:href")||"",t=o.replace(/^[^#]*#/,"#");o===e+t?n+=" joms-icon--svg-unmodified":this.setAttribute("xlink:href",e+t),this.setAttribute("class",n)})},200)}}),function(o,t,n){joms.view||(joms.view={}),joms.view.stream=n(o,t),e("views/stream",["popups/stream"],function(){return joms.view.stream})}(window,joms.jQuery,function(o,t){function e(){s&&s.off()}function n(o,e,n){""!==e.replace(/^\s+|\s+$/g,"")&&joms.ajax({func:"activities,ajaxSaveStatus",data:[o,e],callback:function(e){var s=t(".joms-stream").filter("[data-stream-id="+o+"]").find(".joms-stream__body"),i=s.find("[data-type=stream-content]"),p=s.find("[data-type=stream-editor]"),a=p.find("textarea");e.success?(i.html("<span>"+e.data+"</span>"),a.val(e.unparsed)):a.val(n),p.hide(),i.show()}})}var s;return{start:function(){e(),s=t(".joms-stream__wrapper")},stop:e,like:function(e){joms.ajax({func:"system,ajaxStreamAddLike",data:[e],callback:function(n){var i,p,a,u;n.success&&(i=s.find(".joms-js--stream-"+e)).length&&((p=i.find(".joms-stream__actions").find(".joms-button--liked")).attr("onclick","joms.api.streamUnlike('"+e+"');"),p.addClass("liked"),p.find("span").html(p.data("lang-unlike")),p.find("use").attr("xlink:href",o.location+"#joms-icon-thumbs-down"),a=i.find(".joms-stream__status"),n.html?a.length?a.html(n.html):(a=i.find(".joms-stream__actions"),(a=t("<div class=joms-stream__status />").insertAfter(a)).html(n.html)):a.remove(),(u=i.find(".joms-stream__status--mobile")).length&&(u=u.find(".joms-like__counter--"+e)).html(+u.eq(0).text()+1))}})},unlike:function(e){joms.ajax({func:"system,ajaxStreamUnlike",data:[e],callback:function(n){var i,p,a,u;n.success&&(i=s.find(".joms-js--stream-"+e)).length&&((p=i.find(".joms-stream__actions").find(".joms-button--liked")).attr("onclick","joms.api.streamLike('"+e+"');"),p.removeClass("liked"),p.find("span").html(p.data("lang-like")),p.find("use").attr("xlink:href",o.location+"#joms-icon-thumbs-up"),a=i.find(".joms-stream__status"),n.html?a.length?a.html(n.html):(a=i.find(".joms-stream__actions"),(a=t("<div class=joms-stream__status />").insertAfter(a)).html(n.html)):a.remove(),(u=i.find(".joms-stream__status--mobile")).length&&(u=u.find(".joms-like__counter--"+e)).html(+u.eq(0).text()-1))}})},edit:function(o){var e=t(".joms-js--stream-"+o).eq(0).find(".joms-stream__body"),n=e.find("[data-type=stream-content]"),s=e.find("[data-type=stream-editor]"),i=s.find("textarea"),p=i.val();n.hide(),s.show(),i.removeData("joms-tagging"),i.jomsTagging(),i.off("reset.joms-tagging"),i.on("reset.joms-tagging",function(){s.hide(),n.show(),i.val(p)}),i.focus()},save:function(o,e){var s=t(e).closest(".joms-js--stream").find(".joms-stream__body").find("[data-type=stream-editor]").find("textarea"),i=s.val();s[0].joms_hidden&&(i=s[0].joms_hidden.val()),n(o,i,i)},cancel:function(o){var e=t(".joms-js--stream-"+o).find(".joms-stream__body"),n=e.find("[data-type=stream-content]");e.find("[data-type=stream-editor]").hide(),n.show()},editLocation:function(o){joms.popup.stream.editLocation(o)},remove:function(o){joms.popup.stream.remove(o)},removeLocation:function(o){joms.popup.stream.removeLocation(o)},removeMood:function(o){joms.popup.stream.removeMood(o)},removeTag:function(o){joms.ajax({func:"activities,ajaxRemoveUserTag",data:[o,"post"],callback:function(e){var n,s,i,p,a;e.success&&(s=(n=t(".joms-js--stream-"+o)).find(".joms-stream__body"),i=n.find(".joms-list__options").find(".joms-dropdown").find(".joms-js--contextmenu-removetag"),p=s.find("[data-type=stream-content]"),a=s.find("[data-type=stream-editor]").find("textarea"),p.html("<span>"+e.data+"</span>"),a.val(e.unparsed),i.remove())}})},selectPrivacy:function(o){joms.popup.stream.selectPrivacy(o)},share:function(o){joms.popup.stream.share(o)},hide:function(o,t){joms.ajax({func:"activities,ajaxHideStatus",data:[o,t],callback:function(t){var e;t.success&&(e=s.find(".joms-stream[data-stream-id="+o+"]")).fadeOut(500,function(){e.remove()})}})},ignoreUser:function(o){joms.popup.stream.ignoreUser(o)},showLikes:function(o,t){"popup"!==t?joms.ajax({func:"system,ajaxStreamShowLikes",data:[o],callback:function(t){t.success&&s.find(".joms-stream[data-stream-id="+o+"]").find(".joms-stream__status").html(t.html||"")}}):joms.popup.stream.showLikes(o,t)},showComments:function(o,t){joms.popup.stream.showComments(o,t)},showOthers:function(o){joms.popup.stream.showOthers(o)},report:function(o){joms.popup.stream.report(o)},toggleText:function(o){var e=t(".joms-js--stream-text-"+o),n=t(".joms-js--stream-textfull-"+o),s=t(".joms-js--stream-texttoggle-"+o);n.is(":visible")?(n.hide(),e.show(),s.html(s.data("lang-more"))):(e.hide(),n.show(),s.html(s.data("lang-less")))},addFeatured:function(o){joms.popup.stream.addFeatured(o)},removeFeatured:function(o){joms.popup.stream.removeFeatured(o)}}}),function(o,t,e){joms.util||(joms.util={}),joms.util.photos=e(o,t)}(window,joms.jQuery,function(o,t){function e(o,t){var e=0,n=t.length;t.each(function(s){var p,a,u,c;for(p=0,c=e;c<=s;c++)p+=(a=t.eq(c).data()).width/a.height;if((u=o/p)<=i){for(c=e;c<=s;c++)t.eq(c).find("img").css({height:u});e=s+1}else if(c===n)for(c=e;c<=n;c++)t.eq(c).nextAll().andSelf().css({height:i}).find("img").css({height:u})}),t.css("border","1px solid transparent"),setTimeout(function(){t.css("border","")})}function n(){var o,t;for(o=0;o<s.length;o++)e((t=s[o]).width(),t.children())}var s=[],i=180;return t(o).resize(joms._.debounce(function(){n()},500)),{arrange:function(o){var n=o.children(),i=o.width();n.css({display:"block",float:"left",margin:"1px 0",overflow:"hidden",padding:0,position:"relative"}).each(function(){var o=t(this);o.data({width:o.width(),height:o.height()})}),e(i,n),s.push(o)}}}),e("utils/photos",function(){}),function(o,t,n){joms.view||(joms.view={}),joms.view.streams=n(o,t),e("views/streams",["utils/hovercard","utils/photos","utils/video","functions/tagging"],function(){return joms.view.streams})}(window,joms.jQuery,function(o,t){function e(){f&&f.off()}function n(){t(".joms-media--images").not(".joms-js--initialized").each(function(){var o=t(this),e=o.find("img"),n=0;e.each(function(){var s=t(this);t("<img>").load(function(){++n===e.length&&(o.siblings(".joms-media--loading").remove(),o.addClass(".joms-js--initialized".substr(1)),e.show(),joms.util.photos.arrange(o))}).attr("src",s.attr("src"))})})}function s(){var o=".joms-js--video",e=t(".joms-stream__body").find(o).not(".joms-js--initialized").addClass(".joms-js--initialized".substr(1));e.length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),e.on("click.joms-video",o+"-play",function(){var e=t(this).closest(o);joms.util.video.play(e,e.data())}),joms.ios&&setTimeout(function(){e.find(o+"-play").click()},1e3))}function i(){joms.fn.tagging.initInputbox()}function p(o){var e,n;return(e=f.find(".joms-stream").not(".joms-stream--adagency")).length?(n=[],e.each(function(){n.push(+t(this).data("stream-id"))}),n["last"===o?n.length-1:0]):0}function a(){var o=f.children(".joms-stream__container");return{filter:o.data("filter"),filterId:o.data("filterid"),filterValue:o.data("filter-value")}}function u(){var e,n,s=u;s.loading||((e=o.joms_newest_stream_id)?(n=a(),s.loading=!0,s.xhr&&s.xhr.abort(),s.xhr=joms.ajax({func:"activities,ajaxGetRecentActivitiesCount",data:[e,n.filter,n.filterId,n.filterValue],callback:function(e){var n,i=+e.count,p=+e.nextPingDelay,a=t(".joms-js--stream-latest");s.loading=!1,s.xhr=null,o.joms_postbox_posting||(i>0?((n=t('<a href="javascript:">'+e.html+"</a>")).on("click",c),a.html(n).show()):a.hide().empty()),p>0&&joms._.delay(u,p)}})):console.warn("Variable `window.joms_newest_stream_id` not found."))}function c(){var e,u,r=c;r.loading||(e=p())&&(u=a(),r.loading=!0,r.xhr&&r.xhr.abort(),r.xhr=joms.ajax({func:"activities,ajaxGetRecentActivities",data:[e,u.filter,u.filterId,u.filterValue],callback:function(e){var p,a=t(t.trim(e.html)).filter(".joms-stream__wrapper").find(".joms-stream"),u=t(".joms-js--stream-latest");if(e.newest_stream_id&&(o.joms_newest_stream_id=+e.newest_stream_id),r.loading=!1,a.length)for(p=a.length-1;p>=0;p--)t(".joms-js--stream-"+a.eq(p).data("stream-id")).length||f.find(".joms-stream__container").prepend(a.eq(p));u.hide(),i(),n(),s()}}))}function r(){var o,e,u,c,m=r;m.loading||(o=p("last"))&&(e=a(),m.loading=!0,u=f.find("#activity-more"),c=u.find(".loading"),(u=u.find(".joms-button--primary")).hide(),c.show(),joms.ajax({func:"activities,ajaxGetOlderActivities",data:[o,e.filter,e.filterId,e.filterValue],callback:function(o){var e,p=!1;m.loading=!1,c.hide(),o.html&&((e=t(t.trim(o.html)).filter(".joms-stream__wrapper").find(".joms-stream")).length?f.find(".joms-stream__container").append(e):p=!0),i(),n(),s(),d(),p||u.show()}}))}function m(){joms.ajax({func:"system,ajaxGetAdagency",callback:function(o){(v=o||{}).ads&&v.ads.length&&(v.ads=joms._.shuffle(v.ads)),d()}})}function l(o,t){var e;return e='<div data-stream-type="adagency" class="joms-stream joms-stream--adagency">',e+='<div class="joms-stream__header">',e+='<div class="joms-avatar--stream">',e+='<a href="'+t.on_click_url+'" target="_blank" onclick="window.open(\''+t.on_click_url+"'); return false;\">",e+='<img src="'+t.banner_avatar+'">',e+="</a>",e+="</div>",e+='<div class="joms-stream__meta">',e+='<a class="joms-stream__user" href="'+t.on_click_url+'" target="_blank" onclick="window.open(\''+t.on_click_url+"'); return false;\">"+t.banner_headline+"</a>",e+='<a href="'+t.on_click_url+'" target="_blank" onclick="window.open(\''+t.on_click_url+'\'); return false;"><span class="joms-stream__time"><small>'+(t.short_url_to_promote||t.url_to_promote)+"</small></span></a>",e+="</div>",e+="</div>",e+='<div class="joms-stream__body">',e+="<p>"+t.banner_text+"</p>",e+='<div class="joms-media--image">',e+='<a href="'+t.on_click_url+'" target="_blank" onclick="window.open(\''+t.on_click_url+"'); return false;\">",e+='<img src="'+t.banner_image_content+'">',e+="</a>",e+="</div>",e+="</div>",(+o.show_sponsored_stream_info||+o.show_create_ad_link)&&(e+='<div class="joms-stream__actions">',+o.show_sponsored_stream_info&&(e+='<span style="float:left">'+o.sponsored_stream_info_text+"</span>"),+o.show_create_ad_link&&(e+='<a href="'+o.create_ad_link+'" style="float:right">'+o.create_ad_link_text+"</a>"),e+='<div style="clear:both"></div>',e+="</div>"),e+="</div>"}function d(){var e,n,s,i,p,a,u;if(v&&v.config&&v.ads&&v.ads.length){if(e=v.ads,n=v.config,s=+n.display_stream_ads_after_value,i=+n.display_stream_ads_every_value,a=+n.display_stream_ads,p=0,!+o.joms_my_id)for(var c=e.length-1;c>=0;c--)+e[c].banner_access||e.splice(c,1);e.length&&(u={frontpage:"front_page_stream",profile:"profile_stream",groups:"group_stream",events:"event_stream"},(n.js_stream_ads_on||[]).indexOf(u[o.joms_page])<0||f.find(".joms-stream").not(".joms-stream--adagency").each(function(o){var u,c;if(a){if(!s)return!1;if(o===s-1)return u=t(this),(c=u.next()).length&&c.hasClass("joms-stream--adagency")||(u.after(l(n,e[p])),j(e[p])),!1}else{if(!i)return!1;(o+1)%i==0&&((c=(u=t(this)).next()).length&&c.hasClass("joms-stream--adagency")||(u.after(l(n,e[p%e.length])),j(e[p%e.length])),p++)}}))}}function j(o){var t=[o.advertiser_id,o.campaign_id,o.banner_id,o.campaign_type].join("-");b||(b={}),b[t]||(b[t]=!0,joms.ajax({func:"system,ajaxAdagencyGetImpression",data:[o.advertiser_id,o.campaign_id,o.banner_id,o.campaign_type],callback:function(){}}))}var f,v,b,h=function(){var e,u,c,r,m,l,j;if(joms.mobile)return!1;u=t(".joms-stream__loadmore"),c=t(o),r=t(document),m=u.find(".loading"),l=Math.max(+o.joms_autoloadtrigger||0,20),j=0,u.find("a").hide(),e=h=joms._.debounce(function(){var o,u,v,b=c.scrollTop(),h=c.height();o=b<j?"up":"down",j=b,"down"===o&&(b+h<r.height()-l||e.loading||(e.loading=!0,m.show(),(u=p("last"))&&(v=a(),joms.ajax({func:"activities,ajaxGetOlderActivities",data:[u,v.filter,v.filterId,v.filterValue],callback:function(o){var p,a=!1;m.hide(),o.html&&((p=t(t.trim(o.html)).filter(".joms-stream__wrapper").find(".joms-stream")).length?f.find(".joms-stream__container").append(p):a=!0),i(),n(),s(),d(),a||setTimeout(function(){e.loading=!1},800)}}))))},50),c.on("scroll",h)};return{start:function(){if(e(),(f=t(".joms-stream__wrapper")).length){i(),n(),s(),o.joms_singleactivity||o.joms_filter_hashtag||o.joms_filter_keyword||(+o.joms_adagency&&m(),+o.joms_infinitescroll&&h(),+o.joms_enable_refresh&&u());var p=document.getElementsByClassName("joms-activity-filter-action");p&&p.length&&o.FastClick.attach(p[0])}},stop:e,loadMore:r}}),function(o,t,e){joms.view||(joms.view={}),joms.view.toolbar=e(o,t)}(window,joms.jQuery,function(o,t){function e(o){t(o.target).closest(".joms-trigger__menu--main, .joms-trigger__menu--user, .joms-menu, .joms-menu--user").length||(m.hasClass("show-menu")||m.hasClass("show-menu--user"))&&(o.preventDefault(),o.stopPropagation(),m.removeClass("show-menu"),m.removeClass("show-menu--user"))}function n(o){o.stopPropagation(),m.toggleClass("show-menu")}function s(o){o.stopPropagation(),m.toggleClass("show-menu--user")}function i(o){var e=t(o.currentTarget).closest("li");e.hasClass("show-submenu")?e.removeClass("show-submenu"):e.addClass("show-submenu").siblings().removeClass("show-submenu")}function p(){m&&(m.off("click.menu"),m.off("click.menu",".joms-js--has-dropdown"),m.off("mouseenter.menu",".joms-toolbar--desktop > ul > li > a.joms-js--has-dropdown"),m.off("mouseleave.menu",".joms-toolbar--desktop")),l&&l.off("click.menu"),d&&d.off("click.menu"),j&&j.off("click.submenu")}function a(o){var e=t(o.currentTarget),n=e.data("connection");joms.ajax({func:"friends,ajaxRejectRequest",data:[n],callback:function(o){(e=t(".joms-js__friend-request-"+n)).find(".joms-popover__actions").remove(),e.find(".joms-popover__content").html(o.error||o.message),c("friendrequest",-1)}})}function u(o){var e=t(o.currentTarget),n=e.data("connection");joms.ajax({func:"friends,ajaxApproveRequest",data:[n],callback:function(o){(e=t(".joms-js__friend-request-"+n)).find(".joms-popover__actions").remove(),e.find(".joms-popover__content").html(o.error||o.message),c("friendrequest",-1)}})}function c(o,e){var n;["general","friendrequest","pm"].indexOf(o)<0||(e=+(n=t(".joms-notifications__label--"+o)).eq(0).text()+e,n.html(e>0?e:""))}function r(){+o.joms_my_id&&t(".joms-js--notiflabel-general").length&&joms.ajax({func:"activities,ajaxGetTotalNotifications",callback:function(o){var e,n,s,i,p;o||(o={}),e=o.newNotificationCount,n=o.newFriendInviteCount,s=o.newMessageCount,i=+o.nextPingDelay,void 0!==e&&(e=+e||"",t(".joms-js--notiflabel-general").html(e),p=(p=document.title).replace(/^\(\d+\)\s/,""),p=(e?"("+e+") ":"")+p,document.title=p),void 0!==n&&t(".joms-js--notiflabel-frequest").html(+n||""),void 0!==s&&t(".joms-js--notiflabel-inbox").html(+s||""),i>0&&joms._.delay(r,i)}})}var m,l,d,j,f,v;return{start:function(){m||(m=t(".jomsocial-wrapper")),l||(l=t(".joms-trigger__menu--main")),d||(d=t(".joms-trigger__menu--user")),j||(j=t(".joms-menu__toggle")),p(),m.on("click.menu",e),m.on("click.menu",".joms-js--has-dropdown",function(e){e.preventDefault(),e.stopPropagation(),o.location=t(e.currentTarget).attr("href")}),m.on("mouseenter.menu",".joms-toolbar--desktop > ul > li > a.joms-js--has-dropdown",function(o){var e=t(o.currentTarget);e.siblings("ul.joms-dropdown").is(":visible")||(v=e.trigger("click.dropdown"))}),m.on("mouseleave.menu",".joms-toolbar--desktop",function(){v&&(v.trigger("collapse.dropdown"),v=void 0)}),l.on("click.menu",n),d.on("click.menu",s),j.on("click.submenu",i),r()},stop:p,notificationGeneral:function(){joms.ajax({func:"notification,ajaxGetNotification",data:[""],callback:function(o){o.html&&t(".joms-popover--toolbar-general").html(o.html)}})},notificationFriend:function(){joms.ajax({func:"notification,ajaxGetRequest",data:[""],callback:function(o){var e;o.html&&((e=t(".joms-popover--toolbar-friendrequest")).html(o.html),e.off("click",".joms-button__approve").on("click",".joms-button__approve",a),e.off("click",".joms-button__reject").on("click",".joms-button__reject",u))}})},notificationPm:function(){joms.ajax({func:"notification,ajaxGetInbox",data:[""],callback:function(o){o.html&&t(".joms-popover--toolbar-pm").html(o.html)}})},notificationCounter:c,search:function(o){var e,n,s,i=o,p=/^\s+|\s+$/g;"string"!=typeof o&&(i=t(o).val()),(i=i||"").replace(p,"")&&(f&&f.abort(),o=t(".joms-popover--toolbar-search"),e=o.find(".joms-js--field"),n=o.find(".joms-js--loading"),s=o.find(".joms-js--viewall"),o.find("li:not(.joms-js--noremove)").remove(),s.hide(),n.show(),f=joms.ajax({func:"search,ajaxSearch",data:[i],callback:function(t){var p,a,u,c,r;if(n.hide(),t.error)return p='<li class="joms-js--error">'+t.error+"</li>",void e.after(p);if(t.length){for(p="",c=Math.min(3,t.length),a=0;a<c;a++)p+='<li><div class="joms-popover__avatar"><div class="joms-avatar">',p+='<img src="'+t[a].thumb+'"></div></div>',p+='<div class="joms-popover__content">',p+='<h5><a href="'+t[a].url+'">'+t[a].name+"</a></h5>",p+="</div></li>";(u=s.find("form")).find("input").val(i),s.off("click","a").on("click","a",function(){u[0].submit()}),(r=s.find("a")).html(r.data("lang").replace("%1$s",t.length)),e.after(p),s.show(),o.show()}}}))}}}),e("views/toolbar",function(){}),function(o,t,n){joms.fn||(joms.fn={}),joms.fn.announcement=n(o,t),e("functions/announcement",[],function(){return joms.fn.announcement})}(window,joms.jQuery,function(o,t){return{edit:function(o,e){t(".joms-js--announcement-view-"+o+"-"+e).hide(),t(".joms-js--announcement-edit-"+o+"-"+e).show(),t(".joms-subnav,.joms-subnav--desktop").hide(),t(".joms-sidebar").hide(),t(".joms-main").css({padding:0,width:"100%"})},editCancel:function(o,e){t(".joms-js--announcement-edit-"+o+"-"+e).hide(),t(".joms-js--announcement-view-"+o+"-"+e).show(),t(".joms-subnav,.joms-subnav--desktop").css("display",""),t(".joms-main").css({padding:"",width:""}),t(".joms-sidebar").show()}}}),function(o,t,n){joms.fn||(joms.fn={}),joms.fn.facebook=n(),e("functions/facebook",[],function(){return joms.fn.facebook})}(window,joms.jQuery,function(){return{update:function(){joms.ajax({func:"connect,ajaxUpdate",data:[""],callback:function(o){console.log(o)}})}}}),function(o,t,n){joms.fn||(joms.fn={}),joms.fn.notification=n(o,t),e("functions/notification",[],function(){return joms.fn.notification})}(window,joms.jQuery,function(o,t){var e=[];return{updateCounter:function(o,n,s){var i;n=o+"-"+n,e.indexOf(n)>=0||(i=t(".joms-js--notiflabel-"+o),e.indexOf(n)<0&&(e.push(n),s=+i.eq(0).text()+s,i.html(s>0?s:"")))}}}),function(o,t,n){joms.fn||(joms.fn={}),joms.fn.invitation=n(o,t),e("functions/invitation",["functions/notification"],function(){return joms.fn.invitation})}(window,joms.jQuery,function(o,t){function e(o,e,n){t(".joms-js--invitation-buttons-"+o+"-"+e).remove(),t(".joms-js--invitation-notice-"+o+"-"+e).html(n&&n.message||""),joms.fn.notification.updateCounter("general",e,-1)}return{accept:function(o,t){var n="group"===o?"notification,ajaxGroupJoinInvitation":"events,ajaxJoinInvitation",s=[t];joms.ajax({func:n,data:s,callback:function(n){e(o,t,n)}})},reject:function(o,t){var n="group"===o?"notification,ajaxGroupRejectInvitation":"events,ajaxRejectInvitation",s=[t];joms.ajax({func:n,data:s,callback:function(n){e(o,t,n)}})}}}),function(o,t,e){joms.util||(joms.util={}),joms.util.field=e(o,t)}(window,joms.jQuery,function(o,t){function e(){return['<div data-wrap="file" style="width:350px;max-width:100%;position:relative;overflow:hidden">','<input type="text" class="joms-input" readonly="readonly" placeholder="',o.joms_lang&&o.joms_lang.COM_COMMUNITY_SELECT_FILE||"Select file",'.."','style="margin-bottom:2px">',"</div>"].join("")}function n(o){var t=o.match(/[^\\\/]+$/);return t&&t[0]?t[0]:""}return{file:function(o){(o=t(o)).each(function(o,s){var i;s=t(s),(i=s.parent()).data("wrap")||(i=t(e()),s.before(i),s.hide(),s.appendTo(i),s.css({cursor:"pointer",position:"absolute",right:0,top:0,width:"100%",height:"100%",opacity:0}),s.show()),s.off("change.joms-file"),s.on("change.joms-file",function(){i.find(".joms-input").val(n(t(this).val()))})})}}}),e("utils/field",function(){}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.info=n(),e("popups/info",["utils/popup"],function(){return joms.popup.info})}(window,joms.jQuery,function(){function o(o,e,n){o.items[0]={type:"inline",src:t(e,n)},o.updateItemHTML()}function t(o,t){return['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o||"&nbsp;","</div>",'<div class="joms-popup__content joms-popup__content--single">',t||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',window.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}return function(t,e){joms.util.popup.prepare(function(n){o(n,t,e)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.login=n(),e("popups/login",["utils/popup"],function(){return joms.popup.login})}(window,joms.jQuery,function(){function o(o,e){if(e&&"object"==typeof e)t(o,e);else{var n=e;"string"!=typeof e&&(n=(n=window.location.href).replace(/#.*$/,"")),joms.ajax({func:"system,ajaxLogin",data:[n],callback:function(e){t(o,e)}})}}function t(o,t){i&&i.off(),(s=o).items[0]={type:"inline",src:n(t)},s.updateItemHTML(),(i=s.contentContainer).find("form").on("submit",e)}function e(o){o.preventDefault(),o.stopPropagation(),joms.ajax({func:"system,ajaxGetLoginFormToken",data:[],callback:function(o){var t=i.find("form");o.token&&t.find(".joms-js--token input").prop("name",o.token),t.off("submit"),t.find("[name=submit]").click()}})}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',o.html||"","</div>","</div>"].join("")}var s,i;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.album||(joms.popup.album={}),joms.popup.album.addFeatured=n(o),e("popups/album.addfeatured",["utils/popup"],function(){return joms.popup.album.addFeatured})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p,joms.ajax({func:"photos,ajaxAddFeatured",data:[i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()},n.updateItemHTML()}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.album||(joms.popup.album={}),joms.popup.album.removeFeatured=n(o),e("popups/album.removefeatured",["utils/popup"],function(){return joms.popup.album.removeFeatured})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p,joms.ajax({func:"photos,ajaxRemoveFeatured",data:[i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()},n.updateItemHTML()}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.album||(joms.popup.album={}),joms.popup.album.remove=t(),e("popups/album.remove",["utils/popup"],function(){return joms.popup.album.remove})}(window,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"photos,ajaxRemoveAlbum",data:[p,"myphotos"],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click","[data-ui-object=popup-button-cancel]",t),i.on("click","[data-ui-object=popup-button-save]",e)}})}function t(){i.off(),s.close()}function e(){i.find("form").submit()}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div data-ui-object="popup-step-1"',o.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',o.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnYes,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',o.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',o.error||"","</div>","</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.album=t(o,joms.popup.album||{}),e("popups/album",["popups/album.addfeatured","popups/album.removefeatured","popups/album.remove"],function(){return joms.popup.album})}(window,function(o,t){return joms._.extend({},t)}),function(o,t){joms.popup||(joms.popup={}),joms.popup.announcement||(joms.popup.announcement={}),joms.popup.announcement.remove=t(),e("popups/announcement.remove",["utils/popup"],function(){return joms.popup.announcement.remove})}(window,function(){function o(o,u,c){i&&i.off(),s=o,p=u,a=c,joms.ajax({func:"groups,ajaxShowRemoveBulletin",data:[p,a],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(){i.find("form")[0].submit()}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var s,i,p,a;return function(t,e){joms.util.popup.prepare(function(n){o(n,t,e)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.announcement=t(o,joms.popup.announcement||{}),e("popups/announcement",["popups/announcement.remove"],function(){return joms.popup.announcement})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.app||(joms.popup.app={}),joms.popup.app.about=n(),e("popups/app.about",["utils/popup"],function(){return joms.popup.app.about})}(window,joms.jQuery,function(){function o(o,i){n&&n.off(),e=o,s=i,joms.ajax({func:"apps,ajaxShowAbout",data:[s],callback:function(o){e.items[0]={type:"inline",src:t(o)},e.updateItemHTML()}})}function t(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',o.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',window.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var e,n,s;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.app||(joms.popup.app={}),joms.popup.app.browse=n(o,t),e("popups/app.browse",["utils/popup"],function(){return joms.popup.app.browse})}(window,joms.jQuery,function(o,t){function e(o,t){c&&c.off(),u=o,r=t,joms.ajax({func:"apps,ajaxBrowse",data:[r],callback:function(o){u.items[0]={type:"inline",src:a(o)},u.updateItemHTML(),(c=u.contentContainer).on("click","a[data-appname]",n),c.on("click",".joms-js--btn-view-all",p)}})}function n(o){var e=t(o.target),n=e.data("appname"),i=e.data("position"),p=i.indexOf("-stacked")>=0;joms.ajax({func:"apps,ajaxAddApp",data:[n,i],callback:function(o){var e,i,a;o.success&&(a=(e=t(".joms-js--app-pos-"+r)).find(".joms-tab__bar").eq(0),p?a.before(t(o.item).show()):((i=a.find(".joms-js--app-new")).prevAll().removeClass("active"),i.before('<a href="#joms-js--app-app_id" class="no-padding joms-js--app-tab-app_id active"><div class="joms-tab__bar--button"><span class="title">app_title</span></div></a>'.replace(/app_id/g,o.id).replace(/app_title/,o.title)),e.find(".joms-tab__content").hide(),e.append(t(o.item).show())),s(o.id,n))}})}function s(o,t){joms.ajax({func:"apps,ajaxShowSettings",data:[o,t],callback:function(o){c.off("click","a[data-appname]"),c.html(a(o,"setting")),c.on("click",".joms-popup__content,.joms-popup__action",function(o){return o.stopPropagation(),!1}),c.on("click","[data-ui-object=popup-button-save]",function(){i()})}})}function i(){var o,t=c.find("form").serializeArray(),e=[];for(o=0;o<t.length;o++)e.push([t[o].name,t[o].value]);joms.ajax({func:"apps,ajaxSaveSettings",data:[e],callback:function(o){if(o.error)return c.find(".joms-popup__content").html(o.error),void c.find(".joms-popup__action").remove();u.close()}})}function p(){var o=c.find(".joms-popup__content").eq(0),t=o.innerHeight();o.css({height:t,overflow:"auto"}),c.find(".joms-js--btn-view-all").parent().remove(),c.find(".joms-js--app").show(),o.animate({scrollTop:o[0].scrollHeight})}function a(t,e){var n="";return t||(t={}),n="setting"===e&&t.btnSave?['<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close joms-left">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',t.btnSave,"</button>","</div>"].join(""):['<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>"].join(""),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||"","</div>",n,"</div>"].join("")}var u,c,r;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.app||(joms.popup.app={}),joms.popup.app.privacy=n(),e("popups/app.privacy",["utils/popup"],function(){return joms.popup.app.privacy})}(window,joms.jQuery,function(){function o(o,p){s&&s.off(),n=o,i=p,joms.ajax({func:"apps,ajaxShowPrivacy",data:[i],callback:function(o){n.items[0]={type:"inline",src:e(o)},n.updateItemHTML(),(s=n.contentContainer).on("click","[data-ui-object=popup-button-save]",t)}})}function t(){var o=s.find("input[type=radio]:checked").val();joms.ajax({func:"apps,ajaxSavePrivacy",data:[i,o],callback:function(o){if(o.error)return s.find(".joms-popup__content").html(o.error),void s.find(".joms-popup__action").remove();n.close()}})}function e(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',o.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnSave,"</button>","</div>","</div>"].join("")}var n,s,i;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.app||(joms.popup.app={}),joms.popup.app.remove=n(o,t),e("popups/app.remove",["utils/popup"],function(){return joms.popup.app.remove})}(window,joms.jQuery,function(o,t){function e(o,e){i&&i.off(),s=o,p=e,joms.ajax({func:"apps,ajaxRemove",data:[p],callback:function(o){var e,i,a;s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),e=t(".joms-js--app-tab-"+p),a=t("#joms-js--app-"+p),(i=e.prev()).length||(i=e.next().not(".joms-js--app-new")),e.remove(),a.remove(),i.length&&i.click()}})}function n(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var s,i,p;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.app||(joms.popup.app={}),joms.popup.app.setting=n(),e("popups/app.setting",["utils/popup"],function(){return joms.popup.app.setting})}(window,joms.jQuery,function(){function o(o,a,u){s&&s.off(),n=o,i=a,p=u,joms.ajax({func:"apps,ajaxShowSettings",data:[i,p],callback:function(o){n.items[0]={type:"inline",src:e(o)},n.updateItemHTML(),(s=n.contentContainer).on("click","[data-ui-object=popup-button-save]",t)}})}function t(){var o,t=s.find("form").serializeArray(),e=[];for(o=0;o<t.length;o++)e.push([t[o].name,t[o].value]);joms.ajax({func:"apps,ajaxSaveSettings",data:[e],callback:function(o){if(o.error)return s.find(".joms-popup__content").html(o.error),void s.find(".joms-popup__action").remove();n.close()}})}function e(o){var t="";return o||(o={}),o.btnSave&&(t=['<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close joms-left">',window.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnSave,"</button>","</div>"].join("")),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content joms-popup__content--single" style="max-height:315px; overflow:auto">',o.html||"","</div>",t,"</div>"].join("")}var n,s,i,p;return function(t,e){joms.util.popup.prepare(function(n){o(n,t,e)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.app=t(o,joms.popup.app||{}),e("popups/app",["popups/app.about","popups/app.browse","popups/app.privacy","popups/app.remove","popups/app.setting"],function(){return joms.popup.app})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.avatar||(joms.popup.avatar={}),joms.popup.avatar.change=n(o,t),e("popups/avatar.change",["utils/crop","utils/loadlib","utils/popup"],function(){return joms.popup.avatar.change})}(window,joms.jQuery,function(o,t){function e(o,t,e){v&&v.off(),f=o,b=t,h=e,joms.ajax({func:"photos,ajaxUploadAvatar",data:[b,h],callback:function(o){f.items[0]={type:"inline",src:j(o)},f.updateItemHTML(),(v=f.contentContainer).on("click",".joms-js--button-upload",a),v.on("click",".joms-js--button-save",n),v.on("click",".joms-js--button-rotate-left",s),v.on("click",".joms-js--button-rotate-right",i),u()}})}function n(){var t=joms.util.crop.getSelection();joms.ajax({func:"photos,ajaxUpdateThumbnail",data:[b,h,t.x,t.y,t.width,t.height],callback:function(t){t.success&&o.location.reload(!0)}})}function s(){joms.api.avatarRotate(b,h,"left",function(){p()})}function i(){joms.api.avatarRotate(b,h,"right",function(){p()})}function p(){var o=t(".joms-avatar__cropper").find("img"),e=o.attr("src");e=(e=e.replace(/\?.*$/,""))+"?_="+(new Date).getTime(),joms.util.crop.detach(),o.removeAttr("src"),o.attr("src",e),setTimeout(function(){joms.util.crop(o)},100)}function a(){u(function(){w.click()})}function u(e){"function"!=typeof e&&(e=function(){}),_?e():joms.util.loadLib("plupload",function(){var n;n=v.find("form").attr("action"),g=t('<div id="joms-js--avatar-uploader" aria-hidden="true" style="width:1px; height:1px; position:absolute; overflow:hidden;">').appendTo(document.body),w=t('<div id="joms-js--avatar-uploader-button">').appendTo(g),(_=new o.plupload.Uploader({url:n,filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}],container:"joms-js--avatar-uploader",browse_button:"joms-js--avatar-uploader-button",runtimes:"html5,html4",multi_selection:!1,file_data_name:"filedata"})).bind("FilesAdded",c),_.bind("Error",r),_.bind("UploadProgress",m),_.bind("FileUploaded",l),_.bind("UploadComplete",d),_.init(),w=g.find("input[type=file]"),e()})}function c(t){o.setTimeout(function(){v.find(".joms-progressbar__progress").css({width:0}),t.refresh(),t.start()},0)}function r(){}function m(o,t){var e;e=Math.min(100,Math.floor(t.loaded/t.size*100)),v.find(".joms-progressbar__progress").stop().animate({width:e+"%"})}function l(o,e,n){var s,i={};try{i=JSON.parse(n.response)}catch(o){}k=i,i.msg&&!i.error&&((s=t(".joms-avatar__cropper")).find("img").attr("src",i.msg),s.show(),setTimeout(function(){var o=s.find("img");joms.util.crop.detach(),joms.util.crop(o)},100))}function d(){k.error?(v.find(".joms-js--avatar-uploader-error").html(k.msg).show(),v.find(".joms-progressbar__progress").stop().animate({width:"0%"})):v.find(".joms-js--avatar-uploader-error").hide()}function j(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",t.html||"",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var f,v,b,h,_,g,w,k;return function(o,t){joms.util.popup.prepare(function(n){e(n,o,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.avatar||(joms.popup.avatar={}),joms.popup.avatar.remove=n(),e("popups/avatar.remove",["utils/popup"],function(){return joms.popup.avatar.remove})}(window,joms.jQuery,function(){function o(o,a,u){i&&i.off(),s=o,p=u,joms.ajax({func:"profile,ajaxRemovePicture",data:[p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click","[data-ui-object=popup-button-cancel]",t),i.on("click","[data-ui-object=popup-button-save]",e)}})}function t(){i.off(),s.close()}function e(){i.find("form").submit()}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',o.html||"","</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnYes,"</button>",'<div class="joms-popup__hide">','<form method="POST" action="',o.redirUrl,'"><input type="hidden" name="userid" value="',p,'"></form>',"</div>","</div>","</div>"].join("")}var s,i,p;return function(t,e){joms.util.popup.prepare(function(t){o(t,0,e)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.avatar||(joms.popup.avatar={}),joms.popup.avatar.rotate=n(o,t),e("popups/avatar.rotate",[],function(){return joms.popup.avatar.rotate})}(window,joms.jQuery,function(o,t){function e(e,n,s,i){joms.ajax({func:"profile,ajaxRotateAvatar",data:[e,n,s],callback:function(e){e.error?o.alert(e.error):e.success&&(t(".joms-js--avatar-"+n).attr("src",e.avatar+"?_="+(new Date).getTime()),"function"==typeof i&&i(e))}})}return function(o,t,n,s){e(o,t,n,s)}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.avatar=t(o,joms.popup.avatar||{}),e("popups/avatar",["popups/avatar.change","popups/avatar.remove","popups/avatar.rotate"],function(){return joms.popup.avatar})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.comment||(joms.popup.comment={}),joms.popup.comment.showLikes=n(),e("popups/comment.showlikes",["utils/popup"],function(){return joms.popup.comment.showLikes})}(window,joms.jQuery,function(){function o(o,i){n&&n.off(),e=o,s=i,joms.ajax({func:"activities,ajaxshowLikedUser",data:[s],callback:function(o){e.items[0]={type:"inline",src:t(o)},e.updateItemHTML()}})}function t(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--rounded joms-popup--80pc">','<button class="mfp-close joms-hide"></button>','<div class="joms-comment">',o.html||"","</div>","</div>"].join("")}var e,n,s;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.comment=t(o,joms.popup.comment||{}),e("popups/comment",["popups/comment.showlikes"],function(){return joms.popup.comment})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.cover||(joms.popup.cover={}),joms.popup.cover.change=n(o,t),e("popups/cover.change",["utils/loadlib","utils/popup"],function(){return joms.popup.cover.change})}(window,joms.jQuery,function(o,t){function e(o,t,e){j&&j.off(),d=o,f=t,v=e,joms.ajax({func:"photos,ajaxChangeCover",data:[f,v],callback:function(o){d.items[0]={type:"inline",src:l(o)},d.updateItemHTML(),(j=d.contentContainer).on("click",".joms-js--album",n),j.on("click",".joms-js--back-to-album",s),j.on("click",".joms-js--select-photo",i),j.on("click","[data-ui-object=popup-button-upload]",p),a()}})}function n(){var o=t(this),e=o.data("album"),n=o.data("total");joms.ajax({func:"photos,ajaxGetPhotoList",data:[e,n],callback:function(o){o&&o.html&&(t(".joms-js--album-list").hide(),t(".joms-js--photo-list").html(o.html).show())}})}function s(){t(".joms-js--photo-list").hide(),t(".joms-js--album-list").show()}function i(){var o=t(this).data("photo");joms.ajax({func:"photos,ajaxSetPhotoCover",data:[f,o,v],callback:function(o){o&&o.path&&(t(".joms-js--cover-image > img").attr("src",o.path).css({top:0}),t(".joms-js--cover-image-mobile").css({background:"url("+o.path+") no-repeat center center"}),d.close(),t(".joms-js--menu-reposition").show())}})}function p(){a(function(){_.click()})}function a(e){"function"!=typeof e&&(e=function(){}),b?e():joms.util.loadLib("plupload",function(){var n;n=j.find("form").attr("action"),h=t('<div id="joms-js--cover-uploader" aria-hidden="true" style="width:1px; height:1px; position:absolute; overflow:hidden;">').appendTo(document.body),_=t('<div id="joms-js--cover-uploader-button">').appendTo(h),(b=new o.plupload.Uploader({url:n,filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}],container:"joms-js--cover-uploader",browse_button:"joms-js--cover-uploader-button",runtimes:"html5,html4",multi_selection:!1,file_data_name:"uploadCover"})).bind("FilesAdded",u),b.bind("UploadProgress",c),b.bind("Error",function(){}),b.bind("FileUploaded",r),b.bind("UploadComplete",m),b.init(),_=h.find("input[type=file]"),e()})}function u(t){o.setTimeout(function(){t.refresh(),t.start()},0)}function c(o,t){var e;e=Math.min(100,Math.floor(t.loaded/t.size*100)),j.find(".joms-progressbar__progress").stop().animate({width:e+"%"})}function r(o,e,n){var s={};try{s=JSON.parse(n.response)}catch(o){}g=s,s.path&&(t(".joms-js--cover-image > img").attr("src",s.path).css({top:0}),t(".joms-js--cover-image-mobile").css({background:"url("+s.path+") no-repeat center center"}),d.close(),t(".joms-js--menu-reposition").show())}function m(){g.error?(j.find(".joms-js--cover-uploader-error").html(g.error).show(),j.find(".joms-progressbar__progress").stop().animate({width:"0%"})):j.find(".joms-js--cover-uploader-error").hide()}function l(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",t.html||"",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var d,j,f,v,b,h,_,g;return function(o,t){joms.util.popup.prepare(function(n){e(n,o,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.cover||(joms.popup.cover={}),joms.popup.cover.remove=n(),e("popups/cover.remove",["utils/popup"],function(){return joms.popup.cover.remove})}(window,joms.jQuery,function(){function o(o,u,c){var r,m;i&&i.off(),s=o,r="profile,ajaxRemoveCover",m=[a=c],"group"!==(p=u)&&"event"!==p||(r="photos,ajaxRemoveCover",m=[p,a]),joms.ajax({func:r,data:m,callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(){var o=i.find("form");o.data("saving")||(o.data("saving",1),o.submit())}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">','<div class="joms-popup__content joms-popup__content--single">',o.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>",'<div class="joms-popup__hide">','<form method="POST" action="',o.redirUrl,'">',"group"===p||"event"===p?'<input type="hidden" name="type" value="'+p+'">':"","group"===p||"event"===p?'<input type="hidden" name="id" value="'+a+'">':"","group"===p||"event"===p?"":'<input type="hidden" name="userid" value="'+a+'">',"</form>","</div>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var s,i,p,a;return function(t,e){joms.util.popup.prepare(function(n){o(n,t,e)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.cover=t(o,joms.popup.cover||{}),e("popups/cover",["popups/cover.change","popups/cover.remove"],function(){return joms.popup.cover})}(window,function(o,t){return joms._.extend({},t)}),function(o,t){joms.popup||(joms.popup={}),joms.popup.discussion||(joms.popup.discussion={}),joms.popup.discussion.lock=t(),e("popups/discussion.lock",["utils/popup"],function(){return joms.popup.discussion.lock})}(window,function(){function o(o,u,c){i&&i.off(),s=o,p=u,a=c,joms.ajax({func:"groups,ajaxShowLockDiscussion",data:[p,a],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(){i.find("form")[0].submit()}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var s,i,p,a;return function(t,e){joms.util.popup.prepare(function(n){o(n,t,e)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.discussion||(joms.popup.discussion={}),joms.popup.discussion.remove=t(),e("popups/discussion.remove",["utils/popup"],function(){return joms.popup.discussion.remove})}(window,function(){function o(o,u,c){i&&i.off(),s=o,p=u,a=c,joms.ajax({func:"groups,ajaxShowRemoveDiscussion",data:[p,a],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(){i.find("form")[0].submit()}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var s,i,p,a;return function(t,e){joms.util.popup.prepare(function(n){o(n,t,e)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.discussion=t(o,joms.popup.discussion||{}),e("popups/discussion",["popups/discussion.lock","popups/discussion.remove"],function(){return joms.popup.discussion})}(window,function(o,t){return joms._.extend({},t)}),function(o,t){joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.delete=t(),e("popups/event.delete",["utils/popup"],function(){return joms.popup.event.delete})}(window,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"events,ajaxWarnEventDeletion",data:[p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(o,t,n){var s,a;t?s=[p,t,n]:(s=[p,1],a=i.find("[name=recurring]:checked"),s.push(a&&a.length?a.val():"")),joms.ajax({func:"events,ajaxDeleteEvent",data:s,callback:function(o){var t;i.find(".joms-js--step1").hide(),i.find(".joms-js--step2").show().children().first().append("<div>"+(o.error||o.message)+"</div>"),o.next?e(null,o.next,s[2]):o.redirect&&((t=i.find(".joms-js--step2")).find(".joms-js--button-done").html(o.btnDone).on("click",function(){window.location=o.redirect}),t.find(".joms-popup__action").show(),t.find(".joms-popup__content").removeClass("joms-popup__content--single"))}})}function n(o){var t,e,n;if(o||(o={}),t="",o.radios&&o.radios.length){for(t='<div><form style="margin:5px;padding:0">',n=0;n<o.radios.length;n++)t+='<div><label> <input type="radio" name="recurring" value="'+(e=o.radios[n])[0]+'"'+(e[2]?" checked":"")+"> ",t+=e[1]+"</label></div>";t+="</form></div>"}return['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">','<div class="joms-popup__content">',o.html,t,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnDelete,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>",'<div class="joms-popup__action joms-popup__hide">','<button class="joms-button--primary joms-js--button-done"></button>',"</div>","</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.invite=n(o,t),e("popups/event.invite",["utils/popup"],function(){return joms.popup.event.invite})}(window,joms.jQuery,function(o,t){function e(o,t,e){l&&l.off(),m=o,b=t,h=e,w=200,joms.ajax({func:"system,ajaxShowInvitationForm",data:[null,"",b,1,"group"===h?0:1,h],callback:function(o){m.items[0]={type:"inline",src:r(o)},m.updateItemHTML(),o.limit&&(w=+o.limit),l=m.contentContainer,d=l.find(".joms-tab__content").eq(0),j=l.find(".joms-tab__content").eq(1),f=l.find("[data-btn-select]"),v=l.find("[data-btn-load]"),l.on("keyup","[data-search]",n),l.on("click",".joms-tab__bar a",i),l.on("click","[data-btn-select]",p),l.on("click","[data-btn-load]",a),l.on("click","[data-btn-save]",s),l.on("click","input[type=checkbox]",u),c("")}})}function n(o){c(t(o.currentTarget).val())}function s(){var o,t=j.find("input[type=checkbox]"),e=[],n=l.find("input[name=emails]").val()||"",s=l.find("[name=message]").val()||"",i=/^\s+|\s+$/g;t.each(function(){e.push(this.value)}),o=[["friendsearch",""],["emails",n=n.replace(i,"")],["message",s=s.replace(i,"")],["friends",e.join(",")]],joms.ajax({func:"system,ajaxSubmitInvitation",data:["events,inviteUsers",b,o],callback:function(){l.off(),m.close()}})}function i(e){var n="#joms-popup-tab-selected"===t(e.target).attr("href"),s=o.joms_lang[n?"COM_COMMUNITY_UNSELECT_ALL":"COM_COMMUNITY_SELECT_ALL"];f.html(s)}function p(){var o,e=t(".joms-tab__content:visible");if("joms-popup-tab-selected"===e.attr("id"))return e.find(".joms-js--friend").remove(),void l.find("input[type=checkbox]").each(function(){this.checked=!1});(o=e.find(".joms-js--friend").clone()).find("input[type=checkbox]").add(e.find("input[type=checkbox]")).prop("checked","checked"),(e=l.find("#joms-popup-tab-selected")).html(o)}function a(){c()}function u(o){var e,n,s=t(o.target),i=s.closest(".joms-tab__content");return"joms-popup-tab-selected"===i.attr("id")?(e=s[0].value,s.closest(".joms-js--friend").remove(),void(l.find(".joms-js--friend-"+e+" input[type=checkbox]")[0].checked=!1)):s[0].checked?(i=l.find("#joms-popup-tab-selected"),(s=(n=s.closest(".joms-js--friend").clone()).find("input[type=checkbox]"))[0].checked=!0,void i.append(n)):(e=s[0].value,void l.find("#joms-popup-tab-selected .joms-js--friend-"+e).remove())}function c(e){var n,s,i="string"==typeof e;i?(d.empty(),g=0,_=e):g+=w,n="group"===h?"system,ajaxLoadGroupEventMembers":"system,ajaxLoadFriendsList",s=[_,"events,inviteUsers",b,g,w],"group"===h&&s.splice(1,1),k&&k.abort(),k=joms.ajax({func:n,data:s,callback:function(e){var n;e.html&&((n=t(t.trim(e.html))).each(function(){var o=t(this).find(":checkbox"),e=o.val();j.find(":checkbox[value="+e+"]").length&&(o[0].checked=!0)}),d.append(n)),i||(d[0].scrollTop=d[0].scrollHeight),e.loadMore?(f.css({width:"49%",marginRight:"2%"}),v.css({width:"49%"}).html(o.joms_lang.COM_COMMUNITY_INVITE_LOAD_MORE+" ("+e.moreCount+")").show()):(v.hide(),f.css({width:"100%",marginRight:"0"}))}})}function r(o){return['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div data-ui-object="popup-step-1"',o.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--primary" data-btn-save="1">',o.btnInvite,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',o.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',o.error||"","</div>","</div>","</div>"].join("")}var m,l,d,j,f,v,b,h,_,g,w,k;return function(o,t){joms.util.popup.prepare(function(n){e(n,o,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.join=n(),e("popups/event.join",["utils/popup"],function(){return joms.popup.event.join})}(window,joms.jQuery,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"events,ajaxRequestInvite",data:[p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(){i.find("form")[0].submit()}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1 ',o.isMember?"joms-popup__hide":"",'">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2 ',o.isMember?"":"joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.html,"</div>","</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.leave=n(),e("popups/event.leave",["utils/popup"],function(){return joms.popup.event.leave})}(window,joms.jQuery,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"events,ajaxIgnoreEvent",data:[p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(){i.find("form")[0].submit()}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.response=n(o,t),e("popups/event.response",["utils/popup"],function(){return joms.popup.event.response})}(window,joms.jQuery,function(o,t){function e(o,t,e){p&&p.off(),a=t,(i=o).items[0]={type:"inline",src:s(e)},i.updateItemHTML(),(p=i.contentContainer).on("click","a[data-value]",n)}function n(e){var n=t(e.currentTarget).data("value");joms.ajax({func:"events,ajaxUpdateStatus",data:[a,n],callback:function(){o.location.reload()}})}function s(o){var t,e="";for(t=0;t<o.length;t++)e+='<li><a data-value="'+o[t][0]+'" href="javascript:">'+o[t][1]+"</a></li>";return['<div class="joms-popup joms-popup--dropdown">','<ul class="joms-dropdown">',e,"</ul>",'<button class="mfp-close" type="button" title="Close (Esc)">×</button>',"</div>"].join("")}var i,p,a;return function(o){var t=[].slice.call(arguments);t.shift(),joms.util.popup.prepare(function(n){e(n,o,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.addFeatured=n(o),e("popups/event.addfeatured",["utils/popup"],function(){return joms.popup.event.addFeatured})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p,joms.ajax({func:"events,ajaxAddFeatured",data:[i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()},n.updateItemHTML()}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.rejectGuest=n(),e("popups/event.rejectguest",["utils/popup"],function(){return joms.popup.event.rejectGuest})}(window,joms.jQuery,function(){function o(o,u,c){i&&i.off(),s=o,p=u,a=c,joms.ajax({func:"events,ajaxConfirmRemoveGuest",data:[a,p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(){var o=i.find("input:checkbox")[0].checked||!1;joms.ajax({func:o?"events,ajaxBlockGuest":"events,ajaxRemoveGuest",data:[a,p],callback:function(o){var t=i.find(".joms-js--step1"),e=i.find(".joms-js--step2");o.error||(s.st.callbacks||(s.st.callbacks={}),s.st.callbacks.close=function(){window.location.reload()}),e.find(".joms-popup__content").html(o.error||o.message),t.hide(),e.show()}})}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var s,i,p,a;return function(t,e){joms.util.popup.prepare(function(n){o(n,t,e)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.removeFeatured=n(o),e("popups/event.removefeatured",["utils/popup"],function(){return joms.popup.event.removeFeatured})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p,joms.ajax({func:"events,ajaxRemoveFeatured",data:[i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()},n.updateItemHTML()}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.report=t(),e("popups/event.report",["utils/popup"],function(){return joms.popup.event.report})}(window,function(){function o(o,u){p&&p.off(),i=o,a=u,joms.ajax({func:"system,ajaxReport",data:[],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("change","select",t),p.on("click",".joms-js--button-cancel",e),p.on("click",".joms-js--button-save",n)}})}function t(o){p.find("textarea").val(o.target.value)}function e(){p.off(),i.close()}function n(){var o,t=/^\s+|\s+$/g;(o=(o=p.find("textarea").val()).replace(t,""))?(p.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["events,reportEvent",window.location.href,o,a],callback:function(o){p.find(".joms-js--step1").hide(),p.find(".joms-js--step2").show().children().html(o.error||o.message)}})):p.find(".joms-js--error").show()}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">',o.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var i,p,a;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.banMember=n(o),e("popups/event.banmember",["utils/popup"],function(){return joms.popup.event.banMember})}(window,joms.jQuery,function(o){function t(t,a,u){s&&s.off(),n=t,i=a,p=u,joms.ajax({func:"events,ajaxBanMember",data:[p,i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.updateItemHTML(),t.success&&(n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()})}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.message||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i,p;return function(o,e){joms.util.popup.prepare(function(n){t(n,o,e)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.unbanMember=n(o),e("popups/event.unbanmember",["utils/popup"],function(){return joms.popup.event.unbanMember})}(window,joms.jQuery,function(o){function t(t,a,u){s&&s.off(),n=t,i=a,p=u,joms.ajax({func:"events,ajaxUnbanMember",data:[p,i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.updateItemHTML(),t.success&&(n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()})}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.message||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i,p;return function(o,e){joms.util.popup.prepare(function(n){t(n,o,e)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.event=t(o,joms.popup.event||{}),e("popups/event",["popups/event.delete","popups/event.invite","popups/event.join","popups/event.leave","popups/event.response","popups/event.addfeatured","popups/event.rejectguest","popups/event.removefeatured","popups/event.report","popups/event.banmember","popups/event.unbanmember"],function(){return joms.popup.event})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.fbc||(joms.popup.fbc={}),joms.popup.fbc.update=n(o),e("popups/fbc.update",["utils/popup"],function(){return joms.popup.fbc.update})}(window,joms.jQuery,function(o){function t(t){v&&v.off(),f=t,o.joms_use_tfa?(f.items[0]={type:"inline",src:j()},f.updateItemHTML(),(v=f.contentContainer).off("click"),v.on("click",".joms-js--button-next",function(){e(v.find("[name=secret]").val())}),v.on("click",".joms-js--button-skip",function(){e()})):e()}function e(t){v&&v.off(),joms.ajax({func:"connect,ajaxUpdate",data:[t||""],callback:function(t){var e=t.jax_token_var;e&&(t.btnNext=t.btnContinue,o.jax_token_var=t.jax_token_var),f.items[0]={type:"inline",src:d(t)},f.updateItemHTML(),v=f.contentContainer,b=t.lang,v.off("click"),v.on("click",".joms-js--button-next",e?r:n),v.on("click",".joms-js--button-back2",s),v.on("click",".joms-js--button-next2",i),v.on("click",".joms-js--button-back3",m)}})}function n(){var o,t;(h=2==+v.find("[name=membertype]:checked").val())?a():(o=v.find("#joms-js--fbc-tnc-checkbox")).length?(o=o[0],t=v.find(".joms-js--fbc-tnc-error"),o.checked?(t.hide(),p()):t.show()):p()}function s(){v.find(".joms-js--step2").hide(),v.find(".joms-js--step3").hide(),v.find(".joms-js--step1").show()}function i(){h?c():u()}function p(){joms.ajax({func:"connect,ajaxShowNewUserForm",data:[""],callback:function(o){var t;v.find(".joms-js--step1").hide(),(t=v.find(".joms-js--step2")).find(".joms-popup__content").html(o.html),t.find(".joms-js--button-back2").html(o.btnBack),t.find(".joms-js--button-next2").html(o.btnCreate),t.show()}})}function a(){joms.ajax({func:"connect,ajaxShowExistingUserForm",data:[""],callback:function(o){var t;v.find(".joms-js--step1").hide(),(t=v.find(".joms-js--step2")).find(".joms-popup__content").html(o.html),t.find(".joms-js--button-back2").html(o.btnBack),t.find(".joms-js--button-next2").html(o.btnLogin),t.show()}})}function u(){var o=v.find(".joms-js--step2"),t=o.find("[name=name]").val(),e=o.find("[name=username]").val(),n=o.find("[name=email]").val(),s=o.find("[name=profiletype]"),i="";if(s.length){if(!s.filter(":checked").length)return o.hide(),(o=v.find(".joms-js--step3")).find(".joms-popup__content").html(b.selectProfileType),o.find(".joms-js--button-back3").html(b.btnBack),void o.show();i=s.filter(":checked").val()}joms.ajax({func:"connect,ajaxCreateNewAccount",data:[t,e,n,i],callback:function(o){var t;if(o.error)return v.find(".joms-js--step2").hide(),(t=v.find(".joms-js--step3")).find(".joms-popup__content").html(o.error),t.find(".joms-js--button-back3").html(o.btnBack),void t.show();v.off(),f.close(),joms.popup.fbc.update()}})}function c(){var o=v.find(".joms-js--step2"),t=o.find("[name=username]").val(),e=o.find("[name=password]").val();joms.ajax({func:"connect,ajaxValidateLogin",data:[t,e],callback:function(o){var t;if(o.error)return v.find(".joms-js--step2").hide(),(t=v.find(".joms-js--step3")).find(".joms-popup__content").html(o.error),t.find(".joms-js--button-back3").html(o.btnBack),void t.show();v.off(),f.close(),joms.popup.fbc.update()}})}function r(){var t=v.find("[name=importstatus]"),e=v.find("[name=importavatar]");t=t.length&&t[0].checked?1:0,e=e.length&&e[0].checked?1:0,joms.ajax({func:"connect,ajaxImportData",data:[t,e],callback:function(t){var e;return v.find(".joms-js--step1").hide(),t.error?(v.off("click").on("click",".joms-js--button-next2",l),(e=v.find(".joms-js--step2")).find(".joms-popup__content").html(t.error),e.find(".joms-js--button-back2").hide(),e.find(".joms-js--button-next2").html(t.btnNext),void e.show()):t.btnUpdate?(v.off("click").on("click",".joms-js--button-back2",l),v.off("click").on("click",".joms-js--button-next2",function(){o.location=t.redirect}),(e=v.find(".joms-js--step2")).find(".joms-popup__content").html(t.html),e.find(".joms-js--button-back2").html(t.btnSkip),e.find(".joms-js--button-next2").html(t.btnUpdate),void e.show()):(l(),void(o.location=t.redirect))}})}function m(){v.find(".joms-js--step3").hide(),h?(v.find(".joms-js--step2").hide(),v.find(".joms-js--step1").show()):(v.find(".joms-js--step2").show(),v.find(".joms-js--step1").hide())}function l(){v.off(),f.close()}function d(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content ',o.btnNext?"":"joms-popup__content--single",'">',o.error||o.html||"","</div>",o.btnNext?'<div class="joms-popup__action">':"",o.btnNext?'<button class="joms-button--primary joms-button--small joms-js--button-next">'+o.btnNext+"</button>":"",o.btnNext?"</div>":"","</div>",'<div class="joms-js--step2 joms-popup__hide">','<div class="joms-popup__content"></div>','<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-back2"></button>','<button class="joms-button--primary joms-button--small joms-js--button-next2"></button>',"</div>","</div>",'<div class="joms-js--step3 joms-popup__hide">','<div class="joms-popup__content joms-popup__content--single"></div>','<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-back3"></button>',"</div>","</div>","</div>"].join("")}function j(){var t=o.joms_lang||{};return['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.COM_COMMUNITY_AUTHENTICATION_KEY||"Authentication key","</div>",'<div class="joms-popup__content">',"<span>",t.COM_COMMUNITY_AUTHENTICATION_KEY_LABEL||"Insert your two-factor authentication key","</span>",'<input type="text" class="joms-input" name="secret">',"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-skip">',t.COM_COMMUNITY_SKIP_BUTTON||"Skip","</button>",'<button class="joms-button--primary joms-button--small joms-js--button-next">',t.COM_COMMUNITY_NEXT||"Next","</button>","</div>","</div>"].join("")}var f,v,b,h;return function(){joms.util.popup.prepare(function(o){t(o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.fbc=t(o,joms.popup.fbc||{}),e("popups/fbc",["popups/fbc.update"],function(){return joms.popup.fbc})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.file||(joms.popup.file={}),joms.popup.file.download=n(o),e("popups/file.download",["utils/popup"],function(){return joms.popup.file.download})}(window,joms.jQuery,function(o){function t(t,u,c,r){s&&s.off(),n=t,i=u,p=c,a=r,joms.ajax({func:"files,ajaxFileDownload",data:[i,p],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.updateItemHTML(),t.url&&(n.close(),o.open(a))}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.message||t.error,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i,p,a;return function(o,e,n){joms.util.popup.prepare(function(s){t(s,o,e,n)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.file||(joms.popup.file={}),joms.popup.file.list=n(o,t),e("popups/file.list",["utils/loadlib","utils/popup"],function(){return joms.popup.file.list})}(window,joms.jQuery,function(o,t){function e(o,t,e){u&&u.off(),a=o,c=t,r=e,joms.ajax({func:"files,ajaxviewMore",data:[c,r],callback:function(o){a.items[0]={type:"inline",src:p(o)},a.updateItemHTML(),u=a.contentContainer,j=u.find(".joms-js--btn-loadmore"),u.on("click",".joms-js--tab-bar a",s),u.on("click",".joms-js--btn-loadmore",i),m=!1,u.find(".joms-js--tab-bar a.active").trigger("click")}})}function n(o,t){joms.ajax({func:"files,ajaxgetFileList",data:[o,r,l,4,c],callback:function(o){t(o)}})}function s(){var e=t(this),s=e.data("id");m!==s&&(m=s,d=u.find(".joms-js--tab-"+s),e.addClass("active").siblings().removeClass("active"),j.css({visibility:"hidden"}),d.empty().show().siblings(".joms-js--tab").hide(),l=0,n(m,function(t){d.html(t.html),t.next&&t.count?(l=t.next,j.css({visibility:"visible"}),j.html(o.joms_lang.COM_COMMUNITY_FILES_LOAD_MORE+" ("+t.count+")")):j.css({visibility:"hidden"})}))}function i(){n(m,function(t){d.append(t.html),d[0].scrollTop=d[0].scrollHeight,t.next&&t.count?(l=t.next,j.css({visibility:"visible"}),j.html(o.joms_lang.COM_COMMUNITY_FILES_LOAD_MORE+" ("+t.count+")")):j.css({visibility:"hidden"})})}function p(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--600">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",o.html,"</div>"].join("")}var a,u,c,r,m,l,d,j;return function(o,t){joms.util.popup.prepare(function(n){e(n,o,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.file||(joms.popup.file={}),joms.popup.file.remove=n(o,t),e("popups/file.remove",["utils/popup"],function(){return joms.popup.file.remove})}(window,joms.jQuery,function(o,t){function e(o,t){o.items[0]={type:"inline",src:s(t)},o.updateItemHTML()}function n(n,s){i=n,p=s,o.confirm(o.joms_lang.COM_COMMUNITY_FILES_DELETE_CONFIRM)&&joms.ajax({func:"files,ajaxDeleteFile",data:[i,p],callback:function(o){o.success?t(".joms-js--file-"+p).remove():joms.util.popup.prepare(function(t){e(t,o)})}})}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button> &nbsp; </div>','<div class="joms-popup__content joms-popup__content--single">',o.message||o.error,"</div>","</div>"].join("")}var i,p;return function(o,t){n(o,t)}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.file||(joms.popup.file={}),joms.popup.file.upload=n(o,t),e("popups/file.upload",["utils/loadlib","utils/popup"],function(){return joms.popup.file.upload})}(window,joms.jQuery,function(o,t){function e(t,e,i){d&&d.off(),l=t,j=e,f=i,joms.ajax({func:"files,ajaxFileUploadForm",data:[j,f],callback:function(t){l.items[0]={type:"inline",src:m(t)},l.updateItemHTML(),l.st.callbacks||(l.st.callbacks={}),l.st.callbacks.close=function(){g&&o.location.reload()},d=l.contentContainer,g=!1,_=d.find(".joms-js--upload-preview"),d.on("click",".joms-js--btn-add",n),d.on("click",".joms-js--btn-upload",a),d.on("click",".joms-js--btn-done",function(){g&&o.location.reload()}),s()}})}function n(){s(function(){h.click()})}function s(e){"function"!=typeof e&&(e=function(){}),v?e():(b=joms.BASE_URL+d.find("input[name=url]").val(),joms.util.loadLib("plupload",function(){var n;n=t('<div id="joms-js--file-uploader" aria-hidden="true" style="width:1px; height:1px; overflow:hidden">').appendTo(document.body),t('<button id="joms-js--file-uploader-button">').appendTo(n),(v=new o.plupload.Uploader({url:b,container:"joms-js--file-uploader",browse_button:"joms-js--file-uploader-button",runtimes:"html5,html4",filters:[{title:"Document files",extensions:d.find("input[name=filetype]").val()}],max_file_size:d.find("input[name=maxfilesize]").val()+"mb"})).bind("FilesAdded",i),v.bind("Error",p),v.bind("UploadProgress",u),v.bind("FileUploaded",c),v.bind("uploadComplete",r),v.init(),h=n.find("input[type=file]"),e()}))}function i(o,t){var e,n="";for(e=0;e<t.length;e++)n+='<div class="joms-file--'+t[e].id+'" style="margin-bottom:5px">',n+="<div><strong>"+t[e].name+"</strong> <span>("+Math.round(t[e].size/1024)+" KB)</span></div>",n+='<div class="joms-progressbar"><div class="joms-progressbar__progress" style="width:0%"></div></div>',n+="</div>";_.find(".joms-js--upload-placeholder").remove(),_.append(n),d.find(".joms-js--btn-add").html(d.find(".joms-js--btn-add").data("lang-more")).css({visibility:"visible"}),d.find(".joms-js--btn-upload").show(),d.find(".joms-js--btn-done").hide()}function p(t,e){_.find(".joms-file--"+e.file.id).remove(),o.alert(e.message+" ("+e.code+")")}function a(){d.find(".joms-js--btn-add").css({visibility:"hidden"}),d.find(".joms-js--btn-upload").hide(),d.find(".joms-js--btn-done").hide(),v.settings.url=b+"&type="+j+"&id="+f,v.refresh(),v.start()}function u(o,t){var e;e=Math.min(100,Math.floor(t.loaded/t.size*100)),d.find(".joms-file--"+t.id).find(".joms-progressbar__progress").stop().animate({width:e+"%"})}function c(t,e,n){var s={};try{s=JSON.parse(n.response)}catch(o){}if(s.error)return v.stop(),d.find(".joms-js--btn-add").css({visibility:"hidden"}),d.find(".joms-js--btn-upload").hide(),d.find(".joms-js--btn-done").show(),d.find(".joms-file--"+e.id).nextAll().andSelf().remove(),void o.alert(s.msg);s.msg?d.find(".joms-file--"+e.id).css({color:"#F00"}):s.id&&(g=!0)}function r(){d.find(".joms-js--btn-add").css({visibility:"visible"}),d.find(".joms-js--btn-upload").hide(),d.find(".joms-js--btn-done").show()}function m(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",o.html,"</div>"].join("")}var l,d,j,f,v,b,h,_,g;return function(o,t){joms.util.popup.prepare(function(n){e(n,o,t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.file||(joms.popup.file={}),joms.popup.file.updateHit=t(o),e("popups/file.updatehit",["utils/popup"],function(){return joms.popup.file.updateHit})}(window,function(o){return function(t,e){joms.ajax({func:"files,ajaxUpdateHit",data:[t],callback:function(){}}),"string"==typeof e&&o.open(e)}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.file=t(o,joms.popup.file||{}),e("popups/file",["popups/file.download","popups/file.list","popups/file.remove","popups/file.upload","popups/file.updatehit"],function(){return joms.popup.file})}(window,function(o,t){return joms._.extend({},t)}),function(o,t){joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.add=t(),e("popups/friend.add",["utils/popup"],function(){return joms.popup.friend.add})}(window,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"friends,ajaxConnect",data:[p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click","[data-ui-object=popup-button-cancel]",t),i.on("click","[data-ui-object=popup-button-save]",e)}})}function t(){i.off(),s.close()}function e(){var o=i.find("textarea").val().replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/&quot;/g,'"');joms.ajax({func:"friends,ajaxSaveFriend",data:[[["msg",o],["userid",p]]],callback:function(o){var t=i.find("[data-ui-object=popup-step-1]"),e=i.find("[data-ui-object=popup-step-2]");o.error||(s.st.callbacks||(s.st.callbacks={}),s.st.callbacks.close=function(){window.location.reload()}),e.find("[data-ui-object=popup-message]").html(o.error||o.message),t.hide(),e.show()}})}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div data-ui-object="popup-step-1"',o.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">','<div class="joms-stream__header" style="padding:0">','<div class="joms-avatar--stream"><img src="',o.avatar,'"></div>','<div class="joms-stream__meta"><span>',o.desc,"</span></div>","</div>","</div>",'<div class="joms-popup__content">','<textarea class="joms-textarea" style="margin:0">',o.message,"</textarea>","</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnAdd,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',o.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',o.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',window.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.addCancel=t(),e("popups/friend.addcancel",["utils/popup"],function(){return joms.popup.friend.addCancel})}(window,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"friends,ajaxCancelRequest",data:[p,window.location.href],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(){i.find("form")[0].submit()}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.approve=n(o,t),e("popups/friend.approve",["utils/popup","functions/notification"],function(){return joms.popup.friend.approve})}(window,joms.jQuery,function(o,t){function e(o){i=o,joms.ajax({func:"friends,ajaxApproveRequest",data:[i],callback:function(o){o.success?n(o):joms.util.popup.prepare(function(t){t.items[0]={type:"inline",src:s(o)},t.updateItemHTML()})}})}function n(o){t(".joms-js--frequest-msg-"+i).html(o.message),t(".joms-js--frequest-btn-"+i).remove(),joms.fn.notification.updateCounter("frequest",i,-1)}function s(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.error||t.message,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var i;return function(o){e(o)}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.reject=n(o,t),e("popups/friend.reject",["utils/popup","functions/notification"],function(){return joms.popup.friend.reject})}(window,joms.jQuery,function(o,t){function e(o){i=o,joms.ajax({func:"friends,ajaxRejectRequest",data:[i],callback:function(o){o.success?n(o):joms.util.popup.prepare(function(t){t.items[0]={type:"inline",src:s(o)},t.updateItemHTML()})}})}function n(o){t(".joms-js--frequest-msg-"+i).html(o.message),t(".joms-js--frequest-btn-"+i).remove(),joms.fn.notification.updateCounter("frequest",i,-1)}function s(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.error||t.message,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var i;return function(o){e(o)}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.remove=n(o,t),e("popups/friend.remove",["utils/popup"],function(){return joms.popup.friend.remove})}(window,joms.jQuery,function(o,t){function e(t,e){a&&a.off(),p=t,u=e,joms.ajax({func:"friends,ajaxConfirmFriendRemoval",data:[u],callback:function(t){p.items[0]={type:"inline",src:i(t)},p.st.callbacks||(p.st.callbacks={}),p.st.callbacks.close=function(){o.location.reload()},p.updateItemHTML(),(a=p.contentContainer).on("click","[data-ui-object=popup-button-cancel]",n),a.on("click","[data-ui-object=popup-button-save]",s)}})}function n(){a.off(),p.close()}function s(){var o;o=a.find("input[type=checkbox]")[0].checked?"friends,ajaxBlockFriend":"friends,ajaxRemoveFriend",joms.ajax({func:o,data:[u],callback:function(o){var e=a.find("[data-ui-object=popup-step-1]"),n=a.find("[data-ui-object=popup-step-2]");n.find("[data-ui-object=popup-message]").html(o.error||o.message),e.hide(),n.show(),o&&o.success&&t("#friend-"+u).remove()}})}function i(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div data-ui-object="popup-step-1"',o.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',o.html||"","</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnYes,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',o.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',o.error||"","</div>","</div>","</div>"].join("")}var p,a,u;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.response=t(),e("popups/friend.response",["utils/popup","functions/notification"],function(){return joms.popup.friend.response})}(window,function(){function o(o,n){p&&p.off(),i=o,a=n,joms.ajax({func:"friends,ajaxConnect",data:[a],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),u=o.connection_id,(p=i.contentContainer).on("click",".joms-js--button-cancel",t),p.on("click",".joms-js--button-save",e)}})}function t(){joms.ajax({func:"friends,ajaxRejectRequest",data:[u],callback:function(o){n(o)}})}function e(){joms.ajax({func:"friends,ajaxApproveRequest",data:[u],callback:function(o){n(o)}})}function n(o){var t=p.find(".joms-js--step1"),e=p.find(".joms-js--step2");o.error||(i.st.callbacks||(i.st.callbacks={}),i.st.callbacks.close=function(){window.location.reload()}),e.find(".joms-popup__content").html(o.error||o.message),t.hide(),e.show()}function s(o){var t=!1;return o||(o={}),o.error&&!o.desc&&(t=o.error),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',t?" joms-popup__hide":"",'">','<div class="joms-popup__content">','<div class="joms-stream__header" style="padding:0">','<div class="joms-avatar--stream"><img src="',o.avatar,'"></div>','<div class="joms-stream__meta"><span>',o.desc,"</span></div>","</div>","</div>",'<div class="joms-popup__content">','<div class="cStream-Quote">',o.message,"</div>","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnReject,"</button>",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnAccept,"</button>","</div>","</div>",'<div class="joms-js--step2',t?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',t||"","</div>","</div>","</div>"].join("")}var i,p,a,u;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.friend=t(o,joms.popup.friend||{}),e("popups/friend",["popups/friend.add","popups/friend.addcancel","popups/friend.approve","popups/friend.reject","popups/friend.remove","popups/friend.response"],function(){return joms.popup.friend})}(window,function(o,t){return joms._.extend({},t)}),function(o,t){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.delete=t(),e("popups/group.delete",["utils/popup"],function(){return joms.popup.group.delete})}(window,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"groups,ajaxWarnGroupDeletion",data:[p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(o,t){joms.ajax({func:"groups,ajaxDeleteGroup",data:[p,t||1],callback:function(o){var t;i.find(".joms-js--step1").hide(),i.find(".joms-js--step2").show().children().first().append("<div>"+(o.error||o.message)+"</div>"),o.next?e(null,o.next):o.redirect&&((t=i.find(".joms-js--step2")).find(".joms-js--button-done").html(o.btnDone).on("click",function(){window.location=o.redirect}),t.find(".joms-popup__action").show(),t.find(".joms-popup__content").removeClass("joms-popup__content--single"))}})}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnDelete,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>",'<div class="joms-popup__action joms-popup__hide">','<button class="joms-button--primary joms-js--button-done"></button>',"</div>","</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.invite=n(o,t),e("popups/group.invite",["utils/popup"],function(){return joms.popup.group.invite})}(window,joms.jQuery,function(o,t){function e(o,t){l&&l.off(),m=o,b=t,g=200,joms.ajax({func:"system,ajaxShowInvitationForm",data:[null,"",b,1,1],callback:function(o){m.items[0]={type:"inline",src:r(o)},m.updateItemHTML(),o.limit&&(g=+o.limit),l=m.contentContainer,d=l.find(".joms-tab__content").eq(0),j=l.find(".joms-tab__content").eq(1),f=l.find("[data-btn-select]"),v=l.find("[data-btn-load]"),l.on("keyup","[data-search]",n),l.on("click",".joms-tab__bar a",i),l.on("click","[data-btn-select]",p),l.on("click","[data-btn-load]",a),l.on("click","[data-btn-save]",s),l.on("click","input[type=checkbox]",u),c("")}})}function n(o){c(t(o.currentTarget).val())}function s(){var o,t=j.find("input[type=checkbox]"),e=[],n=l.find("input[name=emails]").val()||"",s=l.find("[name=message]").val()||"",i=/^\s+|\s+$/g;t.each(function(){e.push(this.value)}),o=[["friendsearch",""],["emails",n=n.replace(i,"")],["message",s=s.replace(i,"")],["friends",e.join(",")]],joms.ajax({func:"system,ajaxSubmitInvitation",data:["groups,inviteUsers",b,o],callback:function(){l.off(),m.close()}})}function i(e){var n="#joms-popup-tab-selected"===t(e.target).attr("href"),s=o.joms_lang[n?"COM_COMMUNITY_UNSELECT_ALL":"COM_COMMUNITY_SELECT_ALL"];f.html(s)}function p(){var o,e=t(".joms-tab__content:visible");if("joms-popup-tab-selected"===e.attr("id"))return e.find(".joms-js--friend").remove(),void l.find("input[type=checkbox]").each(function(){this.checked=!1});(o=e.find(".joms-js--friend").clone()).find("input[type=checkbox]").add(e.find("input[type=checkbox]")).prop("checked","checked"),(e=l.find("#joms-popup-tab-selected")).html(o)}function a(){c()}function u(o){var e,n,s=t(o.target),i=s.closest(".joms-tab__content");return"joms-popup-tab-selected"===i.attr("id")?(e=s[0].value,s.closest(".joms-js--friend").remove(),void(l.find(".joms-js--friend-"+e+" input[type=checkbox]")[0].checked=!1)):s[0].checked?(i=l.find("#joms-popup-tab-selected"),(s=(n=s.closest(".joms-js--friend").clone()).find("input[type=checkbox]"))[0].checked=!0,void i.append(n)):(e=s[0].value,void l.find("#joms-popup-tab-selected .joms-js--friend-"+e).remove())}function c(e){var n="string"==typeof e;n?(d.empty(),_=0,h=e):_+=g,w&&w.abort(),w=joms.ajax({func:"system,ajaxLoadFriendsList",data:[h,"groups,inviteUsers",b,_,g],callback:function(e){var s;e.html&&((s=t(t.trim(e.html))).each(function(){var o=t(this).find(":checkbox"),e=o.val();j.find(":checkbox[value="+e+"]").length&&(o[0].checked=!0)}),d.append(s)),n||(d[0].scrollTop=d[0].scrollHeight),e.loadMore?(f.css({width:"49%",marginRight:"2%"}),v.css({width:"49%"}).html(o.joms_lang.COM_COMMUNITY_INVITE_LOAD_MORE+" ("+e.moreCount+")").show()):(v.hide(),f.css({width:"100%",marginRight:"0"}))}})}function r(o){return['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div data-ui-object="popup-step-1"',o.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--primary" data-btn-save="1">',o.btnInvite,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',o.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',o.error||"","</div>","</div>","</div>"].join("")}var m,l,d,j,f,v,b,h,_,g,w;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.join=n(o),e("popups/group.join",["utils/popup"],function(){return joms.popup.group.join})}(window,joms.jQuery,function(o){function t(t,i){n&&n.off(),e=t,s=i,joms.ajax({func:"groups,ajaxJoinGroup",data:[s],callback:function(){o.location.reload()}})}var e,n,s;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.leave=n(),e("popups/group.leave",["utils/popup"],function(){return joms.popup.group.leave})}(window,joms.jQuery,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"groups,ajaxShowLeaveGroup",data:[p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(){i.find("form")[0].submit()}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.addFeatured=n(o),e("popups/group.addfeatured",["utils/popup"],function(){return joms.popup.group.addFeatured})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p,joms.ajax({func:"groups,ajaxAddFeatured",data:[i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()},n.updateItemHTML()}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.removeFeatured=n(o),e("popups/group.removefeatured",["utils/popup"],function(){return joms.popup.group.removeFeatured})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p,joms.ajax({func:"groups,ajaxRemoveFeatured",data:[i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()},n.updateItemHTML()}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.report=t(),e("popups/group.report",["utils/popup"],function(){return joms.popup.group.report})}(window,function(){function o(o,u){p&&p.off(),i=o,a=u,joms.ajax({func:"system,ajaxReport",data:[],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("change","select",t),p.on("click",".joms-js--button-cancel",e),p.on("click",".joms-js--button-save",n)}})}function t(o){p.find("textarea").val(o.target.value)}function e(){p.off(),i.close()}function n(){var o,t=/^\s+|\s+$/g;(o=(o=p.find("textarea").val()).replace(t,""))?(p.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["groups,reportGroup",window.location.href,o,a],callback:function(o){p.find(".joms-js--step1").hide(),p.find(".joms-js--step2").show().children().html(o.error||o.message)}})):p.find(".joms-js--error").show()}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">',o.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var i,p,a;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.unpublish=t(),e("popups/group.unpublish",["utils/popup"],function(){return joms.popup.group.unpublish})}(window,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"groups,ajaxShowUnpublishGroup",data:[p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(){i.find("form")[0].submit()}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.approve=n(o,t),e("popups/group.approve",["functions/notification"],function(){return joms.popup.group.approve})}(window,joms.jQuery,function(o,t){function e(o,e){n=o,s=e,joms.ajax({func:"groups,ajaxApproveMember",data:[s,n],callback:function(o){o&&(t(".joms-js--request-buttons-group-"+n+"-"+s).remove(),t(".joms-js--request-notice-group-"+n+"-"+s).html(o.message||o.error),o.success&&joms.fn.notification.updateCounter("general",n,-1))}})}var n,s;return function(o,t){e(o,t)}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.removeMember=n(o,t),e("popups/group.removemember",["utils/popup","functions/notification"],function(){return joms.popup.group.removeMember})}(window,joms.jQuery,function(o,t){function e(o,t,e){a&&a.off(),p=o,u=t,c=e,joms.ajax({func:"groups,ajaxConfirmMemberRemoval",data:[c,u],callback:function(o){p.items[0]={type:"inline",src:i(o)},p.updateItemHTML(),(a=p.contentContainer).on("click",".joms-js--button-cancel",n),a.on("click",".joms-js--button-save",s)}})}function n(){a.off(),p.close()}function s(){var o=a.find("input:checkbox")[0].checked?"groups,ajaxBanMember":"groups,ajaxRemoveMember",e=[c,u];joms.ajax({func:o,data:e,callback:function(o){a.find(".joms-js--step1").hide(),a.find(".joms-js--step2").show().children().append(o.error||o.message),o.success&&(t(".joms-js--member-group-"+u+"-"+c).remove(),t(".joms-js--request-buttons-group-"+u+"-"+c).remove(),t(".joms-js--request-notice-group-"+u+"-"+c).html(o&&o.message||""),joms.fn.notification.updateCounter("general",u,-1))}})}function i(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var p,a,u,c;return function(o,t){joms.util.popup.prepare(function(n){e(n,o,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.banMember=n(o),e("popups/group.banmember",["utils/popup"],function(){return joms.popup.group.banMember})}(window,joms.jQuery,function(o){function t(t,a,u){s&&s.off(),n=t,i=a,p=u,joms.ajax({func:"groups,ajaxBanMember",data:[p,i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.updateItemHTML(),t.success&&(n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()})}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.message||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i,p;return function(o,e){joms.util.popup.prepare(function(n){t(n,o,e)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.unbanMember=n(o),e("popups/group.unbanmember",["utils/popup"],function(){return joms.popup.group.unbanMember})}(window,joms.jQuery,function(o){function t(t,a,u){s&&s.off(),n=t,i=a,p=u,joms.ajax({func:"groups,ajaxUnbanMember",data:[p,i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.updateItemHTML(),t.success&&(n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()})}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.message||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i,p;return function(o,e){joms.util.popup.prepare(function(n){t(n,o,e)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.group=t(o,joms.popup.group||{}),e("popups/group",["popups/group.delete","popups/group.invite","popups/group.join","popups/group.leave","popups/group.addfeatured","popups/group.removefeatured","popups/group.report","popups/group.unpublish","popups/group.approve","popups/group.removemember","popups/group.banmember","popups/group.unbanmember"],function(){return joms.popup.group})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.inbox||(joms.popup.inbox={}),joms.popup.inbox.addRecipient=n(o,t),e("popups/inbox.addrecipient",["utils/popup"],function(){return joms.popup.inbox.addRecipient})}(window,joms.jQuery,function(o,t){function e(o,t){l&&l.off(),m=o,b=t,g=200,joms.ajax({func:"system,ajaxShowFriendsForm",data:[null,"",b,1,1],callback:function(o){m.items[0]={type:"inline",src:r(o)},m.updateItemHTML(),o.limit&&(g=+o.limit),l=m.contentContainer,d=l.find(".joms-tab__content").eq(0),j=l.find(".joms-tab__content").eq(1),f=l.find("[data-btn-select]"),v=l.find("[data-btn-load]"),l.on("keyup","[data-search]",n),l.on("click",".joms-tab__bar a",i),l.on("click","[data-btn-select]",p),l.on("click","[data-btn-load]",a),l.on("click","[data-btn-save]",s),l.on("click","input[type=checkbox]",u),c("")}})}function n(o){c(t(o.currentTarget).val())}function s(){var o=t("#joms-js--compose-to");j.find(".joms-js--friend").each(function(){var e=t(this),n=e.find(":checkbox").val();o.find(".joms-js--friend-"+n).length||o.append(e.clone())}),l.off(),m.close(),o.show()}function i(e){var n="#joms-popup-tab-selected"===t(e.target).attr("href"),s=o.joms_lang[n?"COM_COMMUNITY_UNSELECT_ALL":"COM_COMMUNITY_SELECT_ALL"];f.html(s)}function p(){var o,e=t(".joms-tab__content:visible");if("joms-popup-tab-selected"===e.attr("id"))return e.find(".joms-js--friend").remove(),void l.find("input[type=checkbox]").each(function(){this.checked=!1});(o=e.find(".joms-js--friend").clone()).find("input[type=checkbox]").add(e.find("input[type=checkbox]")).prop("checked","checked"),(e=l.find("#joms-popup-tab-selected")).html(o)}function a(){c()}function u(o){var e,n,s=t(o.target),i=s.closest(".joms-tab__content");return"joms-popup-tab-selected"===i.attr("id")?(e=s[0].value,s.closest(".joms-js--friend").remove(),void(l.find(".joms-js--friend-"+e+" input[type=checkbox]")[0].checked=!1)):s[0].checked?(i=l.find("#joms-popup-tab-selected"),(s=(n=s.closest(".joms-js--friend").clone()).find("input[type=checkbox]"))[0].checked=!0,void i.append(n)):(e=s[0].value,void l.find("#joms-popup-tab-selected .joms-js--friend-"+e).remove())}function c(e){var n="string"==typeof e;n?(d.empty(),_=0,h=e):_+=g,w&&w.abort(),w=joms.ajax({func:"system,ajaxLoadFriendsList",data:[h,"friends,inviteUsers",b,_,g],callback:function(e){var s;e.html&&((s=t(t.trim(e.html))).each(function(){var o=t(this).find(":checkbox"),e=o.val();j.find(":checkbox[value="+e+"]").length&&(o[0].checked=!0)}),d.append(s)),n||(d[0].scrollTop=d[0].scrollHeight),e.loadMore?(f.css({width:"49%",marginRight:"2%"}),v.css({width:"49%"}).html(o.joms_lang.COM_COMMUNITY_INVITE_LOAD_MORE+" ("+e.moreCount+")").show()):(v.hide(),f.css({width:"100%",marginRight:"0"}))}})}function r(o){return['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div data-ui-object="popup-step-1"',o.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--primary" data-btn-save="1">',o.btnSelect,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',o.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',o.error||"","</div>","</div>","</div>"].join("")}var m,l,d,j,f,v,b,h,_,g,w;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.chat||(joms.popup.chat={}),joms.popup.chat.addRecipient=n(o,t),e("popups/chat.addrecipient",["utils/popup"],function(){return joms.popup.chat.addRecipient})}(window,joms.jQuery,function(o,t){function e(o,t){l&&l.off(),m=o,b=t,g=200,joms.ajax({func:"system,ajaxShowFriendsForm",data:[null,"",b,1,1],callback:function(o){m.items[0]={type:"inline",src:r(o)},m.updateItemHTML(),o.limit&&(g=+o.limit),l=m.contentContainer,d=l.find(".joms-tab__content").eq(0),j=l.find(".joms-tab__content").eq(1),f=l.find("[data-btn-select]"),v=l.find("[data-btn-load]"),l.on("keyup","[data-search]",n),l.on("click",".joms-tab__bar a",i),l.on("click","[data-btn-select]",p),l.on("click","[data-btn-load]",a),l.on("click","[data-btn-save]",s),l.on("click","input[type=checkbox]",u),c("")}})}function n(o){c(t(o.currentTarget).val())}function s(){var o={};j.find(".joms-js--friend").each(function(){var e=t(this),n=e.find(":checkbox").val(),s={id:+n,name:e.find(".joms-avatar--comment a img").attr("alt"),avatar:e.find(".joms-avatar--comment a img").attr("src")};o[n]=s}),joms_observer.do_action("chat_add_people",o),l.off(),m.close()}function i(e){var n="#joms-popup-tab-selected"===t(e.target).attr("href"),s=o.joms_lang[n?"COM_COMMUNITY_UNSELECT_ALL":"COM_COMMUNITY_SELECT_ALL"];f.html(s)}function p(){var o,e=t(".joms-tab__content:visible");if("joms-popup-tab-selected"===e.attr("id"))return e.find(".joms-js--friend").remove(),void l.find("input[type=checkbox]").each(function(){this.checked=!1});(o=e.find(".joms-js--friend").clone()).find("input[type=checkbox]").add(e.find("input[type=checkbox]")).prop("checked","checked"),(e=l.find("#joms-popup-tab-selected")).html(o)}function a(){c()}function u(o){var e,n,s=t(o.target),i=s.closest(".joms-tab__content");return"joms-popup-tab-selected"===i.attr("id")?(e=s[0].value,s.closest(".joms-js--friend").remove(),void(l.find(".joms-js--friend-"+e+" input[type=checkbox]")[0].checked=!1)):s[0].checked?(i=l.find("#joms-popup-tab-selected"),(s=(n=s.closest(".joms-js--friend").clone()).find("input[type=checkbox]"))[0].checked=!0,void i.append(n)):(e=s[0].value,void l.find("#joms-popup-tab-selected .joms-js--friend-"+e).remove())}function c(e){var n="string"==typeof e;n?(d.empty(),_=0,h=e):_+=g,w&&w.abort(),w=joms.ajax({func:"system,ajaxLoadFriendsList",data:[h,"friends,inviteUsers",b,_,g],callback:function(e){var s;e.html&&((s=t(t.trim(e.html))).each(function(){var o=t(this).find(":checkbox"),e=o.val();j.find(":checkbox[value="+e+"]").length&&(o[0].checked=!0)}),d.append(s)),n||(d[0].scrollTop=d[0].scrollHeight),e.loadMore?(f.css({width:"49%",marginRight:"2%"}),v.css({width:"49%"}).html(o.joms_lang.COM_COMMUNITY_INVITE_LOAD_MORE+" ("+e.moreCount+")").show()):(v.hide(),f.css({width:"100%",marginRight:"0"}))}})}function r(o){return['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div data-ui-object="popup-step-1"',o.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--primary" data-btn-save="1">',o.btnSelect,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',o.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',o.error||"","</div>","</div>","</div>"].join("")}var m,l,d,j,f,v,b,h,_,g,w;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.inbox||(joms.popup.inbox={}),joms.popup.inbox.remove=n(o,t),e("popups/inbox.remove",["utils/popup"],function(){return joms.popup.inbox.remove})}(window,joms.jQuery,function(o,t){function e(o,t,e){var r;a&&a.off(),p=o,r=[u=t],(c=e).length||r.push("empty"),joms.ajax({func:"inbox,ajaxDeleteMessages",data:r,callback:function(o){p.items[0]={type:"inline",src:i(o)},p.updateItemHTML(),(a=p.contentContainer).on("click",".joms-js--button-cancel",n),a.on("click",".joms-js--button-save",s)}})}function n(){a.off(),p.close()}function s(){joms.ajax({func:"inbox"===u?"inbox,ajaxRemoveFullMessages":"inbox,ajaxRemoveSentMessages",data:[c.join(",")],callback:function(o){var e;if(a.find(".joms-js--step1").hide(),a.find(".joms-js--step2").show().children().html(o.error||o.message),o.success){for(t(".joms-js--message-checkall")[0].checked=!1,e=0;e<c.length;e++)t(".joms-js--message-item-"+c[e]).remove();t(".joms-js--message-item").length||t(".joms-js--message-ct").remove()}}})}function i(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1 ',o.error?"joms-popup__hide":"",'">','<div class="joms-popup__content">',o.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2 ',o.error?"":"joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var p,a,u,c;return function(o,t){joms.util.popup.prepare(function(n){e(n,o,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.inbox||(joms.popup.inbox={}),joms.popup.inbox.setRead=n(o),e("popups/inbox.setread",["utils/popup"],function(){return joms.popup.inbox.setRead})}(window,joms.jQuery,function(o){function t(t,n){var s;if(t.length)for(s=0;s<t.length;s++)o.jax.call("community","inbox,ajaxMarkMessageAsRead",t[s]);else joms.util.popup.prepare(function(o){o.items[0]={type:"inline",src:e({error:n})},o.updateItemHTML()})}function e(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title||"","</div>",'<div class="joms-js--step1 ',o.error?"joms-popup__hide":"",'">','<div class="joms-popup__content">',o.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2 ',o.error?"":"joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}return function(o,e){t(o,e)}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.inbox||(joms.popup.inbox={}),joms.popup.inbox.setUnread=n(o),e("popups/inbox.setunread",["utils/popup"],function(){return joms.popup.inbox.setUnread})}(window,joms.jQuery,function(o){function t(t,n){var s;if(t.length)for(s=0;s<t.length;s++)o.jax.call("community","inbox,ajaxMarkMessageAsUnread",t[s]);else joms.util.popup.prepare(function(o){o.items[0]={type:"inline",src:e({error:n})},o.updateItemHTML()})}function e(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title||"","</div>",'<div class="joms-js--step1 ',o.error?"joms-popup__hide":"",'">','<div class="joms-popup__content">',o.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2 ',o.error?"":"joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}return function(o,e){t(o,e)}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.inbox=t(o,joms.popup.inbox||{}),e("popups/inbox",["popups/inbox.addrecipient","popups/chat.addrecipient","popups/inbox.remove","popups/inbox.setread","popups/inbox.setunread"],function(){return joms.popup.inbox})}(window,function(o,t){return joms._.extend({},t)}),function(o,t){joms.popup||(joms.popup={}),joms.popup.location||(joms.popup.location={}),joms.popup.location.view=t(o),e("popups/location.view",["utils/popup"],function(){return joms.popup.location.view})}(window,function(o){function t(o,t){s&&s.off(),n=o,i=t,joms.ajax({func:"activities,ajaxShowMap",data:[i],callback:function(o){n.items[0]={type:"inline",src:e(o)},n.updateItemHTML(),s=n.contentContainer}})}function e(t){var e,n;return t||(t={}),e=t.latitude+","+t.longitude,t.location,n="https://maps.googleapis.com/maps/api/staticmap?center="+e+"&markers=color:red%7Clabel:S%7C"+e+"&zoom=14&size=600x350&maptype=roadmap",o.joms_gmap_key&&(n+="&key="+o.joms_gmap_key),['<div class="joms-popup joms-popup--location-view">',"<div",t.error?' class="joms-popup__hide"':"",">",'<a href="//www.google.com/maps/@',e,',19z" target="_blank">','<img src="',n,'">',"</a>","</div>","<div",t.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single">',t.error,"</div>","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.location=t(o,joms.popup.location||{}),e("popups/location",["popups/location.view"],function(){return joms.popup.location})}(window,function(o,t){return joms._.extend({},t)}),function(o,t){joms.popup||(joms.popup={}),joms.popup.notification||(joms.popup.notification={}),joms.popup.notification.global=t(),e("popups/notification.global",["utils/popup"],function(){return joms.popup.notification.global})}(window,function(){function o(o){joms.ajax({func:"notification,ajaxGetNotification",data:[""],callback:function(e){o.items[0]={type:"inline",src:t(e)},o.updateItemHTML()}})}function t(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title">',o.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single" style="max-height:400px;overflow:auto">','<ul style="margin: 0; list-style: none;">',o.html||"","</ul>","</div>","</div>"].join("")}return function(){joms.util.popup.prepare(function(t){o(t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.notification||(joms.popup.notification={}),joms.popup.notification.friend=t(),e("popups/notification.friend",["utils/popup"],function(){return joms.popup.notification.friend})}(window,function(){function o(o){joms.ajax({func:"notification,ajaxGetRequest",data:[""],callback:function(e){o.items[0]={type:"inline",src:t(e)},o.updateItemHTML()}})}function t(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title">',o.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single" style="max-height:400px;overflow:auto">','<ul style="margin: 0; list-style: none;">',o.html||"","</ul>","</div>","</div>"].join("")}return function(){joms.util.popup.prepare(function(t){o(t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.notification||(joms.popup.notification={}),joms.popup.notification.chat=n(o,t),e("popups/notification.chat",["utils/popup"],function(){return joms.popup.notification.chat})}(window,joms.jQuery,function(o,t){function e(e,s){var i=t(s).next(".joms-popover--toolbar-chat"),p={};p.title=o.joms_lang&&joms_lang.COM_COMMUNITY_MESSAGE||"Message",p.html=i.html(),e.items[0]={type:"inline",src:n(p)},e.updateItemHTML()}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title">',o.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single" style="max-height:400px;overflow:auto">','<ul style="margin: 0; list-style: none;">',o.html||"","</ul>","</div>","</div>"].join("")}return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.notification=t(o,joms.popup.notification||{}),e("popups/notification",["popups/notification.global","popups/notification.friend","popups/notification.chat"],function(){return joms.popup.notification})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,e){joms.util||(joms.util={}),joms.util.phototag=e(o,t)}(window,joms.jQuery,function(o,t,e){function n(e){var n,s,i,p;d||(d=o.joms_friends||[]),n=t(e?e.currentTarget:m.find("input")),s=n.val().replace(/^\s+|\s+$/g,"").toLowerCase(),i=d,i=(i=joms._.filter(d,function(o){return!!o&&(!!o.name&&(!(f&&f.indexOf(o.id+"")>=0)&&!(s&&o.name.toLowerCase().indexOf(s)<0)))})).slice(0,8),(i=joms._.map(i,function(o){return'<a href="javascript:" data-id="'+o.id+'">'+o.name+"</a>"})).length?b=!1:(i=["<span><em>"+o.joms_lang.COM_COMMUNITY_NO_RESULT_FOUND+"</em></span>"],b=!0),(p=m.find(".joms-phototag__autocomplete")).html(i.join("")),p.append('<div><button class="joms-button--neutral joms-button--small joms-button--full">'+o.joms_lang.COM_COMMUNITY_PHOTO_DONE_TAGGING+"</button></div>"),p.show()}function s(o){var e,s=m.find(".joms-phototag__autocomplete"),i=t(o.currentTarget).data("id")||"";o.stopPropagation(),s.hide(),j&&j.tagAdded&&(f||(f=[]),f.push(i+""),e=a(),j.tagAdded(i,e.left,e.top,e.width,e.height),n())}function i(){t(".joms-phototag__tags").show(),m&&(m.remove(),r.remove(),t(o).off("resize.phototag"),m=e,l=e,j&&j.destroy&&j.destroy(),j=e)}function p(o){var t,e,n,s=l.height(),i=l.width();return v?(n=o.clientY-45-o.target.offsetTop-43,e=o.clientX-45-o.target.offsetLeft-43):(t=l.offset(),n=o.pageY-t.top-43,e=o.pageX-t.left-43),n=Math.max(0,Math.min(n,s-86)),e=Math.max(0,Math.min(e,i-86)),{top:n,left:e}}function a(){var o,t,e,n,s,i,p;return t=r.width(),e=r.height(),o=m.position(),n=m.width(),s=m.height(),i=o.left,p=o.top,n/=t,s/=e,i/=t,p/=e,{top:p,left:i,width:n,height:s}}function u(o){var t;b?i():(t=p(o),m.css({top:t.top,left:t.left}))}function c(){return["<div class=joms-phototag__wrapper>","<div class=joms-phototag>","<div class=joms-phototag__input>",'<input type=text placeholder="',o.joms_lang.COM_COMMUNITY_SEARCH,'">','<div class="joms-phototag__autocomplete"></div>',"</div>","</div>","</div>"].join("")}var r,m,l,d,j,f,v,b;return{populate:function(o,e){var n,s,i,p,a,u,c,r,m,d,j;if(t(".joms-phototag__tags").remove(),e&&e.length)for((p=(l=t(o)).position()).top,p.left,a=l.width(),d=l.height(),(n=t("<div class="+".joms-phototag__tags".substr(1)+"></div>")).css({top:0,left:0,right:0,bottom:0,margin:"auto",width:a,height:d}),n.insertAfter(l),j=0;j<e.length;j++)i=e[j],u=Math.round(d*i.top),c=Math.round(a*i.left),r=Math.round(a*i.width),m=Math.round(d*i.height),m=r=Math.max(10,Math.min(r,m)),(s=t("<div class="+".joms-phototag__tag".substr(1)+"><span>"+i.displayName+"</span></div>")).css({top:u+"px",left:c+"px",width:r+"px",height:m+"px"}),s.appendTo(n)},create:function(a,b,h,_,g){var w,k,y,x,C,T,M;i(),t(".joms-phototag__tags").hide(),r=t(c()),m=r.find(".joms-phototag"),l=t(a.target),d=e,j={},T=l.width(),M=l.height(),w=l.offset(),k=l.parent().offset(),x=w.top-k.top,C=w.left-k.left,f=b||[],v="page"!==h,m.css({top:0,left:0}),r.css({top:x,left:C,width:T,height:M}),r.insertAfter(l),y=p(a),m.css({top:y.top,left:y.left}),m.on("keyup","input",n),m.on("click","a[data-id]",s),m.on("click","button",i),m.on("click",function(o){o.stopPropagation()}),r.on("click",u),+_?joms.fn.tagging.fetchGroupMembers(_,function(o){d=o,n()}):+g?joms.fn.tagging.fetchEventMembers(g,function(o){d=o,n()}):n(),joms.mobile||t(o).on("resize.phototag",i)},destroy:i,on:function(o,t){j[o]=t},off:function(o){o?j[o]&&(j[o]=e):j={}}}}),e("utils/phototag",function(){}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.open=n(o,t),e("popups/photo.open",["utils/popup","utils/phototag"],function(){return joms.popup.photo.open})}(window,joms.jQuery,function(o,t){function e(o,e,n){z&&z.off(),q=o,oo=e,to=n,joms.ajax({func:"photos,ajaxGetPhotosByAlbum",data:[oo,to],callback:function(o){o||(o={}),so=o.lang||{},io=o.can_edit||!1,po=o.can_delete||!1,ao=o.can_tag||!1,uo=o.can_move_photo||!1,co=o.can_rotate||!1,ro=o.album_name||"Untitled",mo=o.album_url,lo=o.photo_url,bo=jo=+o.my_id,fo=+o.groupid,vo=+o.eventid,ho=bo&&+o.my_id==+o.owner_id,_o=+o.is_admin,go=!+o.deleteoriginalphotos,wo=+o.enablereporting,ko=+o.enablesharing,yo=+o.enablelike,mo&&(ro='<a href="'+mo+'">'+ro+"</a>"),q.items[0]={type:"inline",src:o.error?H(o):N(o)},q.updateItemHTML(),q.close=f,z=q.contentContainer,o.error||(G=z.find("img"),V=z.find(".joms-spinner"),W=z.find(".joms-popup__optcaption"),K=z.find(".joms-popup__btn-tag-photo"),z.on("click",".mfp-arrow-left",s),z.on("click",".mfp-arrow-right",i),z.on("click",".joms-popup__btn-tag-photo",u),z.on("click",".joms-popup__btn-comments",j),z.on("click",".joms-popup__btn-comments .joms-icon",j),z.on("click",".joms-popup__btn-option",v),z.on("click",".joms-popup__btn-share",g),z.on("click",".joms-popup__btn-download",w),z.on("click",".joms-popup__btn-report",k),z.on("click",".joms-popup__btn-upload",y),z.on("click",".joms-popup__btn-cover",x),z.on("click",".joms-popup__btn-profile",T),z.on("click",".joms-popup__btn-delete",M),z.on("click",".joms-popup__btn-move",L),z.on("click",".joms-popup__btn-like",O),z.on("click",".joms-popup__btn-dislike",I),z.on("click",".joms-popup__btn-rotate-left",U),z.on("click",".joms-popup__btn-rotate-right",E),z.on("mouseleave",".joms-popup__dropdown--wrapper",b),z.on("click",".joms-js--remove-tag",l),z.on("click",".joms-js--btn-desc-edit",Y),z.on("click",".joms-js--btn-desc-cancel",B),z.on("click",".joms-js--btn-desc-save",D),t(document).off("keyup.photomodal").on("keyup.photomodal",function(o){var t=o.target.tagName.toLowerCase(),e=o.keyCode;"input"!==t&&"textarea"!==t&&(37!==e&&39!==e||(37===e&&no>0?s():39===e&&no<eo.length-1&&i()))}),q.st.callbacks||(q.st.callbacks={}),q.st.callbacks.close=function(){t(document).off("keyup.photomodal")},to||(to=o.list[o.index].id),P(to),p(),a())}})}function n(o,e){clearTimeout(xo),clearTimeout(Co),o.hide(),o.removeAttr("src"),Co=setTimeout(function(){V.show()},100),xo=setTimeout(function(){t("<img>").load(function(){clearTimeout(Co),V.hide(),o.attr("src",e),o.show()}).attr("src",e)},1)}function s(){--no<0&&(no=eo.length-1),to=eo[no].id,n(G,eo[no].url),W.html(ro+' <span class="joms-popup__optcapindex">'+(no+1)+" "+o.joms_lang.COM_COMMUNITY_OF+" "+eo.length+"</span>"),m(),P(to),p(),a()}function i(){++no>=eo.length&&(no=0),to=eo[no].id,n(G,eo[no].url),W.html(ro+' <span class="joms-popup__optcapindex">'+(no+1)+" "+o.joms_lang.COM_COMMUNITY_OF+" "+eo.length+"</span>"),m(),P(to),p(),a()}function p(){var o=no<=0,t=no>=eo.length-1;z.find(".mfp-arrow-left")[o?"hide":"show"](),z.find(".mfp-arrow-right")[t?"hide":"show"]()}function a(){var o=no<=0,t=no>=eo.length-1;o||((new Image).src=eo[no-1].url),t||((new Image).src=eo[no+1].url)}function u(){K.data("tagging")?m():(K.data("tagging",1),z.find(".joms-phototag__tags").hide(),z.children(".joms-popup--photo").addClass("joms-popup--phototag"),G.off("click.phototag").on("click.phototag",c),G.addClass("joms-phototag__image"),z.find(".joms-popup__btn-tag-photo").html(Lo+" "+so.done_tagging))}function c(o){var t=joms._.map(J,function(o){return o.userId+""});joms.util.phototag.create(o,t,!1,fo,vo),joms.util.phototag.on("tagAdded",r),joms.util.phototag.on("destroy",function(){K.removeData("tagging"),z.children(".joms-popup--photo").removeClass("joms-popup--phototag"),G.off("click.phototag"),G.removeClass("joms-phototag__image"),z.find(".joms-popup__btn-tag-photo").html(Lo+' <span class="joms-popup__btn-overlay">'+so.tag_photo+"</span>")}),z.children(".joms-popup--photo").removeClass("joms-popup--phototag"),G.off("click.phototag")}function r(t,e,n,s,i){joms.ajax({func:"photos,ajaxAddPhotoTag",data:[to,t,n,e,s,i],callback:function(t){t.error?o.alert(R(t.error)):t.success&&(J.push(t.data),z.find(".joms-popup__comment").find(".joms-js--tag-info").html(d()))}})}function m(){joms.util.phototag.destroy()}function l(e){var n=t(e.currentTarget).data("id");joms.ajax({func:"photos,ajaxRemovePhotoTag",data:[to,n],callback:function(t){var e;if(t.error)o.alert(R(t.error));else if(t.success){for(e=0;e<J.length;e++)+n==+J[e].userId&&J.splice(e--,1);z.find(".joms-popup__comment").find(".joms-js--tag-info").html(d())}}})}function d(){var o,t,e,n;if(J&&J.length||(J=[]),joms.util.phototag.populate(G,J,"page"),!J.length)return"";for(o=[],n=0;n<J.length;n++)e='<a href="'+(t=J[n]).profileUrl+'">'+t.displayName+"</a>",t.canRemove&&(e+=' (<a href="javascript:" class="joms-js--remove-tag" data-id="'+t.userId+'">'+Z+"</a>)"),o.push(e);return o=o.join(", "),o=X+"<br>"+o}function j(o){o.stopPropagation(),z.children(".joms-popup").toggleClass("joms-popup--togglecomment")}function f(){var o=z.children(".joms-popup");o.hasClass("joms-popup--togglecomment")?o.removeClass("joms-popup--togglecomment"):t.magnificPopup.proto.close.call(this)}function v(o){t(o.target).closest(".joms-popup__dropdown--wrapper").children(".joms-popup__dropdown").toggleClass("joms-popup__dropdown--open")}function b(o){t(o.target).closest(".joms-popup__dropdown--wrapper").children(".joms-popup__dropdown").removeClass("joms-popup__dropdown--open")}function h(o){var t,e,n="",s="";o||(o={}),e=o.is_photo_owner,ko&&(n+='<a href="javascript:" class="joms-popup__btn-share">'+so.share+"</a>"),go&&(n+='<a href="javascript:" class="joms-popup__btn-download">'+so.download+"</a>"),ho||_o||e?(n+=ko||go?'<div class="sep"></div>':"",n+=ho?'<a href="javascript:" class="joms-popup__btn-upload">'+so.upload_photos+"</a>":"",n+=ho?'<div class="sep"></div>':"",n+=ho?'<a href="javascript:" class="joms-popup__btn-profile">'+so.set_as_profile_picture+"</a>":"",n+=ho||_o?'<a href="javascript:" class="joms-popup__btn-cover">'+so.set_as_album_cover+"</a>":"",n+=po?'<a href="javascript:" class="joms-popup__btn-delete">'+so.delete_photo+"</a>":"",n+=uo||e?'<a href="javascript:" class="joms-popup__btn-move">'+so.move_to_another_album+"</a>":"",n+=co?'<div class="sep joms-popup__btn-rotate-toggle"></div>':"",n+=co?'<a href="javascript:" class="joms-popup__btn-rotate-left joms-popup__btn-rotate-toggle">'+so.rotate_left+"</a>":"",n+=co?'<a href="javascript:" class="joms-popup__btn-rotate-right joms-popup__btn-rotate-toggle">'+so.rotate_right+"</a>":""):(n+=po?'<a href="javascript:" class="joms-popup__btn-delete">'+so.delete_photo+"</a>":"",n+=wo?'<a href="javascript:" class="joms-popup__btn-report">'+so.report+"</a>":""),n='<div class="joms-popup__dropdown"><div class="joms-popup__ddcontent">'+n+"</div></div>",yo&&o&&o.like&&(s+='<button class="joms-popup__btn-like joms-js--like-photo-'+to+(o.like.is_liked?" liked":"")+'"',s+=' onclick="joms.api.page'+(o.like.is_liked?"Unlike":"Like")+"('photo', '"+to+"');\"",s+=' data-lang="'+(o.like.lang||"Like")+'"',s+=' data-lang-like="'+(o.like.lang_like||"Like")+'"',s+=' data-lang-liked="'+(o.like.lang_liked||"Liked")+'">',s+=So+" ",s+="<span>",s+=o.like.is_liked?o.like.lang_liked:o.like.lang_like,(t=+o.like.count)>0&&(s+=" ("+t+")"),s+="</span></button>"),z.find(".joms-popup__dropdown").replaceWith(n),z.find(".joms-popup__btn-like").replaceWith(s)}function _(o){var t=z.find(".joms-popup__btn-rotate-toggle");"boolean"==typeof o&&(o?t.show():t.hide())}function g(){joms.api.pageShare(lo.replace("___photo_id___",to))}function w(){o.open(eo[no].original)}function k(){joms.api.photoReport(jo,lo.replace("___photo_id___",to))}function y(){joms.api.photoUpload(oo)}function x(){joms.ajax({func:"photos,ajaxConfirmDefaultPhoto",data:[oo,to],callback:function(t){t.error?o.alert(R(t.error)):o.confirm(R(t.message))&&C()}})}function C(){joms.ajax({func:"photos,ajaxSetDefaultPhoto",data:[oo,to],callback:function(t){o.alert(R(t.error||t.message))}})}function T(){joms.ajax({func:"photos,ajaxLinkToProfile",data:[to],callback:function(e){var n,s;if(e.error)o.alert(R(e.error));else if(o.confirm(R(e.message))){e.formParams||(e.formParams={}),n=t('<form method=post action="'+e.formUrl+'" style="width:1px; height:1px; position:absolute"/>');for(s in e.formParams)n.append('<input type=hidden name="'+s+'" value="'+e.formParams[s]+'"/>');n.appendTo(document.body),n[0].submit()}}})}function M(){joms.ajax({func:"photos,ajaxConfirmRemovePhoto",data:[to],callback:function(t){t.error?o.alert(R(t.error)):o.confirm(R(t.message))&&S()}})}function S(){joms.ajax({func:"photos,ajaxRemovePhoto",data:[to],callback:function(t){t.error?o.alert(R(t.error)):(z.off(),q.close(),o.location.reload())}})}function L(){joms.api.photoSetAlbum(to)}function O(){}function I(){}function U(){A("left")}function E(){A("right")}function A(o){var t=eo[no]&&eo[no].id;t&&joms.ajax({func:"photos,ajaxRotatePhoto",data:[t,o],callback:function(o){joms._.extend(eo[no],o||{}),G.attr("src",eo[no].url)}})}function R(o){return o=o.replace(/<\/?[^>]+>/g,"")}function N(t){var e,n,s="";return t||(t={}),e=t.error||"",n=t.error?"":t.commentHtml||"",t.error||(eo=t.list||[],no=t.index||0,no=Math.min(eo.length,no),e='<img src="'+eo[no].url+'" data-index="'+no+'"><div class="joms-spinner" style="display:none"></div>',s=ro+' <span class="joms-popup__optcapindex">'+(no+1)+" "+o.joms_lang.COM_COMMUNITY_OF+" "+eo.length+"</span>"),['<div class="joms-popup joms-popup--photo">','<div class="joms-popup__commentwrapper">','<div class="joms-popup__content">',eo&&eo.length>1?'<button class="mfp-arrow mfp-arrow-left" type="button" title="'+so.prev+'"></button>':"",eo&&eo.length>1?'<button class="mfp-arrow mfp-arrow-right" type="button" title="'+so.next+'"></button>':"",e,'<div class="joms-popup__option clearfix">','<div class="joms-popup__optcaption">',s||"Untitled","</div>",'<div class="joms-popup__optoption">','<button class="joms-popup__btn-viewalbum" onclick="window.location=\'',mo,"'\">",Oo,' <span class="joms-popup__btn-overlay">',so.view_album,"</span></button>",'<button class="joms-popup__btn-comments">',Mo,' <span class="joms-popup__btn-overlay">',so.comments,"</span></button>",'<button class="joms-popup__btn-like"></button>',ao?'<button class="joms-popup__btn-tag-photo">'+Lo+' <span class="joms-popup__btn-overlay">'+so.tag_photo+"</span></button>":"",'<div class="joms-popup__dropdown--wrapper"><div class="joms-popup__dropdown"></div><button class="joms-popup__btn-option">',To,' <span class="joms-popup__btn-overlay">',so.options,"</span></button></div>","</div>","</div>","</div>",'<div class="joms-popup__comment">',n,"</div>",'<button class="mfp-close" type="button" title="Close (Esc)">×</button>',"</div>","</div>"].join("")}function H(o){return o||(o={}),o.title||(o.title="&nbsp;"),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',o.error,"</div>","</div>"].join("")}function P(o,e){var n=z.find(".joms-popup__comment");e||n.empty(),joms.ajax({func:"photos,ajaxSwitchPhotoTrigger",data:[o,e?1:0],callback:function(o){e||o.comments&&o.showall&&(o.showall='<div class="joms-comment__more joms-js--more-comments"><a href="javascript:">'+o.showall+"</a></div>",o.comments=t(t.trim(o.comments)),o.comments.prepend(o.showall)),e?n.find(".joms-comment").replaceWith(o.comments):(n.html(o.head||""),n.append(o.comments),n.append(o.form||""),J=o.tagged||[],X=o.tagLabel||"",Z=o.tagRemoveLabel||"",io=void 0===o.can_edit?io:o.can_edit,po=void 0===o.can_delete?po:o.can_delete,ao=void 0===o.can_tag?ao:o.can_tag,uo=void 0===o.can_move_photo?uo:o.can_move_photo,co=void 0===o.can_rotate?co:o.can_rotate,n.find(".joms-js--description").html(Q(o.description||{})),_(!!co),n.find(".joms-js--tag-info").html(d()),n.find(".joms-js--comments,.joms-js--newcomment").find("textarea.joms-textarea"),joms.fn.tagging.initInputbox()),h(o),$()}})}function $(){var o=".joms-js--video",e=t(".joms-comment__body,.joms-js--inbox").find(o).not(".joms-js--initialized");e.length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),e.on("click.joms-video",o+"-play",function(){var e=t(this).closest(o);joms.util.video.play(e,e.data())}),joms.ios&&setTimeout(function(){e.find(o+"-play").click()},2e3))}function Q(o){return"object"!=typeof o&&(o={}),['<div class="joms-js--btn-desc-content">',o.content||"","</div>",'<div class="joms-js--btn-desc-editor joms-popup__hide">','<textarea class="joms-textarea" style="margin:0" placeholder="',o.lang_placeholder||"",'">',F(o.content||""),"</textarea>",'<div style="margin-top:5px;text-align:right">','<button class="joms-button--neutral joms-button--small joms-js--btn-desc-cancel">',o.lang_cancel||"Cancel","</button> ",'<button class="joms-button--primary joms-button--small joms-js--btn-desc-save">',o.lang_save||"Save","</button>","</div>","</div>",'<div class="joms-js--btn-desc-edit"',io?"":' style="display:none"','><a href="javascript:"',' data-lang-add="',o.lang_add||"Add description",'"',' data-lang-edit="',o.lang_edit||"Edit description",'">',o.content?o.lang_edit:o.lang_add,"</a>","</div>"].join("")}function F(o){return o=o||"",o=o.replace(/<br\s*\/?>/g,"\n")}function Y(){z.find(".joms-js--btn-desc-content").hide(),z.find(".joms-js--btn-desc-edit").hide(),z.find(".joms-js--btn-desc-editor").show()}function B(){z.find(".joms-js--btn-desc-editor").hide(),z.find(".joms-js--btn-desc-content").show(),z.find(".joms-js--btn-desc-edit").show()}function D(){var e=z.find(".joms-js--btn-desc-content"),n=z.find(".joms-js--btn-desc-editor"),s=z.find(".joms-js--btn-desc-edit"),i=n.find("textarea"),p=t.trim(i.val());joms.ajax({func:"photos,ajaxSaveCaption",data:[to,p],callback:function(t){var i=s.find("a");t.error?o.alert(t.error):t.success&&(n.hide(),e.html(t.caption).show(),i.html(i.data("lang-"+(p?"edit":"add"))),s.show())}})}var q,z,G,V,W,K,J,X,Z,oo,to,eo,no,so,io,po,ao,uo,co,ro,mo,lo,jo,fo,vo,bo,ho,_o,go,wo,ko,yo,xo,Co,To='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-cog"></use></svg>',Mo='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-bubble"></use></svg>',So='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-thumbs-up"></use></svg>',Lo='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-tag"></use></svg>',Oo='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-newspaper"></use></svg>';return joms._.debounce(function(o,t){joms.util.popup.prepare(function(n){e(n,o,t)})},200)}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.remove=n(o,t),e("popups/photo.remove",["utils/popup"],function(){return joms.popup.photo.remove})}(window,joms.jQuery,function(o,t){function e(o,t){a&&a.off(),p=o,u=t,joms.ajax({func:"photos,ajaxConfirmRemovePhoto",data:[u],callback:function(o){p.items[0]={type:"inline",src:i(o)},p.updateItemHTML(),(a=p.contentContainer).on("click",".joms-js--button-cancel",n),a.on("click",".joms-js--button-save",s)}})}function n(){a.off(),p.close()}function s(){joms.ajax({func:"photos,ajaxRemovePhoto",data:[u],callback:function(e){var s;e.error?(a.find(".joms-js--step1").hide(),a.find(".joms-js--step2").show().children().html(e.error||e.message)):(s=t(".joms-js--photo-"+u)).length&&s.siblings().length?(s.remove(),n()):o.location.reload()}})}function i(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">','<div class="joms-popup__content joms-popup__content--single">',o.message,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var p,a,u;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.report=t(),e("popups/photo.report",["utils/popup"],function(){return joms.popup.photo.report})}(window,function(){function o(o,c,r){p&&p.off(),i=o,a=c,u=r,joms.ajax({func:"system,ajaxReport",data:[],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("change","select",t),p.on("click",".joms-js--button-cancel",e),p.on("click",".joms-js--button-save",n)}})}function t(o){p.find("textarea").val(o.target.value)}function e(){p.off(),i.close()}function n(){var o,t=/^\s+|\s+$/g;(o=(o=p.find("textarea").val()).replace(t,""))?(p.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["photos,reportPhoto",u||window.location.href,o,a],callback:function(o){p.find(".joms-js--step1").hide(),p.find(".joms-js--step2").show().children().html(o.error||o.message)}})):p.find(".joms-js--error").show()}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">',o.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var i,p,a,u;return function(t,e){joms.util.popup.prepare(function(n){o(n,t,e)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.setAvatar=n(o,t),e("popups/photo.setavatar",["utils/popup"],function(){return joms.popup.photo.setAvatar})}(window,joms.jQuery,function(o,t){function e(o,t){a&&a.off(),p=o,u=t,joms.ajax({func:"photos,ajaxLinkToProfile",data:[u],callback:function(o){p.items[0]={type:"inline",src:i(o)},p.updateItemHTML(),c=o.formUrl||"",r=o.formParams||{},(a=p.contentContainer).on("click",".joms-js--button-cancel",n),a.on("click",".joms-js--button-save",s)}})}function n(){a.off(),p.close()}function s(){var o,e=t('<form method=post action="'+c+'" style="width:1px; height:1px; position:absolute"/>');for(o in r)e.append('<input type=hidden name="'+o+'" value="'+r[o]+'"/>');e.appendTo(document.body),e[0].submit()}function i(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">','<div class="joms-popup__content">',o.message,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var p,a,u,c,r;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.setCover=n(),e("popups/photo.setcover",["utils/popup"],function(){return joms.popup.photo.setCover})}(window,joms.jQuery,function(){function o(o,u,c){i&&i.off(),s=o,p=u,a=c,joms.ajax({func:"photos,ajaxConfirmDefaultPhoto",data:[p,a],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click",".joms-js--button-cancel",t),i.on("click",".joms-js--button-save",e)}})}function t(){i.off(),s.close()}function e(){joms.ajax({func:"photos,ajaxSetDefaultPhoto",data:[p,a],callback:function(o){i.find(".joms-js--step1").hide(),i.find(".joms-js--step2").show().children().html(o.error||o.message)}})}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">','<div class="joms-popup__content">',o.message,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var s,i,p,a;return function(t,e){joms.util.popup.prepare(function(n){o(n,t,e)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.upload=n(o,t),e("popups/photo.upload",["utils/loadlib","utils/popup"],function(){return joms.popup.photo.upload})}(window,joms.jQuery,function(o,t){function e(o,t,e,u){var c;h&&h.off(),b=o,k=t||!1,x=u||!1,y=e||!1,(c=[]).push(k||""),c.push(y||""),c.push(x||""),joms.ajax({func:"photos,ajaxUploadPhoto",data:c,callback:function(o){b.items[0]={type:"inline",src:v(o)},b.updateItemHTML(),C=o.lang||{},h=b.contentContainer,w=h.find(".joms-gallery"),T=[],h.on("click",".joms-tab__bar a",n),h.on("click",".joms-js--form-toggle",s),h.on("click",".joms-js--btn-create",i),h.on("click",".joms-js--btn-add",p),h.on("click",".joms-js--btn-view",f),a()}})}function n(o){var e=h.find(".joms-js--btn-create"),n=h.find(".joms-js--btn-add"),s=t(o.target).attr("href");M||s.match(/select-album/)?(e.hide(),n.show()):(n.hide(),e.show())}function s(o){var t=h.find(".joms-js--form-toggle");"show"!==o&&"hide"!==o&&(o=t.data("hidden")?"show":"hide"),"show"===o?(t.removeData("hidden"),h.find(".joms-js--thumbnails").hide(),h.find(".joms-js--form-detail").css({height:""})):"hide"===o&&(t.data("hidden","hidden"),h.find(".joms-js--form-detail").css({height:0}),h.find(".joms-js--thumbnails").show())}function i(){var e=t.trim(h.find("[name=name]").val()),n=t.trim(h.find("[name=location]").val()),i=t.trim(h.find("[name=description]").val()),p=h.find("[name=permissions]").val(),a=h.find("[name=name]").siblings(".joms-help").hide(),u=h.find(".joms-js--btn-create img");e.length?u.is(":visible")||(u.show(),joms.ajax({func:"photos,ajaxCreateAlbum",data:[e,y||"",x||"",n||"",i||"",p||""],callback:joms._.debounce(function(t){u.hide(),t.error?o.alert(t.error):t.albumid&&(k=M=t.albumid,h.find(".joms-js--btn-create").hide(),h.find(".joms-js--btn-add").show(),h.find("#joms-js__new-album").find("input.joms-input, textarea.joms-textarea, select.joms-select").attr("disabled","disabled"),s("hide"))},500)})):a.show()}function p(){a(function(){g.click()})}function a(e){"function"!=typeof e&&(e=function(){}),_?e():joms.util.loadLib("plupload",function(){var n;n=t('<div id="joms-js--photoupload-uploader" aria-hidden="true" style="width:1px; height:1px; overflow:hidden">').appendTo(document.body),t('<button id="joms-js--photoupload-uploader-button">').appendTo(n),(_=new o.plupload.Uploader({url:"index.php?option=com_community&view=photos&task=multiUpload",filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}],container:"joms-js--photoupload-uploader",browse_button:"joms-js--photoupload-uploader-button",runtimes:"html5,html4"})).bind("FilesAdded",u),_.bind("Error",m),_.bind("UploadProgress",l),_.bind("FileUploaded",d),_.bind("uploadComplete",j),_.init(),g=n.find("input[type=file]"),e()})}function u(o,t){var e,n="";for(e=0;e<t.length;e++)n+='<li class="joms-gallery__item joms-file--'+t[e].id+'">',n+='<div class="joms-gallery__thumbnail"><img src="'+joms.ASSETS_URL+'photo_thumb.png"></div>',n+='<div class="joms-gallery__body">',n+='<a class="joms-gallery__title">'+t[e].name+"</a> <span>("+Math.round(t[e].size/1024)+" KB)</span>",n+='<div class="joms-progressbar"><div class="joms-progressbar__progress" style="width:0%"></div></div>',n+="</div>",n+="</li>";w.append(n),h.find(".joms-js--btn-add").css({visibility:"visible"}),h.find(".joms-js--btn-view").hide(),setTimeout(function(){c()},1e3)}function c(){h.find("[name=name]").is(":visible")?M&&(k=M):k=h.find("[name=album-id]").val(),r()}function r(){h.find(".joms-js--btn-add").css({visibility:"hidden"}),h.find(".joms-js--btn-view").hide(),_.settings.url=joms.BASE_URL+"index.php?option=com_community&view=photos&task=multiUpload&albumid="+k,_.refresh(),_.start()}function m(){}function l(o,t){var e;e=Math.min(100,Math.floor(t.loaded/t.size*100)),h.find(".joms-file--"+t.id).find(".joms-progressbar__progress").stop().animate({width:e+"%"})}function d(t,e,n){var s,i={};try{i=JSON.parse(n.response)}catch(o){}if(i.error)return _.stop(),i.canContinue?h.find(".joms-js--btn-add").css({visibility:"visible"}):h.find(".joms-js--btn-add").css({visibility:"hidden"}),(s=h.find(".joms-file--"+e.id)).prevAll().length&&h.find(".joms-js--btn-view").show(),s.nextAll().andSelf().remove(),void o.alert(i.msg);i.info&&(T.push({photoId:i.photoId}),(s=(s=h.find(".joms-file--"+e.id)).find("img")).attr("src",i.info),h.find(".joms-js--btn-add").html(h.find(".joms-js--btn-add").data("lang-more")),h.find(".joms-js--btn-view").show(),h.off("click",".joms-tab__bar a"),h.find(".joms-tab__bar a").removeAttr("href"),h.find("input.joms-input, textarea.joms-textarea, select.joms-select").attr("disabled","disabled"))}function j(){h.find(".joms-js--btn-add").css({visibility:"visible"}),h.find(".joms-js--btn-view").show(),joms.ajax({func:"photos,ajaxUpdateCounter",data:[k,JSON.stringify({files:T})],callback:function(){}})}function f(){joms.ajax({func:"photos,ajaxGetAlbumURL",data:[k||"",y||"",x||""],callback:function(t){t.url&&(o.location=t.url)}})}function v(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--photoupload">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",o.html,"</div>"].join("")}var b,h,_,g,w,k,y,x,C,T,M;return function(o,t,n){joms.util.popup.prepare(function(s){e(s,o,t,n)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.zoom=n(o,t),e("popups/photo.zoom",["utils/popup"],function(){return joms.popup.photo.zoom})}(window,joms.jQuery,function(o,t){function e(e,a){var u="resize.joms-photozoom";e.items[0]={type:"inline",src:n(a)},s=e.container,i=t(o),setTimeout(function(){s.find(".joms-popup img").one("load",p).each(function(){this.complete&&t(this).load()})},1),i.off(u).on(u,p),e.updateItemHTML(),e.st.callbacks||(e.st.callbacks={}),e.st.callbacks.close=function(){i.off(u)}}function n(o){return o=o||"",o=o.replace("thumb_",""),['<div class="joms-popup-wrapper" style="width:100%;height:100%;margin:0 auto;text-align:center">','<div class="joms-popup" style="max-width:100%;left:auto;right:auto;position:relative;display:inline;top:0">','<img src="'+o+'" style="width:auto;max-width:100%">',"</div>","</div>"].join("")}var s,i,p=joms._.debounce(function(){var o=s.find(".joms-popup").css({position:"",display:"",top:"",width:""}),t=o.find("img").css({height:""});s.find(".joms-popup-wrapper").length&&(s.find(".joms-popup-wrapper .mfp-close").appendTo(o),o.unwrap()),setTimeout(function(){var e=+t.height(),n=+s.height();e=e&&e<n?"":n,t.css("height",e),setTimeout(function(){o.css({position:"relative",width:t.width()})},1)},1)},100);return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.setAlbum=n(o,t),e("popups/photo.setalbum",["utils/popup"],function(){return joms.popup.photo.setAlbum})}(window,joms.jQuery,function(o,t){function e(o,t){a&&a.off(),p=o,u=t,"[object Array]"!==Object.prototype.toString.call(u)&&(u=[u]),joms.ajax({func:"photos,ajaxSetPhotoAlbum",data:[u.join(",")],callback:function(o){p.items[0]={type:"inline",src:i(o)},p.updateItemHTML(),(a=p.contentContainer).on("click",".joms-js--button-cancel",n),a.on("click",".joms-js--button-save",s)}})}function n(){a.off(),p.close()}function s(){var o=a.find("[name=albumid]").val();joms.ajax({func:"photos,ajaxConfirmPhotoAlbum",data:[o,u.join(",")],callback:function(o){var e,n,s=[];if(o.message&&s.push(o.message),o.moved&&o.moved.length)for(n=0;n<o.moved.length;n++)(e=t(".joms-js--album-"+o.moved[n].old_album)).length&&e.find(".joms-js--photo-"+o.moved[n].id).remove();if("[object Array]"===Object.prototype.toString.call(o.error)){if(o.error.length){for(n=0;n<o.error.length;n++)o.error[n]="<li>ID: "+o.error[n][0]+" - "+o.error[n][1]+"</li>";s.push("<ul>"+o.error.join("")+"</ul>")}}else"string"==typeof o.error&&s.push(o.error);a.find(".joms-js--step1").hide(),a.find(".joms-js--step2").show().children().html(s.join("<br/>"))}})}function i(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">','<div class="joms-popup__content joms-popup__content--single">',o.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var p,a,u;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.photo=t(o,joms.popup.photo||{}),e("popups/photo",["popups/photo.open","popups/photo.remove","popups/photo.report","popups/photo.setavatar","popups/photo.setcover","popups/photo.upload","popups/photo.zoom","popups/photo.setalbum"],function(){return joms.popup.photo})}(window,function(o,t){return joms._.extend({},t)}),function(o,t){joms.popup||(joms.popup={}),joms.popup.pm||(joms.popup.pm={}),joms.popup.pm.send=t(),e("popups/pm.send",["utils/popup"],function(){return joms.popup.pm.send})}(window,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"inbox,ajaxCompose",data:[p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).find("textarea.joms-textarea").jomsTagging(),i.on("click","[data-ui-object=popup-button-cancel]",t),i.on("click","[data-ui-object=popup-button-save]",e)}})}function t(){i.off(),s.close()}function e(){var o,t,e=i.find("[name=body]").val(),n=i.find(".joms-textarea__attachment"),s={};e=e.replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/&quot;/g,'"').replace(/"/g,'\\"'),i.data("saving")||(i.data("saving",1),n.is(":visible")&&(t=(o=n.find(".joms-textarea__attachment--thumbnail img")).siblings("b"),o.is(":visible")&&o.attr("src")?s={type:"image",id:o.data("photo_id")}:t.is(":visible")&&(s={type:"file",id:t.data("id")})),joms.ajax({func:"chat,ajaxPrivateMessageSend",data:[p,e,JSON.stringify(s)],callback:function(o){var t=i.find("[data-ui-object=popup-step-1]"),e=i.find("[data-ui-object=popup-step-2]");i.removeData("saving"),e.find("[data-ui-object=popup-message]").html(o),t.hide(),e.show()}}))}function n(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div data-ui-object="popup-step-1"',o.error?' class="joms-popup__hide"':"",">",o.html||"",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnSend,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',o.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',o.error||"","</div>","</div>","</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.pm=t(o,joms.popup.pm||{}),e("popups/pm",["popups/pm.send"],function(){return joms.popup.pm})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.search||(joms.popup.search={}),joms.popup.search.save=n(o,t),e("popups/search.save",[],function(){return joms.popup.search.save})}(window,joms.jQuery,function(o,t){function e(o,t){var e,c,r,m,l,d;for(a&&a.off(),p=o,e=(u=t||{}).json||{},c=(u.keys||"").split(","),m=[],d=0;d<c.length;d++)l="date"===e["fieldType"+(r=c[d])]||"birthdate"===e["fieldType"+r]||"between"===e["condition"+r]?e["value"+r]+","+e["value"+r+"_2"]:e["value"+r],m[d]=["field="+e["field"+r]+",condition="+e["condition"+r]+",fieldType="+e["fieldType"+r]+",value="+l];joms.ajax({func:"memberlist,ajaxShowSaveForm",data:[u.operator,u.avatar_only?1:0].concat(m),callback:function(o){p.items[0]={type:"inline",src:i(o)},p.updateItemHTML(),(a=p.contentContainer).on("click",".joms-js--button-cancel",n),a.on("click",".joms-js--button-save",s)}})}function n(){a.off(),p.close()}function s(){var o=a.find("[name=title]"),e=a.find("[name=description]"),n=!1;t.trim(o.val())?o.siblings(".joms-help").hide():(o.siblings(".joms-help").show(),n=!0),t.trim(e.val())?e.siblings(".joms-help").hide():(e.siblings(".joms-help").show(),n=!0),n||a.find("form").submit()}function i(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnSave,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var p,a,u;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.search=t(o,joms.popup.search||{}),e("popups/search",["popups/search.save"],function(){return joms.popup.search})}(window,function(o,t){return joms._.extend({},t)}),function(o,t){joms.popup||(joms.popup={}),joms.popup.tnc=t()}(window,function(){function o(o){e=o,joms.ajax({func:"register,ajaxShowTnc",data:[0],callback:function(o){e.items[0]={type:"inline",src:t(o)},e.updateItemHTML()}})}function t(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content joms-popup__content--single" style="max-height:400px;overflow:auto;">',o.html||"&nbsp;","</div>","</div>"].join("")}var e;return function(){joms.util.popup.prepare(function(t){o(t)})}}),e("popups/tnc",function(){}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.changeVanityURL=n(),e("popups/user.changevanityurl",["utils/popup"],function(){return joms.popup.user.changeVanityURL})}(window,joms.jQuery,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"profile,ajaxUpdateURL",data:[p],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click","[data-ui-object=popup-button-cancel]",t),i.on("click","[data-ui-object=popup-button-save]",e)}})}function t(){i.off(),s.close()}function e(){i.find("form").submit()}function n(o){var t="";return o||(o={}),o.btnUpdate&&o.btnCancel&&(t=['<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnUpdate,"</button>","</div>"].join("")),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content">',o.html||o.message,"</div>",t,"</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.addFeatured=n(o),e("popups/user.addfeatured",["utils/popup"],function(){return joms.popup.user.addFeatured})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p,joms.ajax({func:"search,ajaxAddFeatured",data:[i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()},n.updateItemHTML()}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.removeFeatured=n(o),e("popups/user.removefeatured",["utils/popup"],function(){return joms.popup.user.removeFeatured})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p,joms.ajax({func:"search,ajaxRemoveFeatured",data:[i],callback:function(t){n.items[0]={type:"inline",src:e(t)},n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()},n.updateItemHTML()}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.ban=n(),e("popups/user.ban",["utils/popup"],function(){return joms.popup.user.ban})}(window,joms.jQuery,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"profile,ajaxBanUser",data:[p,0],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click","[data-ui-object=popup-button-cancel]",t),i.on("click","[data-ui-object=popup-button-save]",e)}})}function t(){i.off(),s.close()}function e(){i.find("form").submit()}function n(o){var t="";return o||(o={}),o.error||(t=['<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnYes,"</button>","</div>"].join("")),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content',o.error?" joms-popup__content--single":"",'">',o.html||o.error,"</div>",t,"</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.unban=n(),e("popups/user.unban",["utils/popup"],function(){return joms.popup.user.unban})}(window,joms.jQuery,function(){function o(o,a){i&&i.off(),s=o,p=a,joms.ajax({func:"profile,ajaxBanUser",data:[p,1],callback:function(o){s.items[0]={type:"inline",src:n(o)},s.updateItemHTML(),(i=s.contentContainer).on("click","[data-ui-object=popup-button-cancel]",t),i.on("click","[data-ui-object=popup-button-save]",e)}})}function t(){i.off(),s.close()}function e(){i.find("form").submit()}function n(o){var t="";return o||(o={}),o.error||(t=['<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnYes,"</button>","</div>"].join("")),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content',o.error?" joms-popup__content--single":"",'">',o.html||o.error,"</div>",t,"</div>"].join("")}var s,i,p;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.block=n(o),e("popups/user.block",["utils/popup"],function(){return joms.popup.user.block})}(window,joms.jQuery,function(o){function t(o,t){p&&p.off(),i=o,a=t,joms.ajax({func:"profile,ajaxConfirmBlockUser",data:[a],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("click",".joms-js--button-cancel",e),p.on("click",".joms-js--button-save",n)}})}function e(){p.off(),i.close()}function n(){joms.ajax({func:"profile,ajaxBlockUser",data:[a],callback:function(t){if(!t.success)return p.find(".joms-popup__action").hide(),void p.find(".joms-popup__content").html(t.error);i.close(),o.location.reload()}})}function s(o){var t;return o||(o={}),t=o.error?['<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-cancel">',o.btnClose,"</button>","</div>"].join(""):['<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>"].join(""),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content">',o.error||o.html||o.message,"</div>",t,"</div>"].join("")}var i,p,a;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.unblock=n(o),e("popups/user.unblock",["utils/popup"],function(){return joms.popup.user.unblock})}(window,joms.jQuery,function(o){function t(o,t){p&&p.off(),i=o,a=t,joms.ajax({func:"profile,ajaxConfirmUnBlockUser",data:[a],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("click","[data-ui-object=popup-button-cancel]",e),p.on("click","[data-ui-object=popup-button-save]",n)}})}function e(){p.off(),i.close()}function n(){joms.ajax({func:"profile,ajaxUnblockUser",data:[a],callback:function(t){if(!t.success)return p.find(".joms-popup__action").hide(),void p.find(".joms-popup__content").html(t.error);i.close(),o.location.reload()}})}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content">',o.html||o.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnYes,"</button>","</div>","</div>"].join("")}var i,p,a;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.ignore=n(o),e("popups/user.ignore",["utils/popup"],function(){return joms.popup.user.ignore})}(window,joms.jQuery,function(o){function t(o,t){p&&p.off(),i=o,a=t,joms.ajax({func:"profile,ajaxConfirmIgnoreUser",data:[a],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("click","[data-ui-object=popup-button-cancel]",e),p.on("click","[data-ui-object=popup-button-save]",n)}})}function e(){p.off(),i.close()}function n(){joms.ajax({func:"profile,ajaxIgnoreUser",data:[a],callback:function(t){if(!t.success)return p.find(".joms-popup__action").hide(),void p.find(".joms-popup__content").html(t.error);i.close(),o.location.reload()}})}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content">',o.html||o.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnYes,"</button>","</div>","</div>"].join("")}var i,p,a;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.report=t(),e("popups/user.report",["utils/popup"],function(){return joms.popup.user.report})}(window,function(){function o(o,u){p&&p.off(),i=o,a=u,joms.ajax({func:"system,ajaxReport",data:[],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("change","select",t),p.on("click",".joms-js--button-cancel",e),p.on("click",".joms-js--button-save",n)}})}function t(o){p.find("textarea").val(o.target.value)}function e(){p.off(),i.close()}function n(){var o,t=/^\s+|\s+$/g;(o=(o=p.find("textarea").val()).replace(t,""))?(p.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["profile,reportProfile",window.location.href,o,a],callback:function(o){p.find(".joms-js--step1").hide(),p.find(".joms-js--step2").show().children().html(o.error||o.message)}})):p.find(".joms-js--error").show()}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">',o.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var i,p,a;return function(t){joms.util.popup.prepare(function(e){o(e,t)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.unignore=n(o),e("popups/user.unignore",["utils/popup"],function(){return joms.popup.user.unignore})}(window,joms.jQuery,function(o){function t(o,t){p&&p.off(),i=o,a=t,joms.ajax({func:"profile,ajaxConfirmUnIgnoreUser",data:[a],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("click","[data-ui-object=popup-button-cancel]",e),p.on("click","[data-ui-object=popup-button-save]",n)}})}function e(){p.off(),i.close()}function n(){joms.ajax({func:"profile,ajaxUnIgnoreUser",data:[a],callback:function(t){if(!t.success)return p.find(".joms-popup__action").hide(),void p.find(".joms-popup__content").html(t.error);i.close(),o.location.reload()}})}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content">',o.html||o.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',o.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',o.btnYes,"</button>","</div>","</div>"].join("")}var i,p,a;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.user=t(o,joms.popup.user||{}),e("popups/user",["popups/user.changevanityurl","popups/user.addfeatured","popups/user.removefeatured","popups/user.ban","popups/user.unban","popups/user.block","popups/user.unblock","popups/user.ignore","popups/user.report","popups/user.unignore"],function(){return joms.popup.user})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,e){joms.util||(joms.util={}),joms.util.videotag=e(o,t)}(window,joms.jQuery,function(o,t,e){function n(e){var n,s,i,p;d||(d=o.joms_friends||[]),n=t(e?e.currentTarget:m.find("input")),s=n.val().replace(/^\s+|\s+$/g,"").toLowerCase(),i=d,i=(i=joms._.filter(d,function(o){return!!o&&(!!o.name&&(!(f&&f.indexOf(o.id+"")>=0)&&!(s&&o.name.toLowerCase().indexOf(s)<0)))})).slice(0,8),(i=joms._.map(i,function(o){return'<a href="javascript:" data-id="'+o.id+'">'+o.name+"</a>"})).length?v=!1:(i=["<span><em>"+o.joms_lang.COM_COMMUNITY_NO_RESULT_FOUND+"</em></span>"],v=!0),(p=m.find(".joms-phototag__autocomplete")).html(i.join("")),p.append('<div><button class="joms-button--neutral joms-button--small joms-button--full">'+o.joms_lang.COM_COMMUNITY_PHOTO_DONE_TAGGING+"</button></div>"),p.show()}function s(o){var e,s=m.find(".joms-phototag__autocomplete"),i=t(o.currentTarget).data("id")||"";o.stopPropagation(),s.hide(),j&&j.tagAdded&&(f||(f=[]),f.push(i+""),e=a(),j.tagAdded(i,e.left,e.top,e.width,e.height),n())}function i(){m&&(m.remove(),r.remove(),t(o).off("resize.phototag"),m=e,l=e,j&&j.destroy&&j.destroy(),j=e)}function p(){var o,t,e=l.height(),n=l.width();return t=Math.max(0,e-86)/4.5,o=Math.max(0,n-86)/2,{top:t,left:o}}function a(){var o,t,e,n,s,i,p;return t=r.width(),e=r.height(),o=m.position(),n=m.width(),s=m.height(),i=o.left+n/2,p=o.top+s/2,n/=e,s/=e,i/=t,p/=e,{top:p,left:i,width:n,height:s}}function u(o){var t;v?i():(t=p(o),m.css({top:t.top,left:t.left}))}function c(){return["<div class=joms-phototag__wrapper>","<div class=joms-phototag>","<div class=joms-phototag__input>",'<input type=text placeholder="',o.joms_lang.COM_COMMUNITY_SEARCH,'">','<div class="joms-phototag__autocomplete"></div>',"</div>","</div>","</div>"].join("")}var r,m,l,d,j,f,v;return{create:function(a,v,b,h){var _,g,w,k,y;if(i(),r=t(c()),m=r.find(".joms-phototag"),l=a&&a.currentTarget?t(a.currentTarget).closest(".joms-popup--video").find("iframe,video,.joms-js--video").eq(0):t(a),d=e,j={},k=l.width(),y=l.height(),_=l.position(),g=_.top,w=_.left,f=v||[],m.css({top:0,left:0}),r.css({top:g,left:w,width:k,height:y}),r.insertBefore(l),_=p(a),m.css({top:_.top,left:_.left}),m.on("keyup","input",n),m.on("click","a[data-id]",s),m.on("click","button",i),m.on("click",function(o){o.stopPropagation()}),r.on("click",u),+b?joms.fn.tagging.fetchGroupMembers(b,function(o){d=o,n()}):+h?joms.fn.tagging.fetchEventMembers(h,function(o){d=o,n()}):n(),joms.ios)try{o.scrollTo(o.scrollLeft,m.find("input").offset().top-100)}catch(a){}joms.mobile||t(o).on("resize.phototag",i)},destroy:i,on:function(o,t){j[o]=t},off:function(o){o?j[o]&&(j[o]=e):j={}}}}),e("utils/videotag",function(){}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.open=n(o,t),e("popups/video.open",["utils/popup","utils/videotag"],function(){return joms.popup.video.open})}(window,joms.jQuery,function(o,t){function e(o,t){N&&N.off(),R=o,F=t,joms.ajax({func:"videos,ajaxShowVideoWindow",data:[F],callback:function(o){o||(o={}),Y=o.lang||{},B=o.can_edit||!1,D=o.can_delete||!1,q=o.video_url,W=z=+o.my_id,G=+o.groupid,V=+o.eventid,K=W&&+o.my_id==+o.owner_id,J=+o.is_admin,X=+o.enableprofilevideo,Z=+o.enablereporting,oo=+o.enablesharing,to=o.enablefeature,R.items[0]={type:"inline",src:s(o)},R.updateItemHTML(),R.close=d,M(),N=R.contentContainer,H=N.find(".joms-popup__btn-tag-video"),N.on("click",".joms-popup__btn-tag-video",p),N.on("click",".joms-popup__btn-comments",l),N.on("click",".joms-popup__btn-option",j),N.on("click",".joms-popup__btn-share",b),N.on("click",".joms-popup__btn-report",h),N.on("click",".joms-popup__btn-fetch",_),N.on("click",".joms-popup__btn-profile",g),N.on("click",".joms-popup__btn-feature",k),N.on("click",".joms-popup__btn-edit",y),N.on("click",".joms-popup__btn-delete",x),N.on("mouseleave",".joms-popup__dropdown--wrapper",f),N.on("click",".joms-js--remove-tag",r),N.on("click",".joms-js--btn-desc-toggle",I),N.on("click",".joms-js--btn-desc-edit",U),N.on("click",".joms-js--btn-desc-cancel",E),N.on("click",".joms-js--btn-desc-save",A),T(F)}})}function n(o){return o=o.replace(/<\/?[^>]+>/g,"")}function s(o){var t;return o||(o={}),t=o.error||o.playerHtml||"",['<div class="joms-popup joms-popup--video">','<div class="joms-popup__commentwrapper">','<div class="joms-popup__content">','<div class="joms-popup__video">',t,"</div>",'<div class="joms-popup__option clearfix">','<div class="joms-popup__optcaption">',' &nbsp;<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-eye"></use></svg> ',o.hits,"</div>",'<div class="joms-popup__optoption">','<button class="joms-popup__btn-comments">',no,' <span class="joms-popup__btn-overlay">',Y.comments,"</span></button>",i(o.like),B?'<button class="joms-popup__btn-tag-video">'+io+' <span class="joms-popup__btn-overlay">'+Y.tag_video+"</span></button>":"",'<div class="joms-popup__dropdown--wrapper">',v(o),'<button class="joms-popup__btn-option">',eo,' <span class="joms-popup__btn-overlay">',Y.options,"</span></button></div>","</div>","</div>","</div>",'<div class="joms-popup__comment"></div>','<button class="mfp-close" type="button" title="Close (Esc)">×</button>',"</div>","</div>"].join("")}function i(o){var t,e;return t="",o&&(t+='<button class="joms-popup__btn-like joms-js--like-videos-'+F+(o.is_liked?" liked":"")+'"',t+=' onclick="joms.api.page'+(o.is_liked?"Unlike":"Like")+"('videos', '"+F+"');\"",t+=' data-lang="'+(o.lang||"Like")+'"',t+=' data-lang-like="'+(o.lang_like||"Like")+'"',t+=' data-lang-liked="'+(o.lang_liked||"Liked")+'">',t+=so+" ",t+="<span>",t+=o.is_liked?o.lang_liked:o.lang_like,(e=+o.count)>0&&(t+=" ("+e+")"),t+="</span></button>"),t}function p(o){H.data("tagging")?(H.removeData("tagging"),H.html(io+' <span class="joms-popup__btn-overlay">'+Y.tag_video+"</span>"),c()):(H.data("tagging",1),H.html(io+" "+Y.done_tagging),a(o))}function a(o){var t=joms._.map(P,function(o){return o.userId+""});joms.util.videotag.create(o,t,G,V),joms.util.videotag.on("tagAdded",u),joms.util.videotag.on("destroy",function(){H.removeData("tagging"),H.html(io+' <span class="joms-popup__btn-overlay">'+Y.tag_video+"</span>")})}function u(t){joms.ajax({func:"videos,ajaxAddVideoTag",data:[F,t],callback:function(t){t.error?o.alert(n(t.error)):t.success&&(P.push(t.data),N.find(".joms-popup__comment").find(".joms-js--tag-info").html(m()))}})}function c(){joms.util.videotag.destroy()}function r(e){var s=t(e.currentTarget).data("id");joms.ajax({func:"videos,ajaxRemoveVideoTag",data:[F,s],callback:function(t){var e;if(t.error)o.alert(n(t.error));else if(t.success){for(e=0;e<P.length;e++)+s==+P[e].userId&&P.splice(e--,1);N.find(".joms-popup__comment").find(".joms-js--tag-info").html(m())}}})}function m(){var o,t,e,n;if(!P||!P.length)return"";for(o=[],n=0;n<P.length;n++)e='<a href="'+(t=P[n]).profileUrl+'">'+t.displayName+"</a>",t.canRemove&&(e+=' (<a href="javascript:" class="joms-js--remove-tag" data-id="'+t.userId+'">'+Q+"</a>)"),o.push(e);return o=o.join(", "),o=$+"<br>"+o}function l(){N.children(".joms-popup").toggleClass("joms-popup--togglecomment")}function d(){var o=N.children(".joms-popup");o.hasClass("joms-popup--togglecomment")?o.removeClass("joms-popup--togglecomment"):t.magnificPopup.proto.close.call(this)}function j(o){t(o.target).closest(".joms-popup__dropdown--wrapper").children(".joms-popup__dropdown").toggleClass("joms-popup__dropdown--open")}function f(o){t(o.target).closest(".joms-popup__dropdown--wrapper").children(".joms-popup__dropdown").removeClass("joms-popup__dropdown--open")}function v(o){var t="";return o||(o={}),oo&&(t+='<a href="javascript:" class="joms-popup__btn-share">'+Y.share+"</a>",t+='<div class="sep"></div>'),K||J?(t+='<a href="javascript:" class="joms-popup__btn-fetch">'+Y.fetch+"</a>",t+=K&&X?'<a href="javascript:" class="joms-popup__btn-profile">'+Y.set_as_profile_video+"</a>":"",J&&to&&("add"===to?t+='<a href="javascript:" class="joms-popup__btn-feature" data-featured="0">'+Y.make_feature+"</a>":"remove"===to&&(t+='<a href="javascript:" class="joms-popup__btn-feature" data-featured="1">'+Y.remove_featured+"</a>")),t+='<div class="sep"></div>',t+=B?'<a href="javascript:" class="joms-popup__btn-edit">'+Y.edit_video+"</a>":"",t+=D?'<a href="javascript:" class="joms-popup__btn-delete">'+Y.delete_video+"</a>":""):(t+=B?'<a href="javascript:" class="joms-popup__btn-edit">'+Y.edit_video+"</a>":"",t+=D?'<a href="javascript:" class="joms-popup__btn-delete">'+Y.delete_video+"</a>":"",t+=Z?'<a href="javascript:" class="joms-popup__btn-report">'+Y.report+"</a>":""),t='<div class="joms-popup__dropdown"><div class="joms-popup__ddcontent">'+t+"</div></div>"}function b(){joms.api.pageShare(q)}function h(){joms.api.videoReport(z,q)}function _(){joms.api.videoFetchThumbnail(F)}function g(){joms.ajax({func:"profile,ajaxConfirmLinkProfileVideo",data:[F],callback:function(t){t.error?o.alert(n(t.error)):o.confirm(n(t.html))&&w()}})}function w(){joms.ajax({func:"profile,ajaxLinkProfileVideo",data:[F],callback:function(t){t.error?o.alert(n(t.error)):(o.alert(n(t.message)),setTimeout(function(){o.location.reload()},500))}})}function k(o){+t(o.currentTarget).data("featured")?joms.api.videoRemoveFeatured(F):joms.api.videoAddFeatured(F)}function y(){joms.api.videoEdit(F)}function x(){joms.ajax({func:"videos,ajaxConfirmRemoveVideo",data:[F],callback:function(t){t.error?o.alert(n(t.error)):o.confirm(n(t.html))&&C()}})}function C(){joms.ajax({func:"videos,ajaxRemoveVideo",data:[F],callback:function(t){t.error?o.alert(n(t.error)):(o.alert(n(t.message)),setTimeout(function(){o.location.reload()},500))}})}function T(o,e){var n=N.find(".joms-popup__comment");e||n.empty(),joms.ajax({func:"videos,ajaxGetInfo",data:[o,e?1:0],callback:function(o){e||o.comments&&o.showall&&(o.showall='<div class="joms-comment__more joms-js--more-comments"><a href="javascript:">'+o.showall+"</a></div>",o.comments=t(o.comments),o.comments.prepend(o.showall)),e?n.find(".joms-comment").replaceWith(o.comments):(n.html(o.head||""),n.append(o.comments),n.append(o.form||""),n.find(".joms-js--description").html(L(o.description||{})),P=o.tagged||[],$=o.tagLabel||"",Q=o.tagRemoveLabel||"",n.find(".joms-js--tag-info").html(m()),n.find("textarea.joms-textarea"),joms.fn.tagging.initInputbox()),S()}})}function M(){var o=t(".joms-popup__content").find(".joms-js--video");o.length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),o.on("click.joms-video",".joms-js--video-play",function(){var o=t(this).closest(".joms-js--video");joms.util.video.play(o,o.data())}))}function S(){var o=".joms-js--video",e=t(".joms-comment__body,.joms-js--inbox").find(o).not(".joms-js--initialized").addClass(".joms-js--initialized".substr(1));e.length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),e.on("click.joms-video",o+"-play",function(){var e=t(this).closest(o);joms.util.video.play(e,e.data())}),joms.ios&&setTimeout(function(){e.find(o+"-play").click()},2e3))}function L(t){var e;return"object"!=typeof t&&(t={}),t.content&&t.excerpt!==t.content&&(e=!0),['<div class="joms-js--btn-desc-content">','<span class="joms-js--btn-desc-excerpt"',e?"":' style="display:none"',">",t.excerpt||"","</span>",'<span class="joms-js--btn-desc-fulltext"',e?' style="display:none"':"",">",t.content||"","</span>",' <a href="javascript:" class="joms-js--btn-desc-toggle"',e?"":' style="display:none"',">",o.joms_lang.COM_COMMUNITY_SHOW_MORE,"</a>","</div>",'<div class="joms-js--btn-desc-editor joms-popup__hide">','<textarea class="joms-textarea" style="margin:0" placeholder="',t.lang_placeholder||"",'">',O(t.content||""),"</textarea>",'<div style="margin-top:5px;text-align:right">','<button class="joms-button--neutral joms-button--small joms-js--btn-desc-cancel">',t.lang_cancel||"Cancel","</button> ",'<button class="joms-button--primary joms-button--small joms-js--btn-desc-save">',t.lang_save||"Save","</button>","</div>","</div>",'<div class="joms-js--btn-desc-edit"',B?"":' style="display:none"','><a href="javascript:"',' data-lang-add="',t.lang_add||"Add description",'"',' data-lang-edit="',t.lang_edit||"Edit description",'">',t.content?t.lang_edit:t.lang_add,"</a>","</div>"].join("")}function O(o){return o=o||"",o=o.replace(/<br\s*\/?>/g,"\n")}function I(){var t=N.find(".joms-js--btn-desc-excerpt"),e=N.find(".joms-js--btn-desc-fulltext"),n=N.find(".joms-js--btn-desc-toggle");e.is(":visible")?(e.hide(),t.show(),n.html(o.joms_lang.COM_COMMUNITY_SHOW_MORE)):(t.hide(),e.show(),n.html(o.joms_lang.COM_COMMUNITY_SHOW_LESS))}function U(){N.find(".joms-js--btn-desc-content").hide(),N.find(".joms-js--btn-desc-edit").hide(),N.find(".joms-js--btn-desc-editor").show()}function E(){N.find(".joms-js--btn-desc-editor").hide(),N.find(".joms-js--btn-desc-content").show(),N.find(".joms-js--btn-desc-edit").show()}function A(){var e=N.find(".joms-js--btn-desc-content"),n=N.find(".joms-js--btn-desc-editor"),s=N.find(".joms-js--btn-desc-edit"),i=n.find("textarea"),p=t.trim(i.val());joms.ajax({func:"videos,ajaxSaveDescription",data:[F,p],callback:function(t){var i,a,u,c=s.find("a");t.error?o.alert(t.error):t.success&&(i=e.find(".joms-js--btn-desc-excerpt"),a=e.find(".joms-js--btn-desc-fulltext"),u=e.find(".joms-js--btn-desc-toggle"),t.caption&&t.caption!==t.excerpt?(i.html(t.excerpt).show(),u.html(o.joms_lang.COM_COMMUNITY_SHOW_MORE).show(),a.html(t.caption).hide()):(i.hide(),u.hide(),a.html(t.caption).show()),n.hide(),e.show(),c.html(c.data("lang-"+(p?"edit":"add"))),s.show())}})}var R,N,H,P,$,Q,F,Y,B,D,q,z,G,V,W,K,J,X,Z,oo,to,eo='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-cog"></use></svg>',no='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-bubble"></use></svg>',so='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-thumbs-up"></use></svg>',io='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-tag"></use></svg>';return joms._.debounce(function(o){joms.util.popup.prepare(function(t){e(t,o)})},200)}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.add=n(o,t),e("popups/video.add",["utils/loadlib","utils/popup"],function(){return joms.popup.video.add})}(window,joms.jQuery,function(o,t){function e(o,t,e){var p;f&&f.off(),j=o,_=e||!1,p=[],(h=t||!1)&&(p.push(_||""),p.push(h||"")),joms.ajax({func:"videos,ajaxAddVideo",data:p,callback:function(o){j.items[0]={type:"inline",src:d(o)},j.updateItemHTML(),(f=j.contentContainer).on("submit",".joms-js--form-link",n),f.on("click",".joms-js--select-file",s),f.on("submit",".joms-js--form-upload",a),i()}})}function n(o){o.preventDefault();var e=t(o.currentTarget),n=/^\s+|\s+$/g,s=e.find("[name=videoLinkUrl]"),i=e.find("[name=category_id]"),p=s.val().trim(n,""),a=+i.val(),u=e.find("[type=submit]"),c=u.data("lang-linking")||"Linking***";s.siblings("[data-elem=form-warning]")[p?"hide":"show"](),i.siblings("[data-elem=form-warning]")[a?"hide":"show"](),p&&a&&(e.removeAttr("onsubmit"),u.val(c),u.prop("disabled",!0),f.off("submit",".joms-js--form-link"),setTimeout(function(){e.submit()},300))}function s(){i(function(){b.click()})}function i(e){"function"!=typeof e&&(e=function(){}),v?e():joms.util.loadLib("plupload",function(){var n;n=t('<div id="joms-js--videoupload-uploader" aria-hidden="true" style="width:1px; height:1px; overflow:hidden">').appendTo(document.body),t('<button id="joms-js--videoupload-uploader-button">').appendTo(n),(v=new o.plupload.Uploader({url:"index.php?option=com_community&view=videos&task=uploadvideo",filters:[{title:"Video files",extensions:"3g2,3gp,asf,asx,avi,flv,mov,mp4,mpg,rm,swf,vob,wmv,m4v"}],container:"joms-js--videoupload-uploader",browse_button:"joms-js--videoupload-uploader-button",runtimes:"html5,html4",multi_selection:!1})).bind("FilesAdded",p),v.bind("BeforeUpload",u),v.bind("Error",c),v.bind("UploadProgress",r),v.bind("FileUploaded",m),v.bind("uploadComplete",l),v.init(),b=n.find("input[type=file]"),e()})}function p(o,t){if(t&&t.length){for(var e=f.find(".joms-js--select-file"),n=t[0],s="<span>"+n.name+"</span>",i=n.size||0,p="Bytes",a=["KB","MB","GB"];i>=1e3&&a.length;)p=a.shift(),i=Math.ceil(i/1e3);i&&(s+=" <span>("+i+" "+p+")</span>"),e.html(s)}}function a(o){o.preventDefault();var e=t(o.currentTarget),n=/^\s+|\s+$/g,s=e.find("[name=title]"),i=e.find("[name=category_id]"),p=s.val().trim(n,""),a=+i.val();if(s.siblings("[data-elem=form-warning]")[p?"hide":"show"](),i.siblings("[data-elem=form-warning]")[a?"hide":"show"](),!p||!a)return!1;e.find(".joms-progressbar__progress").css({width:0}),v.refresh(),v.start()}function u(){var o,t=f.find(".joms-js--form-upload").serializeArray(),e={};for(o=0;o<t.length;o++)e[t[o].name]=t[o].value;v.settings.multipart_params=e}function c(t,e){var n="Undefined error.";e&&e.code&&e.message&&(n="("+e.code+") "+e.message),f.find(".joms-js--select-file").html("&nbsp;"),v.splice(),v.refresh(),o.alert(n)}function r(o,t){var e;e=Math.min(100,Math.floor(t.loaded/t.size*100)),f.find(".joms-js--form-upload").find(".joms-progressbar__progress").stop().animate({width:e+"%"})}function m(t,e,n){var s={};try{s=JSON.parse(n.response)}catch(o){}"success"===s.status?setTimeout(function(){o.alert(s.processing_str),j.close()},1e3):o.alert(s.message||"Undefined error.")}function l(){}function d(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--videoupload">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",o.html?o.html:'<div class="joms-popup__content joms-popup__content--single">'+o.error+"</div>","</div>"].join("")}var j,f,v,b,h,_;return function(o,t){joms.util.popup.prepare(function(n){e(n,o,t)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.edit=t(o),e("popups/video.edit",["utils/popup"],function(){return joms.popup.video.edit})}(window,function(o){function t(t,u){p&&p.off(),i=t,a=u,joms.ajax({func:"videos,ajaxEditVideo",data:[a,o.location.href],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("click",".joms-js--button-cancel",e),p.on("click",".joms-js--button-save",n)}})}function e(){p.off(),i.close()}function n(){p.find("form").submit()}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--600">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">','<div class="joms-popup__content joms-popup__content--single">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnSave,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div data-ui-object="popup-step-2"',o.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var i,p,a;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.fetchThumbnail=n(o),e("popups/video.fetchthumbnail",["utils/popup"],function(){return joms.popup.video.fetchThumbnail})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p,joms.ajax({func:"videos,ajaxFetchThumbnail",data:[i,"myvideos"],callback:function(t){n.items[0]={type:"inline",src:e(t)},t.success&&(n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()}),n.updateItemHTML()}})}function e(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',o.message||o.error||"",o.thumbnail?'<div style="padding-top:10px;"><img src="'+o.thumbnail+'" style="max-width:100%;"></div>':"","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.linkToProfile=n(o),e("popups/video.linktoprofile",["utils/popup"],function(){return joms.popup.video.linkToProfile})}(window,joms.jQuery,function(o){function t(o,t){p&&p.off(),i=o,a=t,joms.ajax({func:"profile,ajaxConfirmLinkProfileVideo",data:[a],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("click",".joms-js--button-cancel",e),p.on("click",".joms-js--button-save",n)}})}function e(){p.off(),i.close()}function n(){joms.ajax({func:"profile,ajaxLinkProfileVideo",data:[a],callback:function(t){p.find(".joms-js--step1").hide(),p.find(".joms-js--step2").show().children().html(t.error||t.message),t.success&&setTimeout(function(){o.location.reload()},1e3)}})}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var i,p,a;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.remove=t(o),e("popups/video.remove",["utils/popup"],function(){return joms.popup.video.remove})}(window,function(o){function t(o,t,u){p&&p.off(),i=o,a=t,joms.ajax({func:"videos,ajaxConfirmRemoveVideo",data:[a],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("click",".joms-js--button-cancel",e),p.on("click",".joms-js--button-save",{redirect:u?1:0},n)}})}function e(){p.off(),i.close()}function n(t){joms.ajax({func:"videos,ajaxRemoveVideo",data:[a,t.data.redirect],callback:function(t){p.find(".joms-js--step1").hide(),p.find(".joms-js--step2").show().children().html(t.error||t.message),t.success&&setTimeout(function(){t.redirect?o.location=t.redirect:o.location.reload()},1e3)}})}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var i,p,a;return function(o,e){joms.util.popup.prepare(function(n){t(n,o,e)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.report=t(),e("popups/video.report",["utils/popup"],function(){return joms.popup.video.report})}(window,function(){function o(o,c,r){p&&p.off(),i=o,a=c,u=r,joms.ajax({func:"system,ajaxReport",data:[],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("change","select",t),p.on("click",".joms-js--button-cancel",e),p.on("click",".joms-js--button-save",n)}})}function t(o){p.find("textarea").val(o.target.value)}function e(){p.off(),i.close()}function n(){var o,t=/^\s+|\s+$/g;(o=(o=p.find("textarea").val()).replace(t,""))?(p.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["videos,reportVideo",u||window.location.href,o,a],callback:function(o){p.find(".joms-js--step1").hide(),p.find(".joms-js--step2").show().children().html(o.error||o.message)}})):p.find(".joms-js--error").show()}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">',o.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>","</div>","</div>"].join("")}var i,p,a,u;return function(t,e){joms.util.popup.prepare(function(n){o(n,t,e)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.addFeatured=n(o),e("popups/video.addfeatured",["utils/popup"],function(){return joms.popup.video.addFeatured})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p,joms.ajax({func:"videos,ajaxAddFeatured",data:[i],callback:function(t){n.items[0]={type:"inline",src:e(t)},t.success&&(n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()}),n.updateItemHTML()}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.removeFeatured=n(o),e("popups/video.removefeatured",["utils/popup"],function(){return joms.popup.video.removeFeatured})}(window,joms.jQuery,function(o){function t(t,p){s&&s.off(),n=t,i=p,joms.ajax({func:"videos,ajaxRemoveFeatured",data:[i],callback:function(t){n.items[0]={type:"inline",src:e(t)},t.success&&(n.st.callbacks||(n.st.callbacks={}),n.st.callbacks.close=function(){o.location.reload()}),n.updateItemHTML()}})}function e(t){return t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||t.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join("")}var n,s,i;return function(o){joms.util.popup.prepare(function(e){t(e,o)})}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.removeLinkFromProfile=n(o),e("popups/video.removelinkfromprofile",["utils/popup"],function(){return joms.popup.video.removeLinkFromProfile})}(window,joms.jQuery,function(o){function t(o,t,c){p&&p.off(),i=o,a=t,u=c,joms.ajax({func:"profile,ajaxRemoveConfirmLinkProfileVideo",data:[u,a],callback:function(o){i.items[0]={type:"inline",src:s(o)},i.updateItemHTML(),(p=i.contentContainer).on("click",".joms-js--button-cancel",e),p.on("click",".joms-js--button-save",n)}})}function e(){p.off(),i.close()}function n(){joms.ajax({func:"profile,ajaxRemoveLinkProfileVideo",data:[u,a],callback:function(t){p.find(".joms-js--step1").hide(),p.find(".joms-js--step2").show().children().html(t.error||t.message),t.success&&setTimeout(function(){o.location.reload()},1e3)}})}function s(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var i,p,a,u;return function(o,e){joms.util.popup.prepare(function(n){t(n,o,e)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.video=t(o,joms.popup.video||{}),e("popups/video",["popups/video.open","popups/video.add","popups/video.edit","popups/video.fetchthumbnail","popups/video.linktoprofile","popups/video.remove","popups/video.report","popups/video.addfeatured","popups/video.removefeatured","popups/video.removelinkfromprofile"],function(){return joms.popup.video})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,n){joms.view||(joms.view={}),joms.view.cover=n(o,t),e("views/cover",[],function(){return joms.view.cover})}(window,joms.jQuery,function(o,t){function e(o){var e;e=t(o.target),c.children(".joms-focus__actions--reposition").off("click","input"),"button-save"===e.data("ui-object")?n():s()}function n(){var o;o=p(r.position().top,c.height()),i(),joms.ajax({func:"photos,ajaxSetPhotoPhosition",data:[a,u,o]})}function s(){r.css({top:r.data("top")}),i()}function i(){c.css("cursor",""),c.children(".joms-focus__actions--reposition").hide(),c.children(".joms-focus__header").show(),c=null,r=null,m=null,l=null}function p(o,t){var e;return e=100*o/t,(e=Math.round(1e4*e)/1e4)+"%"}var a,u,c,r,m,l;return{reposition:function(o,n){var s,i;a=o,u=n,c=t(".joms-focus__cover"),(r=c.children(".joms-js--cover-image").children("img"))&&(c.css("cursor","move"),c.children(".joms-focus__header").hide(),c.children(".joms-focus__actions--reposition").on("click","input",e).show(),r.data("top",r.position().top),l=!0,(m=new joms.Hammer(r[0])).on("dragstart dragup dragdown dragend",function(o){var t;"dragstart"===o.type?(s=r.position().top,i=c.height()-r.height()):"dragend"!==o.type&&(t=Math.min(0,s+o.gesture.deltaY),t=Math.max(i,t),r.css({top:t}))}))},click:function(o,t){l||joms.api.photoOpen(o,t)}}}),function(o,t,n){joms.popup||(joms.popup={}),joms.popup.page||(joms.popup.page={}),joms.popup.page.share=n(o,t),e("popups/page.share",["utils/popup"],function(){return joms.popup.page.share})}(window,joms.jQuery,function(o,t){function e(o,e){var r,m,l;u&&u.off(),a=o,c=e,t.ajax({url:c,success:function(o){r=o.match(/<meta property="og:title" content="([^"]+)"/i)||!1,r=r&&r[1],m=o.match(/<meta property="og:description" content="([^"]+)"/i)||!1,m=m&&m[1],l=o.match(/<meta property="og:image" content="([^"]+)"/i)||!1,l=l&&l[1]},complete:function(){var o=[c,r||"",m||"",l||""];joms.ajax({func:"bookmarks,ajaxShowBookmarks",data:o,callback:function(o){a.items[0]={type:"inline",src:p(o)},a.updateItemHTML(),(u=a.contentContainer).on("click",".joms-bookmarks a",n),u.on("click",".joms-js--button-cancel",s),u.on("click",".joms-js--button-save",i)}})}})}function n(e){var n,s,i;e.preventDefault(),e.stopPropagation(),s=(n=t(this)).attr("href"),i=n.text(),u.off(),a.close(),o.open(s,i,"top=150, left=150, width=650, height=330, scrollbars=yes")}function s(){u.off(),a.close()}function i(){var o=u.find("form"),t=o.find("[name=bookmarks-email]").val(),e=o.find("[name=bookmarks-message]").val();joms.ajax({func:"bookmarks,ajaxEmailPage",data:[c,t,e],callback:function(o){u.find(".joms-js--step1").hide(),u.find(".joms-js--step2").show().children().html(o.error||o.message)}})}function p(o){return o||(o={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',o.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button>",o.viaEmail?' &nbsp;<button class="joms-button--primary joms-button--small joms-js--button-save">'+o.btnShare+"</button>":"","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join("")}var a,u,c;return function(o){joms.util.popup.prepare(function(t){e(t,o)})}}),function(o,t){joms.popup||(joms.popup={}),joms.popup.page=t(o,joms.popup.page||{}),e("popups/page",["popups/page.share"],function(){return joms.popup.page})}(window,function(o,t){return joms._.extend({},t)}),function(o,t,n){joms.view||(joms.view={}),joms.view.page=n(o,t),e("views/page",["utils/hovercard","popups/page"],function(){return joms.view.page})}(window,joms.jQuery,function(o,t){function e(o,e,p,a){t(".joms-js--like-"+e+"-"+p).each(function(){var u=this.tagName.toLowerCase(),c=t(this);"a"===u?c.hasClass("joms-popup__btn-like")?n(c,o,e,p,a):s(c,o,e,p,a):"button"===u&&(c.hasClass("joms-popup__btn-like")?n(c,o,e,p,a):i(c,o,e,p,a))})}function n(o,t,e,n,s){var i;"like"===t?(o.attr("onclick",'joms.view.page.unlike("'+e+'", "'+n+'");'),o.addClass("liked"),i=o.data("lang-liked")):"unlike"===t&&(o.attr("onclick",'joms.view.page.like("'+e+'", "'+n+'");'),o.removeClass("liked"),i=o.data("lang-like")),i=i||o.data("lang"),(s=+s)>0&&(i+=" ("+s+")"),o.html('<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-thumbs-up"></use></svg> <span>'+i+"</span>")}function s(o,t,e,n,s){var i;o.find("span").html(s),"like"===t?(o.attr("onclick",'joms.view.page.unlike("'+e+'", "'+n+'");'),o.addClass("liked"),(i=o.data("lang-liked"))&&o.find(".joms-js--lang").text(i)):"unlike"===t&&(o.attr("onclick",'joms.view.page.like("'+e+'", "'+n+'");'),o.removeClass("liked"),(i=o.data("lang-like"))&&o.find(".joms-js--lang").text(i))}function i(o,t,e,n,s){var i;"like"===t?(o.attr("onclick",'joms.view.page.unlike("'+e+'", "'+n+'");'),o.removeClass("joms-button--neutral"),o.addClass("joms-button--primary"),i=o.data("lang-liked")):"unlike"===t&&(o.attr("onclick",'joms.view.page.like("'+e+'", "'+n+'");'),o.addClass("joms-button--neutral"),o.removeClass("joms-button--primary"),i=o.data("lang-like")),i=i||o.data("lang")||"",(s=+s)>0&&(i+=" ("+s+")"),o.html(i)}return{initialize:function(){},like:function(o,t){joms.ajax({func:"system,ajaxLike",data:[o,t],callback:function(n){n.success&&e("like",o,t,n.likeCount)}})},unlike:function(o,t){joms.ajax({func:"system,ajaxUnlike",data:[o,t],callback:function(n){n.success&&e("unlike",o,t,n.likeCount)}})},share:function(o){joms.popup.page.share(o)}}}),function(o,t){joms.api=t(),e("api",["functions/announcement","functions/facebook","functions/invitation","utils/field","popups/info","popups/login","popups/album","popups/announcement","popups/app","popups/avatar","popups/comment","popups/cover","popups/discussion","popups/event","popups/fbc","popups/file","popups/friend","popups/group","popups/inbox","popups/location","popups/notification","popups/photo","popups/pm","popups/search","popups/tnc","popups/user","popups/video","views/cover","views/page","views/stream"],function(){return joms.api})}(window,function(){return{login:function(o){joms.popup.login(o)},userChangeVanityURL:function(o){joms.popup.user.changeVanityURL(o)},userAddFeatured:function(o){joms.popup.user.addFeatured(o)},userRemoveFeatured:function(o){joms.popup.user.removeFeatured(o)},userBan:function(o){joms.popup.user.ban(o)},userUnban:function(o){joms.popup.user.unban(o)},userBlock:function(o){joms.popup.user.block(o)},userUnblock:function(o){joms.popup.user.unblock(o)},userIgnore:function(o){joms.popup.user.ignore(o)},userUnignore:function(o){joms.popup.user.unignore(o)},userReport:function(o){joms.popup.user.report(o)},avatarChange:function(o,t,e){joms.popup.avatar.change(o,t),e&&(e.stopPropagation(),e.preventDefault())},avatarRemove:function(o,t){joms.popup.avatar.remove(o,t)},avatarRotate:function(o,t,e,n){joms.popup.avatar.rotate(o,t,e,n)},coverChange:function(o,t){joms.popup.cover.change(o,t)},coverRemove:function(o,t){joms.popup.cover.remove(o,t)},coverReposition:function(o,t){joms.view.cover.reposition(o,t)},coverClick:function(o,t){joms.view.cover.click(o,t)},eventInvite:function(o,t){joms.popup.event.invite(o,t)},eventJoin:function(o){joms.popup.event.join(o)},eventLeave:function(o){joms.popup.event.leave(o)},eventResponse:function(){joms.popup.event.response.apply(this,arguments)},eventAddFeatured:function(o){joms.popup.event.addFeatured(o)},eventRemoveFeatured:function(o){joms.popup.event.removeFeatured(o)},eventReport:function(o){joms.popup.event.report(o)},eventDelete:function(o){joms.popup.event.delete(o)},eventRejectGuest:function(o,t){joms.popup.event.rejectGuest(o,t)},eventBanMember:function(o,t){joms.popup.event.banMember(o,t)},eventUnbanMember:function(o,t){joms.popup.event.unbanMember(o,t)},friendAdd:function(o){joms.popup.friend.add(o)},friendAddCancel:function(o){joms.popup.friend.addCancel(o)},friendRemove:function(o){joms.popup.friend.remove(o)},friendResponse:function(o){joms.popup.friend.response(o)},friendApprove:function(o){joms.popup.friend.approve(o)},friendReject:function(o){joms.popup.friend.reject(o)},groupInvite:function(o){joms.popup.group.invite(o,1,1)},groupJoin:function(o){joms.popup.group.join(o)},groupLeave:function(o){joms.popup.group.leave(o)},groupAddFeatured:function(o){joms.popup.group.addFeatured(o)},groupRemoveFeatured:function(o){joms.popup.group.removeFeatured(o)},groupReport:function(o){joms.popup.group.report(o)},groupUnpublish:function(o){joms.popup.group.unpublish(o)},groupDelete:function(o){joms.popup.group.delete(o)},groupApprove:function(o,t){joms.popup.group.approve(o,t)},groupRemoveMember:function(o,t){joms.popup.group.removeMember(o,t)},groupBanMember:function(o,t){joms.popup.group.banMember(o,t)},groupUnbanMember:function(o,t){joms.popup.group.unbanMember(o,t)},notificationGeneral:function(){joms.view.toolbar.notificationGeneral()},notificationFriend:function(){joms.view.toolbar.notificationFriend()},notificationPm:function(){joms.view.toolbar.notificationPm()},photoUpload:function(o,t,e){joms.popup.photo.upload(o,t,e)},photoOpen:function(o,t){joms.popup.photo.open(o,t)},photoRemove:function(o){joms.popup.photo.remove(o)},photoZoom:function(o){joms.popup.photo.zoom(o)},photoSetAvatar:function(o){joms.popup.photo.setAvatar(o)},photoSetCover:function(o,t){joms.popup.photo.setCover(o,t)},photoSetAlbum:function(o){joms.popup.photo.setAlbum(o)},photoReport:function(o,t){joms.popup.photo.report(o,t)},albumRemove:function(o){joms.popup.album.remove(o)},albumAddFeatured:function(o){joms.popup.album.addFeatured(o)},albumRemoveFeatured:function(o){joms.popup.album.removeFeatured(o)},pmSend:function(o){joms.popup.pm.send(o)},videoAdd:function(o,t){joms.popup.video.add(o,t)},videoOpen:function(o){joms.popup.video.open(o)},videoEdit:function(o){joms.popup.video.edit(o)},videoRemove:function(o,t){joms.popup.video.remove(o,t)},videoAddFeatured:function(o){joms.popup.video.addFeatured(o)},videoRemoveFeatured:function(o){joms.popup.video.removeFeatured(o)},videoLinkToProfile:function(o){joms.popup.video.linkToProfile(o)},videoRemoveLinkFromProfile:function(o,t){joms.popup.video.removeLinkFromProfile(o,t)},videoFetchThumbnail:function(o){joms.popup.video.fetchThumbnail(o)},videoReport:function(o,t){joms.popup.video.report(o,t)},locationView:function(o){joms.popup.location.view(o)},streamLike:function(o){joms.view.stream.like(o)},streamUnlike:function(o){joms.view.stream.unlike(o)},streamEdit:function(o,t){joms.view.stream.edit(o,t)},streamEditLocation:function(o){joms.view.stream.editLocation(o)},streamRemove:function(o){joms.view.stream.remove(o)},streamRemoveLocation:function(o){joms.view.stream.removeLocation(o)},streamRemoveMood:function(o){joms.view.stream.removeMood(o)},streamRemoveTag:function(o){joms.view.stream.removeTag(o)},streamSelectPrivacy:function(o){joms.view.stream.selectPrivacy(o)},streamShare:function(o){joms.view.stream.share(o)},streamHide:function(o,t){joms.view.stream.hide(o,t)},streamShowLikes:function(o,t){joms.view.stream.showLikes(o,t)},streamShowComments:function(o,t){joms.view.stream.showComments(o,t)},streamShowOthers:function(o){joms.view.stream.showOthers(o)},streamReport:function(o){joms.view.stream.report(o)},streamToggleText:function(o){joms.view.stream.toggleText(o)},streamAddFeatured:function(o){joms.view.stream.addFeatured(o)},streamRemoveFeatured:function(o){joms.view.stream.removeFeatured(o)},streamsLoadMore:function(){joms.view.streams.loadMore()},commentLike:function(o){joms.view.comment.like(o)},commentUnlike:function(o){joms.view.comment.unlike(o)},commentEdit:function(o,t,e){joms.view.comment.edit(o,t,e)},commentCancel:function(o){joms.view.comment.cancel(o)},commentRemove:function(o,t){joms.view.comment.remove(o,t)},commentRemoveTag:function(o,t){joms.view.comment.removeTag(o,t)},commentRemovePreview:function(o,t){joms.view.comment.removePreview(o,t)},commentRemoveThumbnail:function(o,t){joms.view.comment.removeThumbnail(o,t)},commentShowLikes:function(o){joms.popup.comment.showLikes(o)},commentToggleText:function(o){joms.view.comment.toggleText(o)},appAbout:function(o){joms.popup.app.about(o)},appBrowse:function(o){joms.popup.app.browse(o)},appPrivacy:function(o){joms.popup.app.privacy(o)},appRemove:function(o){joms.popup.app.remove(o)},appSetting:function(o,t){joms.popup.app.setting(o,t)},searchSave:function(o){joms.popup.search.save(o)},pageLike:function(o,t){joms.view.page.like(o,t)},pageUnlike:function(o,t){joms.view.page.unlike(o,t)},pageShare:function(o){joms.view.page.share(o)},invitationAccept:function(o,t){joms.fn.invitation.accept(o,t)},invitationReject:function(o,t){joms.fn.invitation.reject(o,t)},fileUpload:function(o,t){joms.popup.file.upload(o,t)},fileList:function(o,t){joms.popup.file.list(o,t)},fileDownload:function(o,t,e){joms.popup.file.download(o,t,e)},fileRemove:function(o,t){joms.popup.file.remove(o,t)},fileUpdateHit:function(o,t){joms.popup.file.updateHit(o,t)},discussionLock:function(o,t){joms.popup.discussion.lock(o,t)},discussionRemove:function(o,t){joms.popup.discussion.remove(o,t)},announcementEdit:function(o,t){joms.fn.announcement.edit(o,t)},announcementEditCancel:function(o,t){joms.fn.announcement.editCancel(o,t)},announcementRemove:function(o,t){joms.popup.announcement.remove(o,t)},inboxRemove:function(o,t){joms.popup.inbox.remove(o,t)},inboxSetRead:function(o,t){joms.popup.inbox.setRead(o,t)},inboxSetUnread:function(o,t){joms.popup.inbox.setUnread(o,t)},tnc:function(){joms.popup.tnc()},fbcUpdate:function(){joms.popup.fbc.update()}}}),t(["core","utils/crop","utils/dropdown","utils/hovercard","utils/loadlib","utils/location-autocomplete","utils/popup","utils/tab","utils/tagging","utils/validation","utils/video","utils/wysiwyg","functions/tagging","views/comment","views/customize","views/misc","views/stream","views/streams","views/toolbar","api"],function(){joms.onStart(function(){joms.view.comment.start(),joms.view.page.initialize(),joms.view.stream.start(),joms.view.streams.start(),joms.view.toolbar.start(),joms.view.customize.start(),joms.view.misc.start(),joms.util.dropdown.start(),joms.util.tab.start(),joms.util.validation.start(),joms.util.wysiwyg.start(),joms.util.hovercard.initialize(),+window.joms_my_id&&joms.fn.tagging.fetchFriendsInContext()}),joms.jQuery(function(){joms.start()})}),e("init",function(){}),t.config({deps:["init"]}),e("bundle",function(){})}();